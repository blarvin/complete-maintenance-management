import{c as N,i as d,_ as c,a as r,b as V,d as A,e as g,f,F as Z,u,S as J,g as p,h as y,j as P,k as W,l as U,m as G,n as we,o as Ne,p as ee,q as F}from"./q-BGK8FbLO.js";import"firebase/firestore";const $e="_nodeWrapper_s9j9w_4",be="_nodeHeader_s9j9w_8",Ce="_nodeHeaderExpanded_s9j9w_18",Ie="_nodeHeaderContent_s9j9w_20",Se="_nodeHeaderParent_s9j9w_29",De="_upButtonWrapper_s9j9w_35",Ve="_nodeHeaderContentClickable_s9j9w_44",Ee="_nodeTitle_s9j9w_48",Re="_nodeSubtitle_s9j9w_63",Fe="_nodeChevron_s9j9w_83",Oe="_constructionActions_s9j9w_119",I={nodeWrapper:$e,nodeHeader:be,nodeHeaderExpanded:Ce,nodeHeaderContent:Ie,nodeHeaderParent:Se,upButtonWrapper:De,nodeHeaderContentClickable:Ve,nodeTitle:Ee,nodeSubtitle:Re,nodeChevron:Fe,constructionActions:Oe},ke=e=>c("h2",null,{class:I.nodeTitle,id:r(t=>t.id,[e],"p0.id")},r(t=>t.nodeName,[e],"p0.nodeName"),3,"Th_0"),Ae=N(d(ke,"s_DVVkpy7hRQQ")),Be=e=>c("div",null,{class:I.nodeSubtitle},r(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),3,"ld_0"),Te=N(d(Be,"s_BPVk0Y80MRc")),xe="_upButton_1crd4_5",Pe={upButton:xe},We=e=>c("button",null,{class:Pe.upButton,title:r(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),"aria-label":r(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),onClick$:V("s_zrBmdNlvcAw",[e])},"↑",3,"BX_0"),Ue=N(d(We,"s_zKD01KoPOyE")),Me=e=>{const[t]=u();t.onNodeClick$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.onNodeClick$())},He=e=>{const[t]=u();t.onExpand$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onExpand$())},Le=e=>{A();const t=d(Me,"s_Eo0egbDYOnc",[e]),n=d(He,"s_9BqTWe0Vch0",[e]);return c("article",{class:[I.nodeHeader,e.isExpanded&&I.nodeHeaderExpanded,e.isParent&&I.nodeHeaderParent]},{"aria-labelledby":r(a=>a.titleId,[e],"p0.titleId"),"data-node-id":r(a=>a.id,[e],"p0.id")},c("div",{class:[I.nodeHeaderContent,e.isClickable&&I.nodeHeaderContentClickable,e.isClickable&&"no-caret"],onClick$:e.onNodeClick$,onKeyDown$:t},{role:r(a=>a.isClickable?"button":void 0,[e],'p0.isClickable?"button":undefined'),tabIndex:r(a=>a.isClickable?0:void 0,[e],"p0.isClickable?0:undefined"),"aria-label":r(a=>a.isClickable?`Open ${a.nodeName||"node"}`:void 0,[e],'p0.isClickable?`Open ${p0.nodeName||"node"}`:undefined')},[e.isParent&&e.onNavigateUp$&&c("div",null,{class:I.upButtonWrapper},g(Ue,{get parentId(){return e.parentId??null},onNavigate$:e.onNavigateUp$,[f]:{parentId:r(a=>a.parentId??null,[e],"p0.parentId??null")}},2,"pa_0"),1,"pa_1"),c("div",null,null,e.isConstruction?g(Z,{children:[c("input",{ref:e.nameInputRef,onKeyDown$:e.onKeyDown$},{class:I.nodeTitle,placeholder:"Name","aria-label":"Node name",id:r(a=>a.titleId,[e],"p0.titleId")},null,2,null),c("input",{ref:e.subtitleInputRef,onKeyDown$:e.onKeyDown$},{class:I.nodeSubtitle,placeholder:"Subtitle / Location / Short description","aria-label":"Node subtitle"},null,2,null)]},1,"pa_2"):g(Z,{children:[g(Ae,{get nodeName(){return e.nodeName},get id(){return e.titleId},[f]:{nodeName:r(a=>a.nodeName,[e],"p0.nodeName"),id:r(a=>a.titleId,[e],"p0.titleId")}},3,"pa_3"),g(Te,{get nodeSubtitle(){return e.nodeSubtitle},[f]:{nodeSubtitle:r(a=>a.nodeSubtitle,[e],"p0.nodeSubtitle")}},3,"pa_4")]},1,"pa_5"),1,null),c("button",{onClick$:e.onExpand$,onKeyDown$:n},{type:"button",class:I.nodeChevron,"aria-expanded":r(a=>a.isExpanded,[e],"p0.isExpanded"),"aria-label":r(a=>a.isExpanded?"Collapse details":"Expand details",[e],'p0.isExpanded?"Collapse details":"Expand details"'),disabled:r(a=>a.chevronDisabled,[e],"p0.chevronDisabled")},r(a=>a.isExpanded?"▾":"◂",[e],'p0.isExpanded?"▾":"◂"'),2,null)],0,null),1,"pa_6")},oe=N(d(Le,"s_xWTLD5hOIvU")),qe="_wrapper_10kg1_7",Ke="_wrapperOpen_10kg1_47",Ge="_inner_10kg1_57",Qe="_datacard_10kg1_71",Ye="_datacardOpen_10kg1_103",L={wrapper:qe,wrapperOpen:Ke,inner:Ge,datacard:Qe,datacardOpen:Ye},ze=e=>c("div",{class:[L.wrapper,e.isOpen&&L.wrapperOpen]},null,c("div",null,{class:L.inner},c("div",{class:[L.datacard,e.isOpen&&L.datacardOpen,"no-caret"]},{role:"region","aria-label":"Node details"},[g(J,null,3,"9y_0"),g(J,{name:"actions",[f]:{name:f}},3,"9y_1")],1,null),1,null),1,"9y_2"),le=N(d(ze,"s_L7oO92ZEh6A"));function Q(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}const Xe="localUser",je=["Description","Type Of","Tags","Location","Serial Number","Part Number","Manufacturer","Model","Status","Installed Date","Weight","Dimensions","Power Rating","Current Reading","Note"],Ze=["Type Of","Description","Tags"];function q(){return Xe}const M=()=>Date.now(),Je=e=>new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"});function te(e,t,n){const a=new Error(t);return a.code=e,a.retryable=(n==null?void 0:n.retryable)??e==="unavailable",a.details=n==null?void 0:n.details,a.cause=n==null?void 0:n.cause,a}function b(e,t=!0){return{data:e,meta:{adapter:"idb",fromCache:t}}}class et{async listRootNodes(){const n=(await p.nodes.toArray()).filter(a=>a.parentId===null);return n.sort((a,o)=>o.updatedAt-a.updatedAt),b(n)}async getNode(t){const n=await p.nodes.get(t);return b(n??null)}async listChildren(t){const n=await p.nodes.where("parentId").equals(t).toArray();return n.sort((a,o)=>o.updatedAt-a.updatedAt),b(n)}async createNode(t){const n=M(),a=q(),o={id:t.id,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle,parentId:t.parentId,updatedBy:a,updatedAt:n};return await p.transaction("rw",p.nodes,p.syncQueue,async()=>{await p.nodes.put(o),await this.enqueueSyncOperation({operation:"create-node",entityType:"node",entityId:o.id,payload:o})}),console.log("[IDBAdapter] Node created in IDB:",o.id,o.nodeName),b(o)}async updateNode(t,n){const a=M(),o=q();return await p.transaction("rw",p.nodes,p.syncQueue,async()=>{await p.nodes.update(t,{...n,updatedBy:o,updatedAt:a});const l=await p.nodes.get(t);l&&await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:l})}),console.log("[IDBAdapter] Node updated in IDB:",t),b(void 0)}async deleteNode(t,n){if(await p.nodes.where("parentId").equals(t).count()>0)throw te("validation","Only leaf nodes can be deleted",{retryable:!1});return await p.transaction("rw",p.nodes,p.syncQueue,async()=>{await p.nodes.delete(t),await this.enqueueSyncOperation({operation:"delete-node",entityType:"node",entityId:t,payload:{id:t}})}),console.log("[IDBAdapter] Node deleted from IDB:",t),b(void 0)}async listFields(t){const n=await p.fields.where("parentNodeId").equals(t).toArray();return n.sort((a,o)=>a.cardOrder-o.cardOrder),b(n)}async nextCardOrder(t){const n=await p.fields.where("parentNodeId").equals(t).toArray();if(n.length===0)return b(0);const a=Math.max(...n.map(o=>o.cardOrder));return b(a+1)}async createField(t){const n=M(),a=q(),o=t.cardOrder??(await this.nextCardOrder(t.parentNodeId)).data,l={id:t.id,fieldName:t.fieldName,fieldValue:t.fieldValue,parentNodeId:t.parentNodeId,cardOrder:o,updatedBy:a,updatedAt:n};return await p.transaction("rw",p.fields,p.history,p.syncQueue,async()=>{await p.fields.put(l);const s=await this.nextRev(l.id),v={id:`${l.id}:${s}`,dataFieldId:l.id,parentNodeId:l.parentNodeId,action:"create",property:"fieldValue",prevValue:null,newValue:l.fieldValue,updatedBy:a,updatedAt:n,rev:s};await p.history.put(v),await this.enqueueSyncOperation({operation:"create-field",entityType:"field",entityId:l.id,payload:l})}),console.log("[IDBAdapter] Field created in IDB:",l.id,l.fieldName),b(l)}async updateFieldValue(t,n){const a=await p.fields.get(t);if(!a)throw te("not-found","Field not found",{retryable:!1});const o=M(),l=q();return await p.transaction("rw",p.fields,p.history,p.syncQueue,async()=>{await p.fields.update(t,{fieldValue:n.fieldValue,updatedAt:o,updatedBy:l});const s=await this.nextRev(t),v={id:`${t}:${s}`,dataFieldId:t,parentNodeId:a.parentNodeId,action:"update",property:"fieldValue",prevValue:a.fieldValue,newValue:n.fieldValue,updatedBy:l,updatedAt:o,rev:s};await p.history.put(v);const i=await p.fields.get(t);i&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:i})}),console.log("[IDBAdapter] Field updated in IDB:",t,n.fieldValue),b(void 0)}async deleteField(t){const n=await p.fields.get(t);if(!n)return b(void 0);const a=M(),o=q();return await p.transaction("rw",p.fields,p.history,p.syncQueue,async()=>{await p.fields.delete(t);const l=await this.nextRev(t),s={id:`${t}:${l}`,dataFieldId:t,parentNodeId:n.parentNodeId,action:"delete",property:"fieldValue",prevValue:n.fieldValue,newValue:null,updatedBy:o,updatedAt:a,rev:l};await p.history.put(s),await this.enqueueSyncOperation({operation:"delete-field",entityType:"field",entityId:t,payload:{id:t}})}),console.log("[IDBAdapter] Field deleted from IDB:",t),b(void 0)}async getFieldHistory(t){const n=await p.history.where("dataFieldId").equals(t).toArray();return n.sort((a,o)=>a.rev-o.rev),b(n)}async getSyncQueue(){const t=await p.syncQueue.where("status").equals("pending").toArray();return t.sort((n,a)=>n.timestamp-a.timestamp),t}async markSynced(t){await p.syncQueue.delete(t)}async markFailed(t,n){const a=await p.syncQueue.get(t);a&&await p.syncQueue.update(t,{status:"failed",retryCount:a.retryCount+1,lastError:(n==null?void 0:n.message)||String(n)})}async getLastSyncTimestamp(){const t=await p.syncMetadata.get("lastSyncTimestamp");return(t==null?void 0:t.value)??0}async setLastSyncTimestamp(t){await p.syncMetadata.put({key:"lastSyncTimestamp",value:t})}async applyRemoteUpdate(t,n){t==="node"?await p.nodes.put(n):await p.fields.put(n)}async getAllNodes(){return await p.nodes.toArray()}async getAllFields(){return await p.fields.toArray()}async deleteNodeLocal(t){await p.nodes.delete(t)}async deleteFieldLocal(t){await p.fields.delete(t)}async nextRev(t){const n=await p.history.where("dataFieldId").equals(t).toArray();return n.length===0?0:Math.max(...n.map(o=>o.rev))+1}async enqueueSyncOperation(t){const n={id:Q(),operation:t.operation,entityType:t.entityType,entityId:t.entityId,payload:t.payload,timestamp:M(),status:"pending",retryCount:0};await p.syncQueue.put(n)}}const de=new et,tt=at(de),nt=ot(de);function O(e){return e.data}function at(e){return{getRootNodes:async()=>O(await e.listRootNodes()),getNodeById:async t=>O(await e.getNode(t)),getNodeWithChildren:async t=>{const[n,a]=await Promise.all([e.getNode(t),e.listChildren(t)]);return{node:O(n),children:O(a)}},getChildren:async t=>O(await e.listChildren(t)),createWithFields:async t=>{await e.createNode({id:t.id,parentId:t.parentId,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle}),await Promise.all(t.defaults.map(n=>e.createField({id:Q(),parentNodeId:t.id,fieldName:n.fieldName,fieldValue:n.fieldValue})))},createEmptyNode:async(t,n)=>O(await e.createNode({id:t,parentId:n,nodeName:"",nodeSubtitle:""})),updateNode:async(t,n)=>{await e.updateNode(t,n)}}}function ot(e){return{getFieldsForNode:async t=>O(await e.listFields(t)),nextCardOrder:async t=>O(await e.nextCardOrder(t)),addField:async(t,n,a,o)=>O(await e.createField({id:Q(),parentNodeId:t,fieldName:n,fieldValue:a,cardOrder:o})),updateFieldValue:async(t,n)=>{await e.updateFieldValue(t,{fieldValue:n})},deleteField:async t=>{await e.deleteField(t)},getFieldHistory:async t=>O(await e.getFieldHistory(t))}}let lt=tt,dt=nt;function Y(){return lt}function B(){return dt}const it=280,st=6,rt=(e,t)=>{const[n,a,o,l,s]=u(),v=Date.now(),i=v-n.value<=s,_=Math.abs(e-a.value),m=Math.abs(t-o.value),h=_<=l&&m<=l,S=i&&h;return n.value=v,a.value=e,o.value=t,S};function ct(e={}){const t=e.thresholdMs??it,n=e.slopPx??st,a=y(0),o=y(0),l=y(0);return{checkDoubleTap$:d(rt,"s_Ex0CzuR1b0c",[a,o,l,n,t])}}const x={getTreeNodeState:(e,t,n)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t?"UNDER_CONSTRUCTION":e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD"},getDisplayNodeState:(e,t)=>e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD",getDataCardState:(e,t)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t?"UNDER_CONSTRUCTION":e.ui.expandedCards.has(t)?"EXPANDED":"COLLAPSED"},getDataFieldState:(e,t)=>e.editingFieldId===t?"EDITING":"DISPLAY",getDataFieldDetailsState:(e,t)=>e.ui.expandedFieldDetails.has(t)?"EXPANDED":"COLLAPSED",isRootView:e=>e.view.state==="ROOT",getCurrentNodeId:e=>e.view.state==="BRANCH"?e.view.nodeId:null,isUnderConstruction:(e,t)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t}},ut=({track:e,cleanup:t})=>{const[n,a,o,l]=u(),v=e(()=>n.editingFieldId)===l.fieldId;o.value!==null&&(clearTimeout(o.value),o.value=null),v&&(o.value=window.setTimeout(()=>{if(n.editingFieldId===l.fieldId&&a.value){const i=a.value,_=i.value.length;i.focus(),i.setSelectionRange(_,_)}o.value=null},10)),t(()=>{o.value!==null&&(clearTimeout(o.value),o.value=null)})},pt=e=>{const[t,n,a,o,l,s]=u();if(t.editingFieldId!==o.fieldId)return;const v=l.value,i=e.target;v&&i&&!v.contains(i)&&(s(),a.value=n.value)},ft=()=>{const[e,t,n,a,o,l]=u();e.editingFieldId!==a.fieldId&&(l(a.fieldId),n.value=t.value,o.value=null)},vt=async()=>{const[e,t,n,a,o]=u();if(e.editingFieldId!==a.fieldId)return;const l=n.value.trim()===""?null:n.value;await B().updateFieldValue(a.fieldId,l),t.value=l??"",o(),a.onUpdated$&&await a.onUpdated$()},_t=()=>{const[e,t,n,a,o]=u();e.editingFieldId===a.fieldId&&(o(),n.value=t.value)},yt=e=>{const[t]=u();t.value=e},gt=()=>{const[e,t,n,a,o,l]=u();Date.now()<l.value||e.editingFieldId===a.fieldId&&(o(),n.value=t.value)},ht=e=>{const[t,n]=u();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"&&(e.preventDefault(),t())},mt=async e=>{const[t,n,a,o,l]=u();if(t.editingFieldId!==a.fieldId)return;const s=e.clientX??0,v=e.clientY??0;l.value=Date.now()+220,await n(s,v)&&await o()},wt=async e=>{const[t,n,a,o]=u();if(t.editingFieldId===o.fieldId)return;const l=e.clientX??0,s=e.clientY??0;await a(l,s)&&await n()},Nt=e=>{const[t,n,a]=u();t.editingFieldId!==a.fieldId&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),n())},$t=e=>{const[t]=u();t.value=e},bt=()=>{const[e]=u();e.value=null},Ct=async e=>{const[t,n,a]=u();await B().updateFieldValue(n.fieldId,e),t.value=e??"",a.value=null,n.onUpdated$&&await n.onUpdated$()};function It(e){const t=P(),{startFieldEdit$:n,stopFieldEdit$:a}=W(),l=x.getDataFieldState(t,e.fieldId)==="EDITING",s=y(),v=y(),i=y(e.initialValue??""),_=y(""),m=y(null),h=y(0),S=y(null),{checkDoubleTap$:E}=ct();U(V("s_Tjhab5vyHfo",[i,e])),G(d(ut,"s_RbAuVMmGAmw",[t,v,S,e])),we("pointerdown",d(pt,"s_StU06vsCz00",[t,i,_,e,s,a]));const k=d(ft,"s_0HO9EPvGwSc",[t,i,_,e,m,n]),T=d(vt,"s_TpCFgZeU6Vk",[t,i,_,e,a]),$=d(_t,"s_dsRT43um7vE",[t,i,_,e,a]),z=d(yt,"s_43FZb0QGfSU",[_]),w=d(gt,"s_WWaKkyE000c",[t,i,_,e,a,h]),ue=d(ht,"s_8yy0Fab0FzY",[$,T]),pe=d(mt,"s_dSOqRahu9fY",[t,E,e,T,h]),fe=d(wt,"s_DkvtW0NQyBE",[t,k,E,e]),ve=d(Nt,"s_cmRnDo37yA8",[t,k,e]),_e=d($t,"s_edkN78Zq06w",[m]),ye=d(bt,"s_Ax8A0n67Fek",[m]),ge=d(Ct,"s_85DxwQYAcGo",[i,e,m]),j=m.value!==null?m.value:i.value,he=!!j,me=m.value!==null;return{isEditing:l,displayValue:j,isPreviewActive:me,hasValue:he,editValue:_,editInputRef:v,rootRef:s,beginEdit$:k,save$:T,cancel$:$,valuePointerDown$:fe,valueKeyDown$:ve,inputPointerDown$:pe,inputBlur$:w,inputKeyDown$:ue,inputChange$:z,setPreview$:_e,revert$:ge,clearPreview$:ye}}const St="_historyWrapper_163sz_5",Dt="_historyList_163sz_17",Vt="_historyRow_163sz_41",Et="_historyRowSelected_163sz_99",Rt="_historyValue_163sz_117",Ft="_historyMeta_163sz_131",H={historyWrapper:St,historyList:Dt,historyRow:Vt,historyRowSelected:Et,historyValue:Rt,historyMeta:Ft},Ot=e=>{const[t,n]=u();n.value=e.rev,t.onPreviewChange$(e.newValue)},kt=e=>{const t=y(null),n=[...e.history].reverse(),a=d(Ot,"s_BJVayUaFz28",[e,t]),o=s=>{const v=new Date(s),i=v.getDate().toString().padStart(2,"0"),_=(v.getMonth()+1).toString().padStart(2,"0"),m=v.getFullYear(),h=v.getHours().toString().padStart(2,"0"),S=v.getMinutes().toString().padStart(2,"0");return`${i}/${_}/${m}, ${h}:${S}`},l=e.history.length>0;return c("div",null,{class:[H.historyWrapper,"no-caret"]},e.isOpen&&l&&c("div",null,{class:[H.historyList,"no-caret"],role:"listbox","aria-label":"Field value history"},n.map(s=>c("button",{class:[H.historyRow,t.value===s.rev&&H.historyRowSelected],"aria-selected":t.value===s.rev,onClick$:V("s_MsJX096CMQc",[s,a])},{type:"button",role:"option"},[c("span",null,{class:H.historyValue},s.newValue||c("em",null,null,"Empty",3,"MV_0"),1,null),c("span",null,{class:H.historyMeta},[o(s.updatedAt),"  by ",Ne(s,"updatedBy")],1,null)],0,s.id)),1,"MV_1"),1,"MV_2")},At=N(d(kt,"s_JOaqQ6mNgM0")),Bt="_inlineWrapper_g7gtr_7",Tt="_spacer_g7gtr_19",xt="_buttonGroup_g7gtr_29",Pt="_cancelButton_g7gtr_43",Wt="_revertButton_g7gtr_91",Ut="_metadata_g7gtr_141",Mt="_historyChevron_g7gtr_161",Ht="_actionsRow_g7gtr_221",Lt="_deleteButton_g7gtr_233",qt="_historyRow_g7gtr_279",R={inlineWrapper:Bt,spacer:Tt,buttonGroup:xt,cancelButton:Pt,revertButton:Wt,metadata:Ut,historyChevron:Mt,actionsRow:Ht,deleteButton:Lt,historyRow:qt},Kt=()=>{const[e]=u();e.onDelete$()},Gt=e=>{const[t,n]=u();n.value=e,t.onPreviewChange$(e)},Qt=async()=>{const[e,t,n,a]=u();if(a.value!==null){await n.onRevert$(a.value);try{const o=await B().getFieldHistory(n.fieldId);e.value=o}catch(o){console.error("Failed to reload field history:",o)}a.value=null,t.value=!1}},Yt=()=>{const[e,t,n]=u();e.value=!e.value,e.value||(n.value=null,t.onPreviewChange$(null))},zt=()=>{const[e,t,n]=u();n.value=null,t.onPreviewChange$(null),e.value=!1},Xt=e=>{A();const t=y([]),n=y(!1),a=y(!1),o=y(null);U(V("s_R1kXqMQvJ9E",[t,n,e]));const l=d(Kt,"s_0bgQ1zoSedw",[e]),s=d(Gt,"s_zD3B0y4fHO0",[e,o]),v=d(Qt,"s_3k04NU4DZf8",[t,a,e,o]),i=d(Yt,"s_QoNOrZ0E02s",[a,e,o]),_=t.value.length>0?t.value[t.value.length-1]:null,m=_!=null&&_.updatedAt?Je(_.updatedAt):"",h=(_==null?void 0:_.updatedBy)??"",S=n.value&&m?`${m}  ${h}`:"...",E=t.value.length>0,k=o.value!==null,T=d(zt,"s_Mi0Kr02WGGA",[a,e,o]);return c("div",null,{class:[R.inlineWrapper,"no-caret"]},[k?c("span",null,{class:R.buttonGroup},[c("button",null,{type:"button",class:R.cancelButton,"aria-label":"Cancel selection",onClick$:T},"CANCEL",3,null),c("button",null,{type:"button",class:R.revertButton,"aria-label":"Revert to selected value",onClick$:v},"REVERT",3,null)],3,"dk_0"):c("span",null,{class:[R.spacer,"no-caret"]},null,3,null),c("span",null,{class:[R.metadata,"no-caret"]},S,1,null),c("button",{disabled:!E,title:E?"View field history":"No history available"},{type:"button",class:R.historyChevron,"aria-expanded":r($=>$.value,[a],"p0.value"),"aria-label":r($=>$.value?"Close field history":"Open field history",[a],'p0.value?"Close field history":"Open field history"'),onClick$:i},r($=>$.value?"▾":"◂",[a],'p0.value?"▾":"◂"'),3,null),a.value&&E&&c("div",null,{class:[R.historyRow,"no-caret"]},g(At,{get fieldId(){return e.fieldId},get history(){return t.value},get isOpen(){return a.value},onToggle$:i,onPreviewChange$:s,[f]:{fieldId:r($=>$.fieldId,[e],"p0.fieldId"),history:r($=>$.value,[t],"p0.value"),isOpen:r($=>$.value,[a],"p0.value"),onToggle$:f,onPreviewChange$:f}},3,"dk_1"),1,"dk_2"),c("div",null,{class:[R.actionsRow,"no-caret"]},c("button",null,{type:"button",class:R.deleteButton,"aria-label":"Delete this field",onClick$:l},"Delete Field",3,null),3,null)],1,"dk_3")},jt=N(d(Xt,"s_cNXlVpCg5og")),Zt="_datafieldWrapper_pusyg_5",Jt="_datafieldWrapperExpanded_pusyg_21",en="_datafield_pusyg_5",tn="_datafieldChevron_pusyg_117",nn="_datafieldLabel_pusyg_163",an="_datafieldValue_pusyg_175",on="_datafieldValueUnderlined_pusyg_183",ln="_datafieldValueEditable_pusyg_193",dn="_datafieldPlaceholder_pusyg_235",sn="_datafieldValuePreview_pusyg_247",D={datafieldWrapper:Zt,datafieldWrapperExpanded:Jt,datafield:en,datafieldChevron:tn,datafieldLabel:nn,datafieldValue:an,datafieldValueUnderlined:on,datafieldValueEditable:ln,datafieldPlaceholder:dn,datafieldValuePreview:sn},rn=()=>{const[e,t,n,a]=u(),o=x.getDataFieldDetailsState(e,a.id)==="EXPANDED";t.toggleFieldDetailsExpanded$(a.id),o&&n.clearPreview$()},cn=async()=>{const[e]=u();await B().deleteField(e.id),e.onDeleted$&&e.onDeleted$()},un=e=>{A();const t=P(),n=W(),o=x.getDataFieldDetailsState(t,e.id)==="EXPANDED",l=It({fieldId:e.id,initialValue:e.fieldValue,onUpdated$:e.onUpdated$}),s=d(rn,"s_wqZYmXF10hc",[t,n,l,e]),v=d(cn,"s_ldsGGOBThbg",[e]),i=`field-label-${e.id}`;return c("div",{class:[D.datafieldWrapper,o&&D.datafieldWrapperExpanded,"no-caret"],ref:l.rootRef},null,c("div",null,{class:[D.datafield,"no-caret"]},[c("button",{"aria-expanded":o,"aria-label":o?"Collapse field details":"Expand field details"},{type:"button",class:D.datafieldChevron,onClick$:s},o?"▾":"▸",1,null),c("label",{id:i},{class:D.datafieldLabel},[r(_=>_.fieldName,[e],"p0.fieldName"),":"],3,null),l.isEditing?c("input",{ref:l.editInputRef,class:[D.datafieldValue,l.editValue.value&&D.datafieldValueUnderlined],"aria-labelledby":i,onInput$:V("s_vhiFO47zY4A",[l]),onPointerDown$:l.inputPointerDown$,onBlur$:l.inputBlur$,onKeyDown$:l.inputKeyDown$},{value:r(_=>_.editValue.value,[l],"p0.editValue.value"),autoFocus:!0},null,2,"o6_0"):c("div",{class:[D.datafieldValue,l.hasValue&&D.datafieldValueUnderlined,D.datafieldValueEditable,l.isPreviewActive&&D.datafieldValuePreview,"no-caret"],"aria-labelledby":i,onPointerDown$:l.valuePointerDown$,onKeyDown$:l.valueKeyDown$},{tabIndex:0,role:"button","aria-description":"Press Enter to edit"},l.displayValue||c("span",null,{class:D.datafieldPlaceholder},"Empty",3,"o6_1"),0,null),o&&g(jt,{get fieldId(){return e.id},get fieldName(){return e.fieldName},get currentValue(){return l.displayValue},onDelete$:v,onPreviewChange$:l.setPreview$,onRevert$:l.revert$,[f]:{fieldId:r(_=>_.id,[e],"p0.id"),fieldName:r(_=>_.fieldName,[e],"p0.fieldName"),currentValue:r(_=>_.displayValue,[l],"p0.displayValue"),onDelete$:f}},2,"o6_2")],1,null),1,"o6_3")},pn=N(d(un,"s_2gBrAJoSz7w")),fn="_constructionWrapper_aoisn_51",vn="_construction_aoisn_51",_n="_chevronButton_aoisn_83",yn="_chevron_aoisn_83",gn="_chevronOpen_aoisn_141",hn="_comboBoxWrapper_aoisn_159",mn="_inputName_aoisn_169",wn="_inputValue_aoisn_207",Nn="_dropdown_aoisn_245",$n="_dropdownItem_aoisn_269",bn="_actions_aoisn_315",Cn="_actionButton_aoisn_329",In="_cancelButton_aoisn_367",C={constructionWrapper:fn,construction:vn,chevronButton:_n,chevron:yn,chevronOpen:gn,comboBoxWrapper:hn,inputName:mn,inputValue:wn,dropdown:Nn,dropdownItem:$n,actions:bn,actionButton:Cn,cancelButton:In},Sn=()=>{const[e,t]=u();t.initialName||setTimeout(()=>{var n;(n=e.value)==null||n.focus()},10)},Dn=()=>{const[e,t,n]=u();n.onChange$&&n.onChange$(n.id,e.value,t.value||null)},Vn=()=>{const[e,t,n]=u(),a=e.value.trim(),o=t.value.trim()||null;n.onSave$(n.id,a,o)},En=()=>{const[e]=u();document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.onCancel$(e.id)},Rn=()=>{const[e,t,n]=u();if(!n.value&&e.value){const a=e.value.getBoundingClientRect();t.value={top:a.bottom+2,left:a.left,width:a.width}}n.value=!n.value},Fn=e=>{const[t,n,a,o]=u();t.value=e,n.value=!1,a(),setTimeout(()=>{var l;(l=o.value)==null||l.focus()},10)},On=e=>{const[t,n]=u();t.value=e.target.value,n()},kn=e=>{const[t,n]=u();t.value=e.target.value,n()},An=e=>{var s;const[t,n,a,o,l]=u();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"?(e.preventDefault(),n.value?n.value=!1:t()):e.key==="ArrowDown"?(e.preventDefault(),o()):e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(s=l.value)==null||s.focus())},Bn=e=>{var o;const[t,n,a]=u();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"?(e.preventDefault(),t()):e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=n.value)==null||o.focus())},Tn=e=>{const[t,n,a]=u();e.key==="Enter"||e.key===" "?(e.preventDefault(),a()):e.key==="Escape"&&(e.preventDefault(),n.value?n.value=!1:t())},xn=e=>{const t=y(e.initialName??""),n=y(e.initialValue??""),a=y(!1),o=y(),l=y(),s=y(),v=y({top:0,left:0,width:0});G(d(Sn,"s_b1r271u70lg",[o,e]));const i=d(Dn,"s_5qS05iQ3kzk",[t,n,e]),_=d(Vn,"s_VXoapCcVBGQ",[t,n,e]),m=d(En,"s_pO38pDzpTKY",[e]),h=d(Rn,"s_CPeMh0DlK80",[s,v,a]),S=d(Fn,"s_JKvEDYW7DNg",[t,a,i,l]),E=d(On,"s_C64zPMw20r4",[t,i]),k=d(kn,"s_1yLyyhcqgGY",[n,i]),T=d(An,"s_y0PWFrmLvh4",[m,a,_,h,l]),$=d(Bn,"s_PaMVmYQPeZ4",[m,o,_]),z=d(Tn,"s_AWjg7A8hpOg",[m,a,h]);return c("div",null,{class:C.constructionWrapper},[c("div",null,{class:C.construction},[c("button",null,{type:"button",class:C.chevronButton,"aria-expanded":r(w=>w.value,[a],"p0.value"),"aria-label":r(w=>w.value?"Close field name picker":"Open field name picker",[a],'p0.value?"Close field name picker":"Open field name picker"'),tabIndex:-1,onClick$:h,onKeyDown$:z},c("span",{class:[C.chevron,a.value&&C.chevronOpen]},null,null,3,null),1,null),c("div",{ref:s},{class:C.comboBoxWrapper},[c("input",{ref:o},{type:"text",class:C.inputName,value:r(w=>w.value,[t],"p0.value"),placeholder:"Field Name","aria-label":"Field name (press Down Arrow for library)",onInput$:E,onKeyDown$:T,onFocus$:V("s_0IWX0Y3zQpc",[a])},null,3,null),a.value&&c("div",null,{class:C.dropdown,role:"listbox","aria-label":"Prefab field names",style:r(w=>({top:`${w.value.top}px`,left:`${w.value.left}px`,width:`${w.value.width}px`}),[v],"{top:`${p0.value.top}px`,left:`${p0.value.left}px`,width:`${p0.value.width}px`}")},je.map(w=>c("button",{onClick$:V("s_WB40vqhys98",[w,S])},{type:"button",class:C.dropdownItem,role:"option"},w,0,w)),1,"S1_0")],1,null),c("input",{ref:l},{type:"text",class:C.inputValue,value:r(w=>w.value,[n],"p0.value"),placeholder:"Value (optional)","aria-label":"Field value",onInput$:k,onKeyDown$:$},null,3,null)],1,null),c("div",null,{class:C.actions},[c("button",null,{type:"button",class:[C.actionButton,C.cancelButton],onClick$:m},"Cancel",3,null),c("button",null,{type:"button",class:C.actionButton,onClick$:_},"Save",3,null)],3,null)],1,"S1_1")},Pn=N(d(xn,"s_rgskcIH6ZDg")),Wn=()=>{const[e,t,n,a]=u(),o=a.nodeId,l=a.enabled;(t.value!==o||e.value!==l)&&(t.value=o,e.value=l,n.value++)},Un=async()=>{const[e,t,n,a]=u();e.value&&(a.value=!0,n.value=await B().getFieldsForNode(t.value),a.value=!1)};function Mn(e){const t=y(null),n=y(!1),a=y(e.nodeId),o=y(e.enabled),l=y(0);return G(d(Wn,"s_4i3R51gQIV8",[o,a,l,e])),U(V("s_Ch3EXBvP4ag",[o,a,t,n,l])),{fields:t,isLoading:n,reload$:d(Un,"s_7gfJWzE1Bug",[o,a,t,n])}}const ne=e=>`pendingFields:${e}`,Hn=(e,t)=>{try{t.length===0?localStorage.removeItem(ne(e)):localStorage.setItem(ne(e),JSON.stringify(t))}catch{}},Ln=({track:e})=>{const[t,n]=u(),a=e(()=>t.value);typeof localStorage<"u"&&Hn(n.nodeId,a)},qn=async()=>{const[e,t]=u(),n=t.maxPersistedCardOrder$.value,a=e.value.length>0?Math.max(...e.value.map(s=>s.cardOrder)):-1,o=Math.max(n,a)+1,l={id:Q(),fieldName:"",fieldValue:null,cardOrder:o};e.value=[...e.value,l]},Kn=async(e,t,n)=>{const[a,o]=u(),l=t.trim();if(!l){a.value=a.value.filter(i=>i.id!==e);return}const s=a.value.find(i=>i.id===e),v=s==null?void 0:s.cardOrder;await B().addField(o.nodeId,l,n,v),a.value=a.value.filter(i=>i.id!==e),await o.onSaved$()},Gn=e=>{const[t]=u();t.value=t.value.filter(n=>n.id!==e)},Qn=(e,t,n)=>{const[a]=u();a.value=a.value.map(o=>o.id===e?{...o,fieldName:t,fieldValue:n}:o)},Yn=async()=>{const[e,t]=u(),n=e.value.filter(o=>o.fieldName.trim());if(n.length===0)return 0;const a=B();return await Promise.all(n.map(o=>a.addField(t.nodeId,o.fieldName.trim(),o.fieldValue,o.cardOrder))),e.value=[],await t.onSaved$(),n.length};function zn(e){const t=y([]),n=y(!1);return U(V("s_qU68K91Z7fs",[t,n,e])),G(d(Ln,"s_7EzmTvHmSgg",[t,e])),{forms:t,add$:d(qn,"s_Biym0x2w2Hg",[t,e]),save$:d(Kn,"s_w000e3KQtXY",[t,e]),cancel$:d(Gn,"s_tq0phclloKM",[t]),change$:d(Qn,"s_IrI7Myrn2Ko",[t]),saveAllPending$:d(Yn,"s_CEglqaDCkrM",[t,e])}}const Xn="_fieldList_5uih9_5",jn="_addButton_5uih9_17",ae={fieldList:Xn,addButton:jn},ie=30,Zn=()=>{const[e]=u();return!e.fields.value||e.fields.value.length===0?-1:Math.max(...e.fields.value.map(t=>t.cardOrder))},Jn=()=>{const[e,t]=u(),n=[];if(t.fields.value)for(const a of t.fields.value)n.push({type:"persisted",field:a});for(const a of e.forms.value)n.push({type:"pending",form:a});return n.sort((a,o)=>{const l=a.type==="persisted"?a.field.cardOrder:a.form.cardOrder,s=o.type==="persisted"?o.field.cardOrder:o.form.cardOrder;return l-s}),n},ea=()=>{const[e]=u();e.reload$()},ta=()=>{const[e]=u();e.forms.value.length<ie&&e.add$()},na=e=>{const t=Mn({nodeId:e.nodeId,enabled:!0}),n=ee(d(Zn,"s_09wqlr4vzW0",[t])),a=zn({nodeId:e.nodeId,onSaved$:t.reload$,initialFieldNames:e.initialFieldNames,maxPersistedCardOrder$:n});U(V("s_YFcoGOqtLXk",[a,e]));const o=ee(d(Jn,"s_vrtZqVijSkE",[a,t])),l=d(ea,"s_XhGlu5hwbws",[t]),s=d(ta,"s_WITd5JAXm44",[a]),v=a.forms.value.length<ie;return c("div",null,{class:ae.fieldList},[o.value.map(i=>(A(),i.type==="persisted"?g(pn,{get id(){return i.field.id},get fieldName(){return i.field.fieldName},get fieldValue(){return i.field.fieldValue},onDeleted$:l,[f]:{id:F(i.field,"id"),fieldName:F(i.field,"fieldName"),fieldValue:F(i.field,"fieldValue"),onDeleted$:f}},3,i.field.id):g(Pn,{get id(){return i.form.id},get initialName(){return i.form.fieldName},get initialValue(){return i.form.fieldValue},onSave$:a.save$,onCancel$:a.cancel$,onChange$:a.change$,[f]:{id:F(i.form,"id"),initialName:F(i.form,"fieldName"),initialValue:F(i.form,"fieldValue")}},2,i.form.id))),c("button",{disabled:!v,"aria-label":v?"Add new field":"Maximum fields reached"},{type:"button",class:ae.addButton,onClick$:s},"+ Add Field",3,null)],1,"Bt_0")},se=N(d(na,"s_2RnEZFWrgIk")),aa=e=>{const[t,n]=u();e==null||e.stopPropagation(),t.toggleCardExpanded$(n.id)},oa=e=>{const t=P(),n=W(),o=x.getDataCardState(t,e.id)==="EXPANDED",l=d(aa,"s_fJ0tmVx2bMU",[n,e]),s=`node-title-${e.id}`,v=!!e.onNodeClick$,i=e.nodeState==="PARENT",m=e.nodeState==="CHILD"?"18px":"50px";return c("div",{style:{"--datacard-indent":m}},{class:I.nodeWrapper},[g(oe,{get id(){return e.id},titleId:s,isExpanded:o,isParent:i,isClickable:v,get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,onExpand$:l,[f]:{id:r(h=>h.id,[e],"p0.id"),nodeName:r(h=>h.nodeName,[e],"p0.nodeName"),nodeSubtitle:r(h=>h.nodeSubtitle,[e],"p0.nodeSubtitle"),parentId:r(h=>h.parentId,[e],"p0.parentId"),onExpand$:f}},2,"vG_0"),g(le,{isOpen:o,get nodeId(){return e.id},children:g(se,{get nodeId(){return e.id},[f]:{nodeId:r(h=>h.id,[e],"p0.id")}},3,"vG_1"),[f]:{nodeId:r(h=>h.id,[e],"p0.id")}},1,"vG_2")],1,"vG_3")},la=N(d(oa,"s_06szQ6qXZeE")),da=async()=>{var v,i,_,m,h,S;const[e,t,n,a]=u();e.value&&await e.value.saveAllPending$(),console.log("[handleCreate$] nameInputRef.value:",t.value),console.log("[handleCreate$] subtitleInputRef.value:",a.value),console.log("[handleCreate$] nameInputRef placeholder:",(v=t.value)==null?void 0:v.placeholder),console.log("[handleCreate$] subtitleInputRef placeholder:",(i=a.value)==null?void 0:i.placeholder),console.log("[handleCreate$] nameInputRef.value.value:",(_=t.value)==null?void 0:_.value),console.log("[handleCreate$] subtitleInputRef.value.value:",(m=a.value)==null?void 0:m.value);const o=document.querySelectorAll("input");console.log("[handleCreate$] All inputs on page:",o.length),o.forEach((E,k)=>{console.log(`[handleCreate$] Input ${k}: placeholder="${E.placeholder}", value="${E.value}"`)});const l=((h=t.value)==null?void 0:h.value)||"",s=((S=a.value)==null?void 0:S.value)||"";console.log("[handleCreate$] Final values - nodeName:",JSON.stringify(l),"nodeSubtitle:",JSON.stringify(s)),await n.onCreate$({nodeName:l,nodeSubtitle:s,fields:[]})},ia=e=>{const[t,n]=u();e.key==="Enter"?(e.preventDefault(),t()):e.key==="Escape"&&(e.preventDefault(),n.onCancel$())},sa=e=>{const t=y(),n=y(),a=y(null);U(V("s_82IaKsCDbGY",[t]));const o=d(da,"s_60fRKu4o7GU",[a,t,e,n]),l=d(ia,"s_ZHVlk1DFSAo",[o,e]),s=`node-title-${e.id}`,v=e.isChildConstruction?"18px":"50px";return c("div",{style:{"--datacard-indent":v}},{class:I.nodeWrapper},[g(oe,{get id(){return e.id},titleId:s,isExpanded:!0,isParent:!1,isClickable:!1,get nodeName(){return e.initialName||""},get nodeSubtitle(){return e.initialSubtitle||""},isConstruction:!0,nameInputRef:t,subtitleInputRef:n,onKeyDown$:l,chevronDisabled:!0,[f]:{id:r(i=>i.id,[e],"p0.id"),isExpanded:f,isParent:f,isClickable:f,nodeName:r(i=>i.initialName||"",[e],'p0.initialName||""'),nodeSubtitle:r(i=>i.initialSubtitle||"",[e],'p0.initialSubtitle||""'),isConstruction:f,nameInputRef:f,subtitleInputRef:f,onKeyDown$:f,chevronDisabled:f}},3,"qo_0"),g(le,{get nodeId(){return e.id},isOpen:!0,children:[g(se,{get nodeId(){return e.id},initialFieldNames:Ze,handleRef:a,[f]:{nodeId:r(i=>i.id,[e],"p0.id"),initialFieldNames:f,handleRef:f}},3,"qo_1"),c("div",{"q:slot":"actions"},{class:I.constructionActions},[c("button",{onClick$:e.onCancel$},{type:"button"},"Cancel",2,null),c("button",null,{type:"button",onClick$:o},"Create",3,null)],1,null)],[f]:{nodeId:r(i=>i.id,[e],"p0.id"),isOpen:f}},1,"qo_2")],1,"qo_3")},ra=N(d(sa,"s_0HiZh00BXTo"));function ca(e){return e.nodeState==="UNDER_CONSTRUCTION"}const ua=e=>(A(),ca(e)?g(ra,{get id(){return e.id},get initialName(){return e.nodeName},get initialSubtitle(){return e.nodeSubtitle},get isChildConstruction(){return e.isChildConstruction},onCancel$:e.onCancel$,onCreate$:e.onCreate$,[f]:{id:r(t=>t.id,[e],"p0.id"),initialName:r(t=>t.nodeName,[e],"p0.nodeName"),initialSubtitle:r(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),isChildConstruction:r(t=>t.isChildConstruction,[e],"p0.isChildConstruction")}},2,"gq_0"):g(la,{get id(){return e.id},get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get nodeState(){return e.nodeState},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,[f]:{id:r(t=>t.id,[e],"p0.id"),nodeName:r(t=>t.nodeName,[e],"p0.nodeName"),nodeSubtitle:r(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),nodeState:r(t=>t.nodeState,[e],"p0.nodeState"),parentId:r(t=>t.parentId,[e],"p0.parentId")}},2,"gq_1")),K=N(d(ua,"s_gegngB44RHE")),pa="_createNode_194o9_5",fa="_createNodeChild_194o9_49",X={createNode:pa,createNodeChild:fa},va=async()=>{const[e]=u();e.onClick$&&await e.onClick$()},_a=e=>{const t=d(va,"s_m1x9adscB00",[e]);return e.variant==="root"?c("button",null,{type:"button",class:[X.createNode,"no-caret"],"aria-label":"Create New Asset",onClick$:t},"Create New Asset",3,"ad_0"):e.variant==="child"?c("button",null,{type:"button",class:[X.createNode,X.createNodeChild,"no-caret"],"aria-label":"Add Sub-Asset",onClick$:t},"+ Add Sub-Asset",3,"ad_1"):null},re=N(d(_a,"s_0wYRrfEmCIE")),ya=async()=>{const[e,t]=u(),n=Q();await Y().createEmptyNode(n,e.parentId),await t({id:n,parentId:e.parentId,nodeName:"",nodeSubtitle:"",defaultFields:[]})},ga=async()=>{const[e]=u();await e()},ha=async e=>{const[t,n,a]=u();console.log("[complete$] Received payload:",JSON.stringify(e));const o=t.underConstruction;if(console.log("[complete$] ucData:",o),!o){console.log("[complete$] No ucData, returning early!");return}if(console.log("[complete$] Updating node",o.id,"with:",{nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||""}),await Y().updateNode(o.id,{nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||""}),console.log("[complete$] Node updated, calling completeConstruction$"),e.fields.length>0){const l=B();await Promise.all(e.fields.map(s=>l.addField(o.id,s.fieldName,s.fieldValue)))}await n(),console.log("[complete$] completeConstruction$ done, calling onCreated$"),await a.onCreated$(),console.log("[complete$] onCreated$ done, complete$ finished")};function ce(e){const t=P(),{startConstruction$:n,cancelConstruction$:a,completeConstruction$:o}=W(),l=d(ya,"s_n6hsWUuIj1Y",[e,n]),s=d(ga,"s_cbiq6e5O6us",[a]),v=d(ha,"s_v6yCRyJjgcY",[t,o,e]);return{ucNode:t.underConstruction,start$:l,cancel$:s,complete$:v}}const ma=async()=>{const[e,t]=u();console.log("[useRootViewData] load$ called"),e.value=!0;try{const n=await Y().getRootNodes();console.log("[useRootViewData] Fetched",n.length,"root nodes"),t.value=n,console.log("[useRootViewData] nodes.value set to",t.value.length,"nodes")}finally{e.value=!1}};function wa(){const e=y([]),t=y(!1),n=d(ma,"s_UIfphfAKvzM",[t,e]);return U(V("s_j2W4Hu2S1VQ",[n])),{nodes:e,isLoading:t,reload$:n}}const Na=()=>{const[e,t]=u();return e.navigateToNode$(t.id)},$a=()=>{A();const e=P(),t=W(),n=wa(),a=ce({parentId:null,onCreated$:n.reload$}),o=a.ucNode?n.nodes.value.filter(l=>l.id!==a.ucNode.id):n.nodes.value;return c("main",null,{class:"view-root"},[o.map(l=>g(K,{get id(){return l.id},get nodeName(){return l.nodeName},nodeSubtitle:l.nodeSubtitle??"",nodeState:x.getDisplayNodeState(e,l.id),onNodeClick$:d(Na,"s_FBTGThmmG98",[t,l]),[f]:{id:F(l,"id"),nodeName:F(l,"nodeName")}},3,l.id)),a.ucNode?g(K,{get id(){return a.ucNode.id},get nodeName(){return a.ucNode.nodeName},get nodeSubtitle(){return a.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",onCancel$:a.cancel$,onCreate$:a.complete$,[f]:{id:r(l=>l.ucNode.id,[a],"p0.ucNode.id"),nodeName:r(l=>l.ucNode.nodeName,[a],"p0.ucNode.nodeName"),nodeSubtitle:r(l=>l.ucNode.nodeSubtitle,[a],"p0.ucNode.nodeSubtitle"),nodeState:f}},2,a.ucNode.id):null,g(re,{variant:"root",onClick$:a.start$,[f]:{variant:f}},2,"7G_0")],1,"7G_1")},ba=N(d($a,"s_hNvYX6tEL2I")),Ca=async e=>{const[t,n,a,o,l]=u();if(e){t.underConstruction&&n(),o.value=!0;try{const s=await Y().getNodeWithChildren(e);l.value=s.node,a.value=s.children}finally{o.value=!1}}};function Ia(){const e=y(null),t=y([]),n=y(!1),a=P(),{cancelConstruction$:o}=W(),l=d(Ca,"s_cbTnqvcou0A",[a,o,t,n,e]);return{parentNode:e,children:t,isLoading:n,load$:l,reload$:l}}const Sa=async({track:e})=>{const[t,n]=u(),a=e(()=>n.parentId);a&&await t.load$(a)},Da=async()=>{const[e,t]=u();await e.reload$(t.parentId)},Va=()=>{const[e,t]=u();return e.navigateToNode$(t.id)},Ea=e=>{A();const t=W(),n=Ia();G(d(Sa,"s_yRk2iqAjgFI",[n,e]));const a=ce({parentId:e.parentId,onCreated$:d(Da,"s_02bEtWr042Y",[n,e])});return n.isLoading.value||!n.parentNode.value?c("main",null,{class:"view-branch"},"Loading...",3,"RT_0"):c("main",null,{class:"view-branch"},[c("div",null,{class:"branch-parent-row"},c("div",null,{class:"branch-parent-node"},g(K,{get id(){return n.parentNode.value.id},get nodeName(){return n.parentNode.value.nodeName},get nodeSubtitle(){return n.parentNode.value.nodeSubtitle??""},nodeState:"PARENT",get parentId(){return n.parentNode.value.parentId},onNavigateUp$:t.navigateUp$,[f]:{id:r(o=>o.parentNode.value.id,[n],"p0.parentNode.value.id"),nodeName:r(o=>o.parentNode.value.nodeName,[n],"p0.parentNode.value.nodeName"),nodeSubtitle:r(o=>o.parentNode.value.nodeSubtitle??"",[n],'p0.parentNode.value.nodeSubtitle??""'),nodeState:f,parentId:r(o=>o.parentNode.value.parentId,[n],"p0.parentNode.value.parentId")}},2,n.parentNode.value.id),1,null),1,null),c("div",null,{class:"branch-children"},[n.children.value.filter(o=>!a.ucNode||o.id!==a.ucNode.id).map(o=>g(K,{get id(){return o.id},get nodeName(){return o.nodeName},nodeSubtitle:o.nodeSubtitle??"",nodeState:"CHILD",onNodeClick$:d(Va,"s_ubVdAKhHRM8",[t,o]),[f]:{id:F(o,"id"),nodeName:F(o,"nodeName"),nodeState:f}},3,o.id)),a.ucNode?c("div",null,{class:"branch-child-row"},g(K,{get id(){return a.ucNode.id},get nodeName(){return a.ucNode.nodeName},get nodeSubtitle(){return a.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",isChildConstruction:!0,onCancel$:a.cancel$,onCreate$:a.complete$,[f]:{id:r(o=>o.ucNode.id,[a],"p0.ucNode.id"),nodeName:r(o=>o.ucNode.nodeName,[a],"p0.ucNode.nodeName"),nodeSubtitle:r(o=>o.ucNode.nodeSubtitle,[a],"p0.ucNode.nodeSubtitle"),nodeState:f,isChildConstruction:f}},2,a.ucNode.id),1,"RT_1"):null,g(re,{variant:"child",onClick$:a.start$,[f]:{variant:f}},2,"RT_2")],1,null)],1,"RT_3")},Ra=N(d(Ea,"s_gIJMeo2tapw")),Fa=()=>{A();const e=P(),t=x.isRootView(e),n=x.getCurrentNodeId(e);return t?g(ba,null,3,"sJ_0"):g(Ra,{parentId:n},3,"sJ_1")},Oa=N(d(Fa,"s_yh0RYmyrFWk")),ka=Object.freeze(Object.defineProperty({__proto__:null,default:Oa},Symbol.toStringTag,{value:"Module"})),Aa=[],Ba=[["/",[()=>ka],"/",[]]],Ta=[],xa=!0,Pa="/",Wa=!0,Ha={routes:Ba,serverPlugins:Aa,menus:Ta,trailingSlash:xa,basePathname:Pa,cacheModules:Wa};export{Pa as basePathname,Wa as cacheModules,Ha as default,Ta as menus,Ba as routes,Aa as serverPlugins,xa as trailingSlash};
