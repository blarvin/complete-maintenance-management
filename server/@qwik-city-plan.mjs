import{c as $,i as d,_ as u,a as c,b as S,d as T,e as g,f as v,F as te,u as p,S as ne,g as r,h as _,j as M,k as H,l as x,m as G,n as be,o as Ie,p as ae,q as R}from"./q-c5mjSp0i.js";import"firebase/firestore";const Ce="_nodeWrapper_s9j9w_4",Se="_nodeHeader_s9j9w_8",De="_nodeHeaderExpanded_s9j9w_18",Ve="_nodeHeaderContent_s9j9w_20",Ee="_nodeHeaderParent_s9j9w_29",Ae="_upButtonWrapper_s9j9w_35",Re="_nodeHeaderContentClickable_s9j9w_44",Fe="_nodeTitle_s9j9w_48",Oe="_nodeSubtitle_s9j9w_63",ke="_nodeChevron_s9j9w_83",Be="_constructionActions_s9j9w_119",C={nodeWrapper:Ce,nodeHeader:Se,nodeHeaderExpanded:De,nodeHeaderContent:Ve,nodeHeaderParent:Ee,upButtonWrapper:Ae,nodeHeaderContentClickable:Re,nodeTitle:Fe,nodeSubtitle:Oe,nodeChevron:ke,constructionActions:Be},Te=e=>u("h2",null,{class:C.nodeTitle,id:c(t=>t.id,[e],"p0.id")},c(t=>t.nodeName,[e],"p0.nodeName"),3,"Th_0"),xe=$(d(Te,"s_DVVkpy7hRQQ")),Pe=e=>u("div",null,{class:C.nodeSubtitle},c(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),3,"ld_0"),We=$(d(Pe,"s_BPVk0Y80MRc")),Ue="_upButton_1crd4_5",Me={upButton:Ue},He=e=>u("button",null,{class:Me.upButton,title:c(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),"aria-label":c(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),onClick$:S("s_zrBmdNlvcAw",[e])},"↑",3,"BX_0"),Le=$(d(He,"s_zKD01KoPOyE")),qe=e=>{const[t]=p();t.onNodeClick$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.onNodeClick$())},Ke=e=>{const[t]=p();t.onExpand$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onExpand$())},Qe=e=>{T();const t=d(qe,"s_Eo0egbDYOnc",[e]),a=d(Ke,"s_9BqTWe0Vch0",[e]);return u("article",{class:[C.nodeHeader,e.isExpanded&&C.nodeHeaderExpanded,e.isParent&&C.nodeHeaderParent]},{"aria-labelledby":c(n=>n.titleId,[e],"p0.titleId"),"data-node-id":c(n=>n.id,[e],"p0.id")},u("div",{class:[C.nodeHeaderContent,e.isClickable&&C.nodeHeaderContentClickable,e.isClickable&&"no-caret"],onClick$:e.onNodeClick$,onKeyDown$:t},{role:c(n=>n.isClickable?"button":void 0,[e],'p0.isClickable?"button":undefined'),tabIndex:c(n=>n.isClickable?0:void 0,[e],"p0.isClickable?0:undefined"),"aria-label":c(n=>n.isClickable?`Open ${n.nodeName||"node"}`:void 0,[e],'p0.isClickable?`Open ${p0.nodeName||"node"}`:undefined')},[e.isParent&&e.onNavigateUp$&&u("div",null,{class:C.upButtonWrapper},g(Le,{get parentId(){return e.parentId??null},onNavigate$:e.onNavigateUp$,[v]:{parentId:c(n=>n.parentId??null,[e],"p0.parentId??null")}},2,"pa_0"),1,"pa_1"),u("div",null,null,e.isConstruction?g(te,{children:[u("input",{ref:e.nameInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeTitle,placeholder:"Name","aria-label":"Node name",id:c(n=>n.titleId,[e],"p0.titleId")},null,2,null),u("input",{ref:e.subtitleInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeSubtitle,placeholder:"Subtitle / Location / Short description","aria-label":"Node subtitle"},null,2,null)]},1,"pa_2"):g(te,{children:[g(xe,{get nodeName(){return e.nodeName},get id(){return e.titleId},[v]:{nodeName:c(n=>n.nodeName,[e],"p0.nodeName"),id:c(n=>n.titleId,[e],"p0.titleId")}},3,"pa_3"),g(We,{get nodeSubtitle(){return e.nodeSubtitle},[v]:{nodeSubtitle:c(n=>n.nodeSubtitle,[e],"p0.nodeSubtitle")}},3,"pa_4")]},1,"pa_5"),1,null),u("button",{onClick$:e.onExpand$,onKeyDown$:a},{type:"button",class:C.nodeChevron,"aria-expanded":c(n=>n.isExpanded,[e],"p0.isExpanded"),"aria-label":c(n=>n.isExpanded?"Collapse details":"Expand details",[e],'p0.isExpanded?"Collapse details":"Expand details"'),disabled:c(n=>n.chevronDisabled,[e],"p0.chevronDisabled")},c(n=>n.isExpanded?"▾":"◂",[e],'p0.isExpanded?"▾":"◂"'),2,null)],0,null),1,"pa_6")},ie=$(d(Qe,"s_xWTLD5hOIvU")),Ge="_wrapper_10kg1_7",Ye="_wrapperOpen_10kg1_47",ze="_inner_10kg1_57",Xe="_datacard_10kg1_71",Ze="_datacardOpen_10kg1_103",K={wrapper:Ge,wrapperOpen:Ye,inner:ze,datacard:Xe,datacardOpen:Ze},je=e=>u("div",{class:[K.wrapper,e.isOpen&&K.wrapperOpen]},null,u("div",null,{class:K.inner},u("div",{class:[K.datacard,e.isOpen&&K.datacardOpen,"no-caret"]},{role:"region","aria-label":"Node details"},[g(ne,null,3,"9y_0"),g(ne,{name:"actions",[v]:{name:v}},3,"9y_1")],1,null),1,null),1,"9y_2"),se=$(d(je,"s_L7oO92ZEh6A"));function Y(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}function oe(e){return e.filter(t=>t.deletedAt===null)}function j(e){return e.filter(t=>t.deletedAt!==null)}const Je="localUser",et=["Description","Type Of","Tags","Location","Serial Number","Part Number","Manufacturer","Model","Status","Installed Date","Weight","Dimensions","Power Rating","Current Reading","Note"],tt=["Type Of","Description","Tags"];function B(){return Je}const k=()=>Date.now(),nt=e=>new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"});function at(e,t,a){const n=new Error(t);return n.code=e,n.retryable=a==null?void 0:a.retryable,n.details=a==null?void 0:a.details,n.cause=a==null?void 0:a.cause,n}function m(e,t=!0){return{data:e,meta:{adapter:"idb",fromCache:t}}}class ot{async listRootNodes(){const a=(await r.nodes.toArray()).filter(n=>n.parentId===null&&n.deletedAt===null);return a.sort((n,o)=>o.updatedAt-n.updatedAt),m(a)}async getNode(t){const a=await r.nodes.get(t);return m(a??null)}async listChildren(t){const a=await r.nodes.where("parentId").equals(t).toArray(),n=oe(a);return n.sort((o,l)=>l.updatedAt-o.updatedAt),m(n)}async createNode(t){const a=k(),n=B(),o={id:t.id,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle,parentId:t.parentId,updatedBy:n,updatedAt:a,deletedAt:null};return await r.transaction("rw",r.nodes,r.syncQueue,async()=>{await r.nodes.put(o),await this.enqueueSyncOperation({operation:"create-node",entityType:"node",entityId:o.id,payload:o})}),console.log("[IDBAdapter] Node created in IDB:",o.id,o.nodeName),m(o)}async updateNode(t,a){const n=k(),o=B();return await r.transaction("rw",r.nodes,r.syncQueue,async()=>{await r.nodes.update(t,{...a,updatedBy:o,updatedAt:n});const l=await r.nodes.get(t);l&&await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:l})}),console.log("[IDBAdapter] Node updated in IDB:",t),m(void 0)}async deleteNode(t,a){const n=k(),o=B();return await r.transaction("rw",r.nodes,r.syncQueue,async()=>{await r.nodes.update(t,{deletedAt:n,updatedAt:n,updatedBy:o});const l=await r.nodes.get(t);l&&await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:l})}),console.log("[IDBAdapter] Node soft-deleted in IDB:",t),m(void 0)}async listFields(t){const a=await r.fields.where("parentNodeId").equals(t).toArray(),n=oe(a);return n.sort((o,l)=>o.cardOrder-l.cardOrder),m(n)}async nextCardOrder(t){const a=await r.fields.where("parentNodeId").equals(t).toArray();if(a.length===0)return m(0);const n=Math.max(...a.map(o=>o.cardOrder));return m(n+1)}async createField(t){const a=k(),n=B(),o=t.cardOrder??(await this.nextCardOrder(t.parentNodeId)).data,l={id:t.id,fieldName:t.fieldName,fieldValue:t.fieldValue,parentNodeId:t.parentNodeId,cardOrder:o,updatedBy:n,updatedAt:a,deletedAt:null};return await r.transaction("rw",r.fields,r.history,r.syncQueue,async()=>{await r.fields.put(l);const i=await this.nextRev(l.id),f={id:`${l.id}:${i}`,dataFieldId:l.id,parentNodeId:l.parentNodeId,action:"create",property:"fieldValue",prevValue:null,newValue:l.fieldValue,updatedBy:n,updatedAt:a,rev:i};await r.history.put(f),await this.enqueueSyncOperation({operation:"create-field",entityType:"field",entityId:l.id,payload:l}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:f.id,payload:f})}),console.log("[IDBAdapter] Field created in IDB:",l.id,l.fieldName),m(l)}async updateFieldValue(t,a){const n=await r.fields.get(t);if(!n)throw at("not-found","Field not found",{retryable:!1});const o=k(),l=B();return await r.transaction("rw",r.fields,r.history,r.syncQueue,async()=>{await r.fields.update(t,{fieldValue:a.fieldValue,updatedAt:o,updatedBy:l});const i=await this.nextRev(t),f={id:`${t}:${i}`,dataFieldId:t,parentNodeId:n.parentNodeId,action:"update",property:"fieldValue",prevValue:n.fieldValue,newValue:a.fieldValue,updatedBy:l,updatedAt:o,rev:i};await r.history.put(f);const s=await r.fields.get(t);s&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:s}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:f.id,payload:f})}),console.log("[IDBAdapter] Field updated in IDB:",t,a.fieldValue),m(void 0)}async deleteField(t){const a=await r.fields.get(t);if(!a)return m(void 0);const n=k(),o=B();return await r.transaction("rw",r.fields,r.history,r.syncQueue,async()=>{await r.fields.update(t,{deletedAt:n,updatedAt:n,updatedBy:o});const l=await this.nextRev(t),i={id:`${t}:${l}`,dataFieldId:t,parentNodeId:a.parentNodeId,action:"delete",property:"fieldValue",prevValue:a.fieldValue,newValue:null,updatedBy:o,updatedAt:n,rev:l};await r.history.put(i);const f=await r.fields.get(t);f&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:f}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:i.id,payload:i})}),console.log("[IDBAdapter] Field soft-deleted in IDB:",t),m(void 0)}async getFieldHistory(t){const a=await r.history.where("dataFieldId").equals(t).toArray();return a.sort((n,o)=>n.rev-o.rev),m(a)}async listDeletedNodes(){const t=await r.nodes.toArray(),a=j(t);return a.sort((n,o)=>(o.deletedAt??0)-(n.deletedAt??0)),m(a)}async listDeletedChildren(t){const a=await r.nodes.where("parentId").equals(t).toArray(),n=j(a);return n.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),m(n)}async restoreNode(t){const a=k(),n=B();return await r.transaction("rw",r.nodes,r.syncQueue,async()=>{await r.nodes.update(t,{deletedAt:null,updatedAt:a,updatedBy:n});const o=await r.nodes.get(t);o&&await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:o})}),console.log("[IDBAdapter] Node restored in IDB:",t),m(void 0)}async listDeletedFields(t){const a=await r.fields.where("parentNodeId").equals(t).toArray(),n=j(a);return n.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),m(n)}async restoreField(t){const a=k(),n=B();return await r.transaction("rw",r.fields,r.syncQueue,async()=>{await r.fields.update(t,{deletedAt:null,updatedAt:a,updatedBy:n});const o=await r.fields.get(t);o&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:o})}),console.log("[IDBAdapter] Field restored in IDB:",t),m(void 0)}async getSyncQueue(){const t=await r.syncQueue.where("status").equals("pending").toArray();return t.sort((a,n)=>a.timestamp-n.timestamp),t}async markSynced(t){await r.syncQueue.delete(t)}async markFailed(t,a){const n=await r.syncQueue.get(t);n&&await r.syncQueue.update(t,{status:"failed",retryCount:n.retryCount+1,lastError:(a==null?void 0:a.message)||String(a)})}async getLastSyncTimestamp(){const t=await r.syncMetadata.get("lastSyncTimestamp");return(t==null?void 0:t.value)??0}async setLastSyncTimestamp(t){await r.syncMetadata.put({key:"lastSyncTimestamp",value:t})}async applyRemoteUpdate(t,a){t==="node"?await r.nodes.put(a):await r.fields.put(a)}async getAllNodes(){return await r.nodes.toArray()}async getAllFields(){return await r.fields.toArray()}async getAllHistory(){return await r.history.toArray()}async applyRemoteHistory(t){await r.history.put(t)}async deleteNodeLocal(t){await r.nodes.delete(t)}async deleteFieldLocal(t){await r.fields.delete(t)}async nextRev(t){const a=await r.history.where("dataFieldId").equals(t).toArray();return a.length===0?0:Math.max(...a.map(o=>o.rev))+1}async enqueueSyncOperation(t){const a={id:Y(),operation:t.operation,entityType:t.entityType,entityId:t.entityId,payload:t.payload,timestamp:k(),status:"pending",retryCount:0};await r.syncQueue.put(a)}}const re=new ot,lt=it(re),dt=st(re);function F(e){return e.data}function it(e){return{getRootNodes:async()=>F(await e.listRootNodes()),getNodeById:async t=>F(await e.getNode(t)),getNodeWithChildren:async t=>{const[a,n]=await Promise.all([e.getNode(t),e.listChildren(t)]);return{node:F(a),children:F(n)}},getChildren:async t=>F(await e.listChildren(t)),createWithFields:async t=>{await e.createNode({id:t.id,parentId:t.parentId,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle}),await Promise.all(t.defaults.map(a=>e.createField({id:Y(),parentNodeId:t.id,fieldName:a.fieldName,fieldValue:a.fieldValue})))},createEmptyNode:async(t,a)=>F(await e.createNode({id:t,parentId:a,nodeName:"",nodeSubtitle:""})),updateNode:async(t,a)=>{await e.updateNode(t,a)}}}function st(e){return{getFieldsForNode:async t=>F(await e.listFields(t)),nextCardOrder:async t=>F(await e.nextCardOrder(t)),addField:async(t,a,n,o)=>F(await e.createField({id:Y(),parentNodeId:t,fieldName:a,fieldValue:n,cardOrder:o})),updateFieldValue:async(t,a)=>{await e.updateFieldValue(t,{fieldValue:a})},deleteField:async t=>{await e.deleteField(t)},getFieldHistory:async t=>F(await e.getFieldHistory(t))}}let rt=lt,ct=dt;function X(){return rt}function P(){return ct}const ut=280,pt=6,ft=(e,t)=>{const[a,n,o,l,i]=p(),f=Date.now(),s=f-a.value<=i,y=Math.abs(e-n.value),w=Math.abs(t-o.value),h=y<=l&&w<=l,D=s&&h;return a.value=f,n.value=e,o.value=t,D};function vt(e={}){const t=e.thresholdMs??ut,a=e.slopPx??pt,n=_(0),o=_(0),l=_(0);return{checkDoubleTap$:d(ft,"s_Ex0CzuR1b0c",[n,o,l,a,t])}}const U={getTreeNodeState:(e,t,a)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t?"UNDER_CONSTRUCTION":e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD"},getDisplayNodeState:(e,t)=>e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD",getDataCardState:(e,t)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t?"UNDER_CONSTRUCTION":e.ui.expandedCards.has(t)?"EXPANDED":"COLLAPSED"},getDataFieldState:(e,t)=>e.editingFieldId===t?"EDITING":"DISPLAY",getDataFieldDetailsState:(e,t)=>e.ui.expandedFieldDetails.has(t)?"EXPANDED":"COLLAPSED",isRootView:e=>e.view.state==="ROOT",getCurrentNodeId:e=>e.view.state==="BRANCH"?e.view.nodeId:null,isUnderConstruction:(e,t)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t}};function yt(e,t){throw new Error("SyncManager not initialized. Call getSyncManager with adapters first.")}const _t=500;let z=null;function q(){z!==null&&clearTimeout(z),z=setTimeout(()=>{z=null,yt().syncDelta().catch(e=>console.error("[triggerSync] Sync failed:",e))},_t)}const gt=({track:e,cleanup:t})=>{const[a,n,o,l]=p(),f=e(()=>a.editingFieldId)===l.fieldId;o.value!==null&&(clearTimeout(o.value),o.value=null),f&&(o.value=window.setTimeout(()=>{if(a.editingFieldId===l.fieldId&&n.value){const s=n.value,y=s.value.length;s.focus(),s.setSelectionRange(y,y)}o.value=null},10)),t(()=>{o.value!==null&&(clearTimeout(o.value),o.value=null)})},ht=e=>{const[t,a,n,o,l,i]=p();if(t.editingFieldId!==o.fieldId)return;const f=l.value,s=e.target;f&&s&&!f.contains(s)&&(i(),n.value=a.value)},wt=()=>{const[e,t,a,n,o,l]=p();e.editingFieldId!==n.fieldId&&(l(n.fieldId),a.value=t.value,o.value=null)},mt=async()=>{const[e,t,a,n,o]=p();if(e.editingFieldId!==n.fieldId)return;const l=a.value.trim()===""?null:a.value;await P().updateFieldValue(n.fieldId,l),t.value=l??"",o(),q(),n.onUpdated$&&await n.onUpdated$()},Nt=()=>{const[e,t,a,n,o]=p();e.editingFieldId===n.fieldId&&(o(),a.value=t.value)},$t=e=>{const[t]=p();t.value=e},bt=()=>{const[e,t,a,n,o,l]=p();Date.now()<l.value||e.editingFieldId===n.fieldId&&(o(),a.value=t.value)},It=e=>{const[t,a]=p();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"&&(e.preventDefault(),t())},Ct=async e=>{const[t,a,n,o,l]=p();if(t.editingFieldId!==n.fieldId)return;const i=e.clientX??0,f=e.clientY??0;l.value=Date.now()+220,await a(i,f)&&await o()},St=async e=>{const[t,a,n,o]=p();if(t.editingFieldId===o.fieldId)return;const l=e.clientX??0,i=e.clientY??0;await n(l,i)&&await a()},Dt=e=>{const[t,a,n]=p();t.editingFieldId!==n.fieldId&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),a())},Vt=e=>{const[t]=p();t.value=e},Et=()=>{const[e]=p();e.value=null},At=async e=>{const[t,a,n]=p();await P().updateFieldValue(a.fieldId,e),t.value=e??"",n.value=null,q(),a.onUpdated$&&await a.onUpdated$()};function Rt(e){const t=M(),{startFieldEdit$:a,stopFieldEdit$:n}=H(),l=U.getDataFieldState(t,e.fieldId)==="EDITING",i=_(),f=_(),s=_(e.initialValue??""),y=_(""),w=_(null),h=_(0),D=_(null),{checkDoubleTap$:E}=vt();x(S("s_Tjhab5vyHfo",[s,e])),G(d(gt,"s_RbAuVMmGAmw",[t,f,D,e])),be("pointerdown",d(ht,"s_StU06vsCz00",[t,s,y,e,i,n]));const O=d(wt,"s_0HO9EPvGwSc",[t,s,y,e,w,a]),W=d(mt,"s_TpCFgZeU6Vk",[t,s,y,e,n]),b=d(Nt,"s_dsRT43um7vE",[t,s,y,e,n]),Z=d($t,"s_43FZb0QGfSU",[y]),N=d(bt,"s_WWaKkyE000c",[t,s,y,e,n,h]),ve=d(It,"s_8yy0Fab0FzY",[b,W]),ye=d(Ct,"s_dSOqRahu9fY",[t,E,e,W,h]),_e=d(St,"s_DkvtW0NQyBE",[t,O,E,e]),ge=d(Dt,"s_cmRnDo37yA8",[t,O,e]),he=d(Vt,"s_edkN78Zq06w",[w]),we=d(Et,"s_Ax8A0n67Fek",[w]),me=d(At,"s_85DxwQYAcGo",[s,e,w]),ee=w.value!==null?w.value:s.value,Ne=!!ee,$e=w.value!==null;return{isEditing:l,displayValue:ee,isPreviewActive:$e,hasValue:Ne,editValue:y,editInputRef:f,rootRef:i,beginEdit$:O,save$:W,cancel$:b,valuePointerDown$:_e,valueKeyDown$:ge,inputPointerDown$:ye,inputBlur$:N,inputKeyDown$:ve,inputChange$:Z,setPreview$:he,revert$:me,clearPreview$:we}}const Ft="_historyWrapper_163sz_5",Ot="_historyList_163sz_17",kt="_historyRow_163sz_41",Bt="_historyRowSelected_163sz_99",Tt="_historyValue_163sz_117",xt="_historyMeta_163sz_131",L={historyWrapper:Ft,historyList:Ot,historyRow:kt,historyRowSelected:Bt,historyValue:Tt,historyMeta:xt},Pt=e=>{const[t,a]=p();a.value=e.rev,t.onPreviewChange$(e.newValue)},Wt=e=>{const t=_(null),a=[...e.history].reverse(),n=d(Pt,"s_BJVayUaFz28",[e,t]),o=i=>{const f=new Date(i),s=f.getDate().toString().padStart(2,"0"),y=(f.getMonth()+1).toString().padStart(2,"0"),w=f.getFullYear(),h=f.getHours().toString().padStart(2,"0"),D=f.getMinutes().toString().padStart(2,"0");return`${s}/${y}/${w}, ${h}:${D}`},l=e.history.length>0;return u("div",null,{class:[L.historyWrapper,"no-caret"]},e.isOpen&&l&&u("div",null,{class:[L.historyList,"no-caret"],role:"listbox","aria-label":"Field value history"},a.map(i=>u("button",{class:[L.historyRow,t.value===i.rev&&L.historyRowSelected],"aria-selected":t.value===i.rev,onClick$:S("s_MsJX096CMQc",[i,n])},{type:"button",role:"option"},[u("span",null,{class:L.historyValue},i.newValue||u("em",null,null,"Empty",3,"MV_0"),1,null),u("span",null,{class:L.historyMeta},[o(i.updatedAt),"  by ",Ie(i,"updatedBy")],1,null)],0,i.id)),1,"MV_1"),1,"MV_2")},Ut=$(d(Wt,"s_JOaqQ6mNgM0")),Mt="_inlineWrapper_g7gtr_7",Ht="_spacer_g7gtr_19",Lt="_buttonGroup_g7gtr_29",qt="_cancelButton_g7gtr_43",Kt="_revertButton_g7gtr_91",Qt="_metadata_g7gtr_141",Gt="_historyChevron_g7gtr_161",Yt="_actionsRow_g7gtr_221",zt="_deleteButton_g7gtr_233",Xt="_historyRow_g7gtr_279",A={inlineWrapper:Mt,spacer:Ht,buttonGroup:Lt,cancelButton:qt,revertButton:Kt,metadata:Qt,historyChevron:Gt,actionsRow:Yt,deleteButton:zt,historyRow:Xt},Zt=()=>{const[e]=p();e.onDelete$()},jt=e=>{const[t,a]=p();a.value=e,t.onPreviewChange$(e)},Jt=async()=>{const[e,t,a,n]=p();if(n.value!==null){await a.onRevert$(n.value);try{const o=await P().getFieldHistory(a.fieldId);e.value=o}catch(o){console.error("Failed to reload field history:",o)}n.value=null,t.value=!1}},en=()=>{const[e,t,a]=p();e.value=!e.value,e.value||(a.value=null,t.onPreviewChange$(null))},tn=()=>{const[e,t,a]=p();a.value=null,t.onPreviewChange$(null),e.value=!1},nn=e=>{T();const t=_([]),a=_(!1),n=_(!1),o=_(null);x(S("s_R1kXqMQvJ9E",[t,a,e]));const l=d(Zt,"s_0bgQ1zoSedw",[e]),i=d(jt,"s_zD3B0y4fHO0",[e,o]),f=d(Jt,"s_3k04NU4DZf8",[t,n,e,o]),s=d(en,"s_QoNOrZ0E02s",[n,e,o]),y=t.value.length>0?t.value[t.value.length-1]:null,w=y!=null&&y.updatedAt?nt(y.updatedAt):"",h=(y==null?void 0:y.updatedBy)??"",D=a.value&&w?`${w}  ${h}`:"...",E=t.value.length>0,O=o.value!==null,W=d(tn,"s_Mi0Kr02WGGA",[n,e,o]);return u("div",null,{class:[A.inlineWrapper,"no-caret"]},[O?u("span",null,{class:A.buttonGroup},[u("button",null,{type:"button",class:A.cancelButton,"aria-label":"Cancel selection",onClick$:W},"CANCEL",3,null),u("button",null,{type:"button",class:A.revertButton,"aria-label":"Revert to selected value",onClick$:f},"REVERT",3,null)],3,"dk_0"):u("span",null,{class:[A.spacer,"no-caret"]},null,3,null),u("span",null,{class:[A.metadata,"no-caret"]},D,1,null),u("button",{disabled:!E,title:E?"View field history":"No history available"},{type:"button",class:A.historyChevron,"aria-expanded":c(b=>b.value,[n],"p0.value"),"aria-label":c(b=>b.value?"Close field history":"Open field history",[n],'p0.value?"Close field history":"Open field history"'),onClick$:s},c(b=>b.value?"▾":"◂",[n],'p0.value?"▾":"◂"'),3,null),n.value&&E&&u("div",null,{class:[A.historyRow,"no-caret"]},g(Ut,{get fieldId(){return e.fieldId},get history(){return t.value},get isOpen(){return n.value},onToggle$:s,onPreviewChange$:i,[v]:{fieldId:c(b=>b.fieldId,[e],"p0.fieldId"),history:c(b=>b.value,[t],"p0.value"),isOpen:c(b=>b.value,[n],"p0.value"),onToggle$:v,onPreviewChange$:v}},3,"dk_1"),1,"dk_2"),u("div",null,{class:[A.actionsRow,"no-caret"]},u("button",null,{type:"button",class:A.deleteButton,"aria-label":"Delete this field",onClick$:l},"Delete Field",3,null),3,null)],1,"dk_3")},an=$(d(nn,"s_cNXlVpCg5og")),on="_datafieldWrapper_pusyg_5",ln="_datafieldWrapperExpanded_pusyg_21",dn="_datafield_pusyg_5",sn="_datafieldChevron_pusyg_117",rn="_datafieldLabel_pusyg_163",cn="_datafieldValue_pusyg_175",un="_datafieldValueUnderlined_pusyg_183",pn="_datafieldValueEditable_pusyg_193",fn="_datafieldPlaceholder_pusyg_235",vn="_datafieldValuePreview_pusyg_247",V={datafieldWrapper:on,datafieldWrapperExpanded:ln,datafield:dn,datafieldChevron:sn,datafieldLabel:rn,datafieldValue:cn,datafieldValueUnderlined:un,datafieldValueEditable:pn,datafieldPlaceholder:fn,datafieldValuePreview:vn},yn=()=>{const[e,t,a,n]=p(),o=U.getDataFieldDetailsState(e,n.id)==="EXPANDED";t.toggleFieldDetailsExpanded$(n.id),o&&a.clearPreview$()},_n=async()=>{const[e]=p();await P().deleteField(e.id),q(),e.onDeleted$&&e.onDeleted$()},gn=e=>{T();const t=M(),a=H(),o=U.getDataFieldDetailsState(t,e.id)==="EXPANDED",l=Rt({fieldId:e.id,initialValue:e.fieldValue,onUpdated$:e.onUpdated$}),i=d(yn,"s_wqZYmXF10hc",[t,a,l,e]),f=d(_n,"s_ldsGGOBThbg",[e]),s=`field-label-${e.id}`;return u("div",{class:[V.datafieldWrapper,o&&V.datafieldWrapperExpanded,"no-caret"],ref:l.rootRef},null,u("div",null,{class:[V.datafield,"no-caret"]},[u("button",{"aria-expanded":o,"aria-label":o?"Collapse field details":"Expand field details"},{type:"button",class:V.datafieldChevron,onClick$:i},o?"▾":"▸",1,null),u("label",{id:s},{class:V.datafieldLabel},[c(y=>y.fieldName,[e],"p0.fieldName"),":"],3,null),l.isEditing?u("input",{ref:l.editInputRef,class:[V.datafieldValue,l.editValue.value&&V.datafieldValueUnderlined],"aria-labelledby":s,onInput$:S("s_vhiFO47zY4A",[l]),onPointerDown$:l.inputPointerDown$,onBlur$:l.inputBlur$,onKeyDown$:l.inputKeyDown$},{value:c(y=>y.editValue.value,[l],"p0.editValue.value"),autoFocus:!0},null,2,"o6_0"):u("div",{class:[V.datafieldValue,l.hasValue&&V.datafieldValueUnderlined,V.datafieldValueEditable,l.isPreviewActive&&V.datafieldValuePreview,"no-caret"],"aria-labelledby":s,onPointerDown$:l.valuePointerDown$,onKeyDown$:l.valueKeyDown$},{tabIndex:0,role:"button","aria-description":"Press Enter to edit"},l.displayValue||u("span",null,{class:V.datafieldPlaceholder},"Empty",3,"o6_1"),0,null),o&&g(an,{get fieldId(){return e.id},get fieldName(){return e.fieldName},get currentValue(){return l.displayValue},onDelete$:f,onPreviewChange$:l.setPreview$,onRevert$:l.revert$,[v]:{fieldId:c(y=>y.id,[e],"p0.id"),fieldName:c(y=>y.fieldName,[e],"p0.fieldName"),currentValue:c(y=>y.displayValue,[l],"p0.displayValue"),onDelete$:v}},2,"o6_2")],1,null),1,"o6_3")},hn=$(d(gn,"s_2gBrAJoSz7w")),wn="_constructionWrapper_aoisn_51",mn="_construction_aoisn_51",Nn="_chevronButton_aoisn_83",$n="_chevron_aoisn_83",bn="_chevronOpen_aoisn_141",In="_comboBoxWrapper_aoisn_159",Cn="_inputName_aoisn_169",Sn="_inputValue_aoisn_207",Dn="_dropdown_aoisn_245",Vn="_dropdownItem_aoisn_269",En="_actions_aoisn_315",An="_actionButton_aoisn_329",Rn="_cancelButton_aoisn_367",I={constructionWrapper:wn,construction:mn,chevronButton:Nn,chevron:$n,chevronOpen:bn,comboBoxWrapper:In,inputName:Cn,inputValue:Sn,dropdown:Dn,dropdownItem:Vn,actions:En,actionButton:An,cancelButton:Rn},Fn=()=>{const[e,t]=p();t.initialName||setTimeout(()=>{var a;(a=e.value)==null||a.focus()},10)},On=()=>{const[e,t,a]=p();a.onChange$&&a.onChange$(a.id,e.value,t.value||null)},kn=()=>{const[e,t,a]=p(),n=e.value.trim(),o=t.value.trim()||null;a.onSave$(a.id,n,o)},Bn=()=>{const[e]=p();document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.onCancel$(e.id)},Tn=()=>{const[e,t,a]=p();if(!a.value&&e.value){const n=e.value.getBoundingClientRect();t.value={top:n.bottom+2,left:n.left,width:n.width}}a.value=!a.value},xn=e=>{const[t,a,n,o]=p();t.value=e,a.value=!1,n(),setTimeout(()=>{var l;(l=o.value)==null||l.focus()},10)},Pn=e=>{const[t,a]=p();t.value=e.target.value,a()},Wn=e=>{const[t,a]=p();t.value=e.target.value,a()},Un=e=>{var i;const[t,a,n,o,l]=p();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"?(e.preventDefault(),a.value?a.value=!1:t()):e.key==="ArrowDown"?(e.preventDefault(),o()):e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(i=l.value)==null||i.focus())},Mn=e=>{var o;const[t,a,n]=p();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"?(e.preventDefault(),t()):e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=a.value)==null||o.focus())},Hn=e=>{const[t,a,n]=p();e.key==="Enter"||e.key===" "?(e.preventDefault(),n()):e.key==="Escape"&&(e.preventDefault(),a.value?a.value=!1:t())},Ln=e=>{const t=_(e.initialName??""),a=_(e.initialValue??""),n=_(!1),o=_(),l=_(),i=_(),f=_({top:0,left:0,width:0});G(d(Fn,"s_b1r271u70lg",[o,e]));const s=d(On,"s_5qS05iQ3kzk",[t,a,e]),y=d(kn,"s_VXoapCcVBGQ",[t,a,e]),w=d(Bn,"s_pO38pDzpTKY",[e]),h=d(Tn,"s_CPeMh0DlK80",[i,f,n]),D=d(xn,"s_JKvEDYW7DNg",[t,n,s,l]),E=d(Pn,"s_C64zPMw20r4",[t,s]),O=d(Wn,"s_1yLyyhcqgGY",[a,s]),W=d(Un,"s_y0PWFrmLvh4",[w,n,y,h,l]),b=d(Mn,"s_PaMVmYQPeZ4",[w,o,y]),Z=d(Hn,"s_AWjg7A8hpOg",[w,n,h]);return u("div",null,{class:I.constructionWrapper},[u("div",null,{class:I.construction},[u("button",null,{type:"button",class:I.chevronButton,"aria-expanded":c(N=>N.value,[n],"p0.value"),"aria-label":c(N=>N.value?"Close field name picker":"Open field name picker",[n],'p0.value?"Close field name picker":"Open field name picker"'),tabIndex:-1,onClick$:h,onKeyDown$:Z},u("span",{class:[I.chevron,n.value&&I.chevronOpen]},null,null,3,null),1,null),u("div",{ref:i},{class:I.comboBoxWrapper},[u("input",{ref:o},{type:"text",class:I.inputName,value:c(N=>N.value,[t],"p0.value"),placeholder:"Field Name","aria-label":"Field name (press Down Arrow for library)",onInput$:E,onKeyDown$:W,onFocus$:S("s_0IWX0Y3zQpc",[n])},null,3,null),n.value&&u("div",null,{class:I.dropdown,role:"listbox","aria-label":"Prefab field names",style:c(N=>({top:`${N.value.top}px`,left:`${N.value.left}px`,width:`${N.value.width}px`}),[f],"{top:`${p0.value.top}px`,left:`${p0.value.left}px`,width:`${p0.value.width}px`}")},et.map(N=>u("button",{onClick$:S("s_WB40vqhys98",[N,D])},{type:"button",class:I.dropdownItem,role:"option"},N,0,N)),1,"S1_0")],1,null),u("input",{ref:l},{type:"text",class:I.inputValue,value:c(N=>N.value,[a],"p0.value"),placeholder:"Value (optional)","aria-label":"Field value",onInput$:O,onKeyDown$:b},null,3,null)],1,null),u("div",null,{class:I.actions},[u("button",null,{type:"button",class:[I.actionButton,I.cancelButton],onClick$:w},"Cancel",3,null),u("button",null,{type:"button",class:I.actionButton,onClick$:y},"Save",3,null)],3,null)],1,"S1_1")},qn=$(d(Ln,"s_rgskcIH6ZDg")),Kn=()=>{const[e,t,a,n]=p(),o=n.nodeId,l=n.enabled;(t.value!==o||e.value!==l)&&(t.value=o,e.value=l,a.value++)},Qn=async()=>{const[e,t,a,n]=p();e.value&&(n.value=!0,a.value=await P().getFieldsForNode(t.value),n.value=!1)};function Gn(e){const t=_(null),a=_(!1),n=_(e.nodeId),o=_(e.enabled),l=_(0);G(d(Kn,"s_4i3R51gQIV8",[o,n,l,e]));const i=d(Qn,"s_7gfJWzE1Bug",[o,n,t,a]);return x(S("s_Ch3EXBvP4ag",[o,n,t,a,l,i])),{fields:t,isLoading:a,reload$:i}}const le=e=>`pendingFields:${e}`,Yn=(e,t)=>{try{t.length===0?localStorage.removeItem(le(e)):localStorage.setItem(le(e),JSON.stringify(t))}catch{}},zn=({track:e})=>{const[t,a]=p(),n=e(()=>t.value);typeof localStorage<"u"&&Yn(a.nodeId,n)},Xn=async()=>{const[e,t]=p(),a=t.maxPersistedCardOrder$.value,n=e.value.length>0?Math.max(...e.value.map(i=>i.cardOrder)):-1,o=Math.max(a,n)+1,l={id:Y(),fieldName:"",fieldValue:null,cardOrder:o};e.value=[...e.value,l]},Zn=async(e,t,a)=>{const[n,o]=p(),l=t.trim();if(!l){n.value=n.value.filter(s=>s.id!==e);return}const i=n.value.find(s=>s.id===e),f=i==null?void 0:i.cardOrder;await P().addField(o.nodeId,l,a,f),n.value=n.value.filter(s=>s.id!==e),q(),await o.onSaved$()},jn=e=>{const[t]=p();t.value=t.value.filter(a=>a.id!==e)},Jn=(e,t,a)=>{const[n]=p();n.value=n.value.map(o=>o.id===e?{...o,fieldName:t,fieldValue:a}:o)},ea=async()=>{const[e,t]=p(),a=e.value.filter(o=>o.fieldName.trim());if(a.length===0)return 0;const n=P();return await Promise.all(a.map(o=>n.addField(t.nodeId,o.fieldName.trim(),o.fieldValue,o.cardOrder))),e.value=[],q(),await t.onSaved$(),a.length};function ta(e){const t=_([]),a=_(!1);return x(S("s_qU68K91Z7fs",[t,a,e])),G(d(zn,"s_7EzmTvHmSgg",[t,e])),{forms:t,add$:d(Xn,"s_Biym0x2w2Hg",[t,e]),save$:d(Zn,"s_w000e3KQtXY",[t,e]),cancel$:d(jn,"s_tq0phclloKM",[t]),change$:d(Jn,"s_IrI7Myrn2Ko",[t]),saveAllPending$:d(ea,"s_CEglqaDCkrM",[t,e])}}const na="_fieldList_5uih9_5",aa="_addButton_5uih9_17",de={fieldList:na,addButton:aa},ce=30,oa=()=>{const[e]=p();return!e.fields.value||e.fields.value.length===0?-1:Math.max(...e.fields.value.map(t=>t.cardOrder))},la=()=>{const[e,t]=p(),a=[];if(t.fields.value)for(const n of t.fields.value)a.push({type:"persisted",field:n});for(const n of e.forms.value)a.push({type:"pending",form:n});return a.sort((n,o)=>{const l=n.type==="persisted"?n.field.cardOrder:n.form.cardOrder,i=o.type==="persisted"?o.field.cardOrder:o.form.cardOrder;return l-i}),a},da=()=>{const[e]=p();e.reload$()},ia=()=>{const[e]=p();e.forms.value.length<ce&&e.add$()},sa=e=>{const t=Gn({nodeId:e.nodeId,enabled:!0}),a=ae(d(oa,"s_09wqlr4vzW0",[t])),n=ta({nodeId:e.nodeId,onSaved$:t.reload$,initialFieldNames:e.initialFieldNames,maxPersistedCardOrder$:a});x(S("s_YFcoGOqtLXk",[n,e]));const o=ae(d(la,"s_vrtZqVijSkE",[n,t])),l=d(da,"s_XhGlu5hwbws",[t]),i=d(ia,"s_WITd5JAXm44",[n]),f=n.forms.value.length<ce;return u("div",null,{class:de.fieldList},[o.value.map(s=>(T(),s.type==="persisted"?g(hn,{get id(){return s.field.id},get fieldName(){return s.field.fieldName},get fieldValue(){return s.field.fieldValue},onDeleted$:l,[v]:{id:R(s.field,"id"),fieldName:R(s.field,"fieldName"),fieldValue:R(s.field,"fieldValue"),onDeleted$:v}},3,s.field.id):g(qn,{get id(){return s.form.id},get initialName(){return s.form.fieldName},get initialValue(){return s.form.fieldValue},onSave$:n.save$,onCancel$:n.cancel$,onChange$:n.change$,[v]:{id:R(s.form,"id"),initialName:R(s.form,"fieldName"),initialValue:R(s.form,"fieldValue")}},2,s.form.id))),u("button",{disabled:!f,"aria-label":f?"Add new field":"Maximum fields reached"},{type:"button",class:de.addButton,onClick$:i},"+ Add Field",3,null)],1,"Bt_0")},ue=$(d(sa,"s_2RnEZFWrgIk")),ra=e=>{const[t,a]=p();e==null||e.stopPropagation(),t.toggleCardExpanded$(a.id)},ca=e=>{const t=M(),a=H(),o=U.getDataCardState(t,e.id)==="EXPANDED",l=d(ra,"s_fJ0tmVx2bMU",[a,e]),i=`node-title-${e.id}`,f=!!e.onNodeClick$,s=e.nodeState==="PARENT",w=e.nodeState==="CHILD"?"18px":"50px";return u("div",{style:{"--datacard-indent":w}},{class:C.nodeWrapper},[g(ie,{get id(){return e.id},titleId:i,isExpanded:o,isParent:s,isClickable:f,get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,onExpand$:l,[v]:{id:c(h=>h.id,[e],"p0.id"),nodeName:c(h=>h.nodeName,[e],"p0.nodeName"),nodeSubtitle:c(h=>h.nodeSubtitle,[e],"p0.nodeSubtitle"),parentId:c(h=>h.parentId,[e],"p0.parentId"),onExpand$:v}},2,"vG_0"),g(se,{isOpen:o,get nodeId(){return e.id},children:g(ue,{get nodeId(){return e.id},[v]:{nodeId:c(h=>h.id,[e],"p0.id")}},3,"vG_1"),[v]:{nodeId:c(h=>h.id,[e],"p0.id")}},1,"vG_2")],1,"vG_3")},ua=$(d(ca,"s_06szQ6qXZeE")),pa=async()=>{var f,s,y,w,h,D;const[e,t,a,n]=p();e.value&&await e.value.saveAllPending$(),console.log("[handleCreate$] nameInputRef.value:",t.value),console.log("[handleCreate$] subtitleInputRef.value:",n.value),console.log("[handleCreate$] nameInputRef placeholder:",(f=t.value)==null?void 0:f.placeholder),console.log("[handleCreate$] subtitleInputRef placeholder:",(s=n.value)==null?void 0:s.placeholder),console.log("[handleCreate$] nameInputRef.value.value:",(y=t.value)==null?void 0:y.value),console.log("[handleCreate$] subtitleInputRef.value.value:",(w=n.value)==null?void 0:w.value);const o=document.querySelectorAll("input");console.log("[handleCreate$] All inputs on page:",o.length),o.forEach((E,O)=>{console.log(`[handleCreate$] Input ${O}: placeholder="${E.placeholder}", value="${E.value}"`)});const l=((h=t.value)==null?void 0:h.value)||"",i=((D=n.value)==null?void 0:D.value)||"";console.log("[handleCreate$] Final values - nodeName:",JSON.stringify(l),"nodeSubtitle:",JSON.stringify(i)),await a.onCreate$({nodeName:l,nodeSubtitle:i,fields:[]})},fa=e=>{const[t,a]=p();e.key==="Enter"?(e.preventDefault(),t()):e.key==="Escape"&&(e.preventDefault(),a.onCancel$())},va=e=>{const t=_(),a=_(),n=_(null);x(S("s_82IaKsCDbGY",[t]));const o=d(pa,"s_60fRKu4o7GU",[n,t,e,a]),l=d(fa,"s_ZHVlk1DFSAo",[o,e]),i=`node-title-${e.id}`,f=e.isChildConstruction?"18px":"50px";return u("div",{style:{"--datacard-indent":f}},{class:C.nodeWrapper},[g(ie,{get id(){return e.id},titleId:i,isExpanded:!0,isParent:!1,isClickable:!1,get nodeName(){return e.initialName||""},get nodeSubtitle(){return e.initialSubtitle||""},isConstruction:!0,nameInputRef:t,subtitleInputRef:a,onKeyDown$:l,chevronDisabled:!0,[v]:{id:c(s=>s.id,[e],"p0.id"),isExpanded:v,isParent:v,isClickable:v,nodeName:c(s=>s.initialName||"",[e],'p0.initialName||""'),nodeSubtitle:c(s=>s.initialSubtitle||"",[e],'p0.initialSubtitle||""'),isConstruction:v,nameInputRef:v,subtitleInputRef:v,onKeyDown$:v,chevronDisabled:v}},3,"qo_0"),g(se,{get nodeId(){return e.id},isOpen:!0,children:[g(ue,{get nodeId(){return e.id},initialFieldNames:tt,handleRef:n,[v]:{nodeId:c(s=>s.id,[e],"p0.id"),initialFieldNames:v,handleRef:v}},3,"qo_1"),u("div",{"q:slot":"actions"},{class:C.constructionActions},[u("button",{onClick$:e.onCancel$},{type:"button"},"Cancel",2,null),u("button",null,{type:"button",onClick$:o},"Create",3,null)],1,null)],[v]:{nodeId:c(s=>s.id,[e],"p0.id"),isOpen:v}},1,"qo_2")],1,"qo_3")},ya=$(d(va,"s_0HiZh00BXTo"));function _a(e){return e.nodeState==="UNDER_CONSTRUCTION"}const ga=e=>(T(),_a(e)?g(ya,{get id(){return e.id},get initialName(){return e.nodeName},get initialSubtitle(){return e.nodeSubtitle},get isChildConstruction(){return e.isChildConstruction},onCancel$:e.onCancel$,onCreate$:e.onCreate$,[v]:{id:c(t=>t.id,[e],"p0.id"),initialName:c(t=>t.nodeName,[e],"p0.nodeName"),initialSubtitle:c(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),isChildConstruction:c(t=>t.isChildConstruction,[e],"p0.isChildConstruction")}},2,"gq_0"):g(ua,{get id(){return e.id},get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get nodeState(){return e.nodeState},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,[v]:{id:c(t=>t.id,[e],"p0.id"),nodeName:c(t=>t.nodeName,[e],"p0.nodeName"),nodeSubtitle:c(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),nodeState:c(t=>t.nodeState,[e],"p0.nodeState"),parentId:c(t=>t.parentId,[e],"p0.parentId")}},2,"gq_1")),Q=$(d(ga,"s_gegngB44RHE")),ha="_createNode_194o9_5",wa="_createNodeChild_194o9_49",J={createNode:ha,createNodeChild:wa},ma=async()=>{const[e]=p();e.onClick$&&await e.onClick$()},Na=e=>{const t=d(ma,"s_m1x9adscB00",[e]);return e.variant==="root"?u("button",null,{type:"button",class:[J.createNode,"no-caret"],"aria-label":"Create New Asset",onClick$:t},"Create New Asset",3,"ad_0"):e.variant==="child"?u("button",null,{type:"button",class:[J.createNode,J.createNodeChild,"no-caret"],"aria-label":"Add Sub-Asset",onClick$:t},"+ Add Sub-Asset",3,"ad_1"):null},pe=$(d(Na,"s_0wYRrfEmCIE")),$a=async()=>{const[e,t]=p(),a=Y();await X().createEmptyNode(a,e.parentId),await t({id:a,parentId:e.parentId,nodeName:"",nodeSubtitle:"",defaultFields:[]})},ba=async()=>{const[e]=p();await e()},Ia=async e=>{const[t,a,n]=p();console.log("[complete$] Received payload:",JSON.stringify(e));const o=t.underConstruction;if(console.log("[complete$] ucData:",o),!o){console.log("[complete$] No ucData, returning early!");return}if(console.log("[complete$] Updating node",o.id,"with:",{nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||""}),await X().updateNode(o.id,{nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||""}),console.log("[complete$] Node updated, calling completeConstruction$"),e.fields.length>0){const l=P();await Promise.all(e.fields.map(i=>l.addField(o.id,i.fieldName,i.fieldValue)))}q(),await a(),console.log("[complete$] completeConstruction$ done, calling onCreated$"),await n.onCreated$(),console.log("[complete$] onCreated$ done, complete$ finished")};function fe(e){const t=M(),{startConstruction$:a,cancelConstruction$:n,completeConstruction$:o}=H(),l=d($a,"s_n6hsWUuIj1Y",[e,a]),i=d(ba,"s_cbiq6e5O6us",[n]),f=d(Ia,"s_v6yCRyJjgcY",[t,o,e]);return{ucNode:t.underConstruction,start$:l,cancel$:i,complete$:f}}const Ca=async()=>{const[e,t]=p();console.log("[useRootViewData] load$ called"),e.value=!0;try{const a=await X().getRootNodes();console.log("[useRootViewData] Fetched",a.length,"root nodes"),t.value=a,console.log("[useRootViewData] nodes.value set to",t.value.length,"nodes")}finally{e.value=!1}};function Sa(){const e=_([]),t=_(!1),a=d(Ca,"s_UIfphfAKvzM",[t,e]);return x(S("s_j2W4Hu2S1VQ",[a])),{nodes:e,isLoading:t,reload$:a}}const Da=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},Va=()=>{T();const e=M(),t=H(),a=Sa(),n=fe({parentId:null,onCreated$:a.reload$}),o=n.ucNode?a.nodes.value.filter(l=>l.id!==n.ucNode.id):a.nodes.value;return u("main",null,{class:"view-root"},[o.map(l=>g(Q,{get id(){return l.id},get nodeName(){return l.nodeName},nodeSubtitle:l.nodeSubtitle??"",nodeState:U.getDisplayNodeState(e,l.id),onNodeClick$:d(Da,"s_FBTGThmmG98",[t,l]),[v]:{id:R(l,"id"),nodeName:R(l,"nodeName")}},3,l.id)),n.ucNode?g(Q,{get id(){return n.ucNode.id},get nodeName(){return n.ucNode.nodeName},get nodeSubtitle(){return n.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",onCancel$:n.cancel$,onCreate$:n.complete$,[v]:{id:c(l=>l.ucNode.id,[n],"p0.ucNode.id"),nodeName:c(l=>l.ucNode.nodeName,[n],"p0.ucNode.nodeName"),nodeSubtitle:c(l=>l.ucNode.nodeSubtitle,[n],"p0.ucNode.nodeSubtitle"),nodeState:v}},2,n.ucNode.id):null,g(pe,{variant:"root",onClick$:n.start$,[v]:{variant:v}},2,"7G_0")],1,"7G_1")},Ea=$(d(Va,"s_hNvYX6tEL2I")),Aa=async e=>{const[t,a,n,o,l]=p();if(e){t.underConstruction&&a(),o.value=!0;try{const i=await X().getNodeWithChildren(e);l.value=i.node,n.value=i.children}finally{o.value=!1}}};function Ra(){const e=_(null),t=_([]),a=_(!1),n=M(),{cancelConstruction$:o}=H(),l=d(Aa,"s_cbTnqvcou0A",[n,o,t,a,e]);return{parentNode:e,children:t,isLoading:a,load$:l,reload$:l}}const Fa=async({track:e})=>{const[t,a]=p(),n=e(()=>a.parentId);n&&await t.load$(n)},Oa=async()=>{const[e,t]=p();await e.reload$(t.parentId)},ka=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},Ba=e=>{T();const t=H(),a=Ra();G(d(Fa,"s_yRk2iqAjgFI",[a,e])),x(S("s_YSvpaIwIZ9w",[a,e]));const n=fe({parentId:e.parentId,onCreated$:d(Oa,"s_02bEtWr042Y",[a,e])});return a.isLoading.value||!a.parentNode.value?u("main",null,{class:"view-branch"},"Loading...",3,"RT_0"):u("main",null,{class:"view-branch"},[u("div",null,{class:"branch-parent-row"},u("div",null,{class:"branch-parent-node"},g(Q,{get id(){return a.parentNode.value.id},get nodeName(){return a.parentNode.value.nodeName},get nodeSubtitle(){return a.parentNode.value.nodeSubtitle??""},nodeState:"PARENT",get parentId(){return a.parentNode.value.parentId},onNavigateUp$:t.navigateUp$,[v]:{id:c(o=>o.parentNode.value.id,[a],"p0.parentNode.value.id"),nodeName:c(o=>o.parentNode.value.nodeName,[a],"p0.parentNode.value.nodeName"),nodeSubtitle:c(o=>o.parentNode.value.nodeSubtitle??"",[a],'p0.parentNode.value.nodeSubtitle??""'),nodeState:v,parentId:c(o=>o.parentNode.value.parentId,[a],"p0.parentNode.value.parentId")}},2,a.parentNode.value.id),1,null),1,null),u("div",null,{class:"branch-children"},[a.children.value.filter(o=>!n.ucNode||o.id!==n.ucNode.id).map(o=>g(Q,{get id(){return o.id},get nodeName(){return o.nodeName},nodeSubtitle:o.nodeSubtitle??"",nodeState:"CHILD",onNodeClick$:d(ka,"s_ubVdAKhHRM8",[t,o]),[v]:{id:R(o,"id"),nodeName:R(o,"nodeName"),nodeState:v}},3,o.id)),n.ucNode?u("div",null,{class:"branch-child-row"},g(Q,{get id(){return n.ucNode.id},get nodeName(){return n.ucNode.nodeName},get nodeSubtitle(){return n.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",isChildConstruction:!0,onCancel$:n.cancel$,onCreate$:n.complete$,[v]:{id:c(o=>o.ucNode.id,[n],"p0.ucNode.id"),nodeName:c(o=>o.ucNode.nodeName,[n],"p0.ucNode.nodeName"),nodeSubtitle:c(o=>o.ucNode.nodeSubtitle,[n],"p0.ucNode.nodeSubtitle"),nodeState:v,isChildConstruction:v}},2,n.ucNode.id),1,"RT_1"):null,g(pe,{variant:"child",onClick$:n.start$,[v]:{variant:v}},2,"RT_2")],1,null)],1,"RT_3")},Ta=$(d(Ba,"s_gIJMeo2tapw")),xa=()=>{T();const e=M(),t=U.isRootView(e),a=U.getCurrentNodeId(e);return t?g(Ea,null,3,"sJ_0"):g(Ta,{parentId:a},3,"sJ_1")},Pa=$(d(xa,"s_yh0RYmyrFWk")),Wa=Object.freeze(Object.defineProperty({__proto__:null,default:Pa},Symbol.toStringTag,{value:"Module"})),Ua=[],Ma=[["/",[()=>Wa],"/",[]]],Ha=[],La=!0,qa="/",Ka=!0,Ya={routes:Ma,serverPlugins:Ua,menus:Ha,trailingSlash:La,basePathname:qa,cacheModules:Ka};export{qa as basePathname,Ka as cacheModules,Ya as default,Ha as menus,Ma as routes,Ua as serverPlugins,La as trailingSlash};
