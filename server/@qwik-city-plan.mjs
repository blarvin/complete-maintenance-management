import{c as w,i as d,_ as i,a as u,b as E,u as y,d as p,e as U,f as g,g as f,F as ue,S as ie,h as c,j as L,k as W,l as M,m as Z,n as Oe,o as Fe,p as pe,q as B}from"./q-CO9zMnX9.js";import"firebase/firestore";const ke="_nodeWrapper_1jgt8_4",Be="_nodeHeader_1jgt8_8",Te="_nodeHeaderExpanded_1jgt8_18",xe="_nodeHeaderContent_1jgt8_20",Pe="_nodeHeaderParent_1jgt8_29",Ue="_upButtonWrapper_1jgt8_35",We="_nodeHeaderContentClickable_1jgt8_44",Me="_nodeTitle_1jgt8_48",qe="_nodeSubtitle_1jgt8_63",He="_nodeButtons_1jgt8_84",Le="_nodeChevron_1jgt8_95",Ke="_constructionActions_1jgt8_132",C={nodeWrapper:ke,nodeHeader:Be,nodeHeaderExpanded:Te,nodeHeaderContent:xe,nodeHeaderParent:Pe,upButtonWrapper:Ue,nodeHeaderContentClickable:We,nodeTitle:Me,nodeSubtitle:qe,nodeButtons:He,nodeChevron:Le,constructionActions:Ke},Qe=e=>i("h2",null,{class:C.nodeTitle,id:u(t=>t.id,[e],"p0.id")},u(t=>t.nodeName,[e],"p0.nodeName"),3,"Th_0"),Ge=w(d(Qe,"s_DVVkpy7hRQQ")),ze=e=>i("div",null,{class:C.nodeSubtitle},u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),3,"ld_0"),Ye=w(d(ze,"s_BPVk0Y80MRc")),Xe="_upButton_1crd4_5",je={upButton:Xe},Ze=e=>i("button",null,{class:je.upButton,title:u(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),"aria-label":u(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),onClick$:E("s_zrBmdNlvcAw",[e])},"↑",3,"BX_0"),Je=w(d(Ze,"s_zKD01KoPOyE")),et=280,tt=6,nt=(e,t)=>{const[a,n,o,l,s]=p(),_=Date.now(),r=_-a.value<=s,v=Math.abs(e-n.value),m=Math.abs(t-o.value),$=v<=l&&m<=l,D=r&&$;return a.value=_,n.value=e,o.value=t,D};function ve(e={}){const t=e.thresholdMs??et,a=e.slopPx??tt,n=y(0),o=y(0),l=y(0);return{checkDoubleTap$:d(nt,"s_Ex0CzuR1b0c",[n,o,l,a,t])}}const at="_ellipsisButton_wduwl_5",ot={ellipsisButton:at},lt=async e=>{const[t,a]=p();if(e.stopPropagation(),!a.onDoubleTap$)return;await t.checkDoubleTap$(e.clientX,e.clientY)&&a.onDoubleTap$()},dt=e=>{e.stopPropagation()},it=e=>{const[t]=p();t.onDoubleTap$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onDoubleTap$())},st=e=>{const t=ve(),a=d(lt,"s_ATxTfk20r0g",[t,e]),n=d(dt,"s_tJe2uV5Pw0E"),o=d(it,"s_6MiwcH1V1j4",[e]);return i("button",null,{type:"button",class:ot.ellipsisButton,"aria-expanded":u(l=>l.isExpanded,[e],"p0.isExpanded"),"aria-label":u(l=>l.isExpanded?"Collapse node details":"Expand node details",[e],'p0.isExpanded?"Collapse node details":"Expand node details"'),onPointerDown$:a,onClick$:n,onKeyDown$:o},"⋮",3,"9s_0")},rt=w(d(st,"s_1dOBjfw6Fqo")),ct=e=>{const[t]=p();t.onNodeClick$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.onNodeClick$())},ut=e=>{const[t]=p();t.onExpand$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onExpand$())},pt=e=>{U();const t=d(ct,"s_Eo0egbDYOnc",[e]),a=d(ut,"s_9BqTWe0Vch0",[e]);return i("article",{class:[C.nodeHeader,e.isExpanded&&C.nodeHeaderExpanded,e.isParent&&C.nodeHeaderParent]},{"aria-labelledby":u(n=>n.titleId,[e],"p0.titleId"),"data-node-id":u(n=>n.id,[e],"p0.id")},i("div",{class:[C.nodeHeaderContent,e.isClickable&&C.nodeHeaderContentClickable,e.isClickable&&"no-caret"],onClick$:e.onNodeClick$,onKeyDown$:t},{role:u(n=>n.isClickable?"button":void 0,[e],'p0.isClickable?"button":undefined'),tabIndex:u(n=>n.isClickable?0:void 0,[e],"p0.isClickable?0:undefined"),"aria-label":u(n=>n.isClickable?`Open ${n.nodeName||"node"}`:void 0,[e],'p0.isClickable?`Open ${p0.nodeName||"node"}`:undefined')},[e.isParent&&e.onNavigateUp$&&i("div",null,{class:C.upButtonWrapper},g(Je,{get parentId(){return e.parentId??null},onNavigate$:e.onNavigateUp$,[f]:{parentId:u(n=>n.parentId??null,[e],"p0.parentId??null")}},2,"pa_0"),1,"pa_1"),i("div",null,null,e.isConstruction?g(ue,{children:[i("input",{ref:e.nameInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeTitle,placeholder:"Name","aria-label":"Node name",id:u(n=>n.titleId,[e],"p0.titleId")},null,2,null),i("input",{ref:e.subtitleInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeSubtitle,placeholder:"Subtitle / Location / Short description","aria-label":"Node subtitle"},null,2,null)]},1,"pa_2"):g(ue,{children:[g(Ge,{get nodeName(){return e.nodeName},get id(){return e.titleId},[f]:{nodeName:u(n=>n.nodeName,[e],"p0.nodeName"),id:u(n=>n.titleId,[e],"p0.titleId")}},3,"pa_3"),g(Ye,{get nodeSubtitle(){return e.nodeSubtitle},[f]:{nodeSubtitle:u(n=>n.nodeSubtitle,[e],"p0.nodeSubtitle")}},3,"pa_4")]},1,"pa_5"),1,null),i("div",null,{class:C.nodeButtons},[g(rt,{onDoubleTap$:e.onDetailsToggle$,get isExpanded(){return e.isDetailsExpanded},[f]:{isExpanded:u(n=>n.isDetailsExpanded,[e],"p0.isDetailsExpanded")}},2,"pa_6"),i("button",{onClick$:e.onExpand$,onKeyDown$:a},{type:"button",class:C.nodeChevron,"aria-expanded":u(n=>n.isExpanded,[e],"p0.isExpanded"),"aria-label":u(n=>n.isExpanded?"Collapse details":"Expand details",[e],'p0.isExpanded?"Collapse details":"Expand details"'),disabled:u(n=>n.chevronDisabled,[e],"p0.chevronDisabled")},u(n=>n.isExpanded?"▾":"◂",[e],'p0.isExpanded?"▾":"◂"'),2,null)],1,null)],0,null),1,"pa_7")},ye=w(d(pt,"s_xWTLD5hOIvU")),ft="_wrapper_10kg1_7",_t="_wrapperOpen_10kg1_47",vt="_inner_10kg1_57",yt="_datacard_10kg1_71",gt="_datacardOpen_10kg1_103",Y={wrapper:ft,wrapperOpen:_t,inner:vt,datacard:yt,datacardOpen:gt},mt=e=>i("div",{class:[Y.wrapper,e.isOpen&&Y.wrapperOpen]},null,i("div",null,{class:Y.inner},i("div",{class:[Y.datacard,e.isOpen&&Y.datacardOpen,"no-caret"]},{role:"region","aria-label":"Node details"},[g(ie,null,3,"9y_0"),g(ie,{name:"actions",[f]:{name:f}},3,"9y_1")],1,null),1,null),1,"9y_2"),ge=w(d(mt,"s_L7oO92ZEh6A"));function J(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}const re=new Map;function z(e){re.set(e.id,e)}function x(e){re.delete(e)}function ht(e){const t=[],a=new Set;let n=e;for(;n&&!a.has(n);){a.add(n);const o=re.get(n);if(!o)break;t.unshift({id:o.id,name:o.nodeName}),n=o.parentId}return t}function fe(e){return e.filter(t=>t.deletedAt===null)}function ae(e){return e.filter(t=>t.deletedAt!==null)}const wt="localUser",Nt=["Description","Type Of","Tags","Location","Serial Number","Part Number","Manufacturer","Model","Status","Installed Date","Weight","Dimensions","Power Rating","Current Reading","Note"],$t=["Type Of","Description","Tags"];function T(){return wt}const k=()=>Date.now(),bt=e=>new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"});function oe(e){const{dataFieldId:t,parentNodeId:a,action:n,prevValue:o,newValue:l,rev:s}=e;return{id:`${t}:${s}`,dataFieldId:t,parentNodeId:a,action:n,property:"fieldValue",prevValue:o,newValue:l,updatedBy:T(),updatedAt:k(),rev:s}}function It(e,t,a){const n=new Error(t);return n.code=e,n.retryable=a==null?void 0:a.retryable,n.details=a==null?void 0:a.details,n.cause=a==null?void 0:a.cause,n}function N(e,t=!0){return{data:e,meta:{adapter:"idb",fromCache:t}}}class Ct{async listRootNodes(){const a=(await c.nodes.toArray()).filter(n=>n.parentId===null&&n.deletedAt===null);return a.sort((n,o)=>n.updatedAt-o.updatedAt),N(a)}async getNode(t){const a=await c.nodes.get(t);return N(a??null)}async listChildren(t){const a=await c.nodes.where("parentId").equals(t).toArray(),n=fe(a);return n.sort((o,l)=>o.updatedAt-l.updatedAt),N(n)}async createNode(t){const a=k(),n=T(),o={id:t.id,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle,parentId:t.parentId,updatedBy:n,updatedAt:a,deletedAt:null};return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.put(o),await this.enqueueSyncOperation({operation:"create-node",entityType:"node",entityId:o.id,payload:o})}),console.log("[IDBAdapter] Node created in IDB:",o.id,o.nodeName),z({id:o.id,parentId:o.parentId,nodeName:o.nodeName}),N(o)}async updateNode(t,a){const n=k(),o=T();return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{...a,updatedBy:o,updatedAt:n});const l=await c.nodes.get(t);l?(await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:l}),l.deletedAt===null?z({id:l.id,parentId:l.parentId,nodeName:l.nodeName}):x(t)):x(t)}),console.log("[IDBAdapter] Node updated in IDB:",t),N(void 0)}async deleteNode(t,a){const n=k(),o=T();return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{deletedAt:n,updatedAt:n,updatedBy:o});const l=await c.nodes.get(t);l&&await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:l})}),console.log("[IDBAdapter] Node soft-deleted in IDB:",t),x(t),N(void 0)}async listFields(t){const a=await c.fields.where("parentNodeId").equals(t).toArray(),n=fe(a);return n.sort((o,l)=>o.cardOrder-l.cardOrder),N(n)}async nextCardOrder(t){const a=await c.fields.where("parentNodeId").equals(t).toArray();if(a.length===0)return N(0);const n=Math.max(...a.map(o=>o.cardOrder));return N(n+1)}async createField(t){const a=k(),n=T(),o=t.cardOrder??(await this.nextCardOrder(t.parentNodeId)).data,l={id:t.id,fieldName:t.fieldName,fieldValue:t.fieldValue,parentNodeId:t.parentNodeId,cardOrder:o,updatedBy:n,updatedAt:a,deletedAt:null};return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.put(l);const s=await this.nextRev(l.id),_=oe({dataFieldId:l.id,parentNodeId:l.parentNodeId,action:"create",prevValue:null,newValue:l.fieldValue,rev:s});await c.history.put(_),await this.enqueueSyncOperation({operation:"create-field",entityType:"field",entityId:l.id,payload:l}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:_.id,payload:_})}),console.log("[IDBAdapter] Field created in IDB:",l.id,l.fieldName),N(l)}async updateFieldValue(t,a){const n=await c.fields.get(t);if(!n)throw It("not-found","Field not found",{retryable:!1});const o=k(),l=T();return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.update(t,{fieldValue:a.fieldValue,updatedAt:o,updatedBy:l});const s=await this.nextRev(t),_=oe({dataFieldId:t,parentNodeId:n.parentNodeId,action:"update",prevValue:n.fieldValue,newValue:a.fieldValue,rev:s});await c.history.put(_);const r=await c.fields.get(t);r&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:r}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:_.id,payload:_})}),console.log("[IDBAdapter] Field updated in IDB:",t,a.fieldValue),N(void 0)}async deleteField(t){const a=await c.fields.get(t);if(!a)return N(void 0);const n=k(),o=T();return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.update(t,{deletedAt:n,updatedAt:n,updatedBy:o});const l=await this.nextRev(t),s=oe({dataFieldId:t,parentNodeId:a.parentNodeId,action:"delete",prevValue:a.fieldValue,newValue:null,rev:l});await c.history.put(s);const _=await c.fields.get(t);_&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:_}),await this.enqueueSyncOperation({operation:"create-history",entityType:"field-history",entityId:s.id,payload:s})}),console.log("[IDBAdapter] Field soft-deleted in IDB:",t),N(void 0)}async getFieldHistory(t){const a=await c.history.where("dataFieldId").equals(t).toArray();return a.sort((n,o)=>n.rev-o.rev),N(a)}async listDeletedNodes(){const t=await c.nodes.toArray(),a=ae(t);return a.sort((n,o)=>(o.deletedAt??0)-(n.deletedAt??0)),N(a)}async listDeletedChildren(t){const a=await c.nodes.where("parentId").equals(t).toArray(),n=ae(a);return n.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),N(n)}async restoreNode(t){const a=k(),n=T();return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{deletedAt:null,updatedAt:a,updatedBy:n});const o=await c.nodes.get(t);o&&(await this.enqueueSyncOperation({operation:"update-node",entityType:"node",entityId:t,payload:o}),o.deletedAt===null?z({id:o.id,parentId:o.parentId,nodeName:o.nodeName}):x(t))}),console.log("[IDBAdapter] Node restored in IDB:",t),N(void 0)}async listDeletedFields(t){const a=await c.fields.where("parentNodeId").equals(t).toArray(),n=ae(a);return n.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),N(n)}async restoreField(t){const a=k(),n=T();return await c.transaction("rw",c.fields,c.syncQueue,async()=>{await c.fields.update(t,{deletedAt:null,updatedAt:a,updatedBy:n});const o=await c.fields.get(t);o&&await this.enqueueSyncOperation({operation:"update-field",entityType:"field",entityId:t,payload:o})}),console.log("[IDBAdapter] Field restored in IDB:",t),N(void 0)}async getSyncQueue(){const t=await c.syncQueue.where("status").equals("pending").toArray();return t.sort((a,n)=>a.timestamp-n.timestamp),t}async markSynced(t){await c.syncQueue.delete(t)}async markFailed(t,a){const n=await c.syncQueue.get(t);n&&await c.syncQueue.update(t,{status:"failed",retryCount:n.retryCount+1,lastError:(a==null?void 0:a.message)||String(a)})}async getLastSyncTimestamp(){const t=await c.syncMetadata.get("lastSyncTimestamp");return(t==null?void 0:t.value)??0}async setLastSyncTimestamp(t){await c.syncMetadata.put({key:"lastSyncTimestamp",value:t})}async applyRemoteUpdate(t,a){if(t==="node"){const n=a;await c.nodes.put(n),n.deletedAt===null?z({id:n.id,parentId:n.parentId,nodeName:n.nodeName}):x(n.id)}else await c.fields.put(a)}async getAllNodes(){return await c.nodes.toArray()}async getAllFields(){return await c.fields.toArray()}async getAllHistory(){return await c.history.toArray()}async applyRemoteHistory(t){await c.history.put(t)}async deleteNodeLocal(t){await c.nodes.delete(t),x(t)}async deleteFieldLocal(t){await c.fields.delete(t)}async nextRev(t){const a=await c.history.where("dataFieldId").equals(t).toArray();return a.length===0?0:Math.max(...a.map(o=>o.rev))+1}async enqueueSyncOperation(t){const a={id:J(),operation:t.operation,entityType:t.entityType,entityId:t.entityId,payload:t.payload,timestamp:k(),status:"pending",retryCount:0};await c.syncQueue.put(a)}}const me=new Ct,Dt=Et(me),St=Vt(me);function O(e){return e.data}function X(e){return e&&(e.deletedAt===null?z({id:e.id,parentId:e.parentId,nodeName:e.nodeName}):x(e.id),e)}function le(e){return e.forEach(X),e}function Et(e){return{getRootNodes:async()=>le(O(await e.listRootNodes())),getNodeById:async t=>X(O(await e.getNode(t))),getNodeWithChildren:async t=>{const[a,n]=await Promise.all([e.getNode(t),e.listChildren(t)]);return{node:X(O(a)),children:le(O(n))}},getChildren:async t=>le(O(await e.listChildren(t))),createWithFields:async t=>{await e.createNode({id:t.id,parentId:t.parentId,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle}),z({id:t.id,parentId:t.parentId,nodeName:t.nodeName}),await Promise.all(t.defaults.map(a=>e.createField({id:J(),parentNodeId:t.id,fieldName:a.fieldName,fieldValue:a.fieldValue})))},createEmptyNode:async(t,a)=>{const n=O(await e.createNode({id:t,parentId:a,nodeName:"",nodeSubtitle:""}));return X(n),n},updateNode:async(t,a)=>{await e.updateNode(t,a);const n=O(await e.getNode(t));X(n)},deleteNode:async t=>{console.log("[NodeService] Deleting node:",t),await e.deleteNode(t),x(t)}}}function Vt(e){return{getFieldsForNode:async t=>O(await e.listFields(t)),nextCardOrder:async t=>O(await e.nextCardOrder(t)),addField:async(t,a,n,o)=>O(await e.createField({id:J(),parentNodeId:t,fieldName:a,fieldValue:n,cardOrder:o})),updateFieldValue:async(t,a)=>{await e.updateFieldValue(t,{fieldValue:a})},deleteField:async t=>{await e.deleteField(t)},getFieldHistory:async t=>O(await e.getFieldHistory(t))}}let At=Dt,Rt=St;function te(){return At}function K(){return Rt}const P={getTreeNodeState:(e,t,a)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t?"UNDER_CONSTRUCTION":e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD"},getDisplayNodeState:(e,t)=>e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD",getDataCardState:(e,t)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t?"UNDER_CONSTRUCTION":e.ui.expandedCards.has(t)?"EXPANDED":"COLLAPSED"},getDataFieldState:(e,t)=>e.editingFieldId===t?"EDITING":"DISPLAY",getDataFieldDetailsState:(e,t)=>e.ui.expandedFieldDetails.has(t)?"EXPANDED":"COLLAPSED",getNodeDetailsState:(e,t)=>e.ui.expandedNodeDetails.has(t)?"EXPANDED":"COLLAPSED",isRootView:e=>e.view.state==="ROOT",getCurrentNodeId:e=>e.view.state==="BRANCH"?e.view.nodeId:null,isUnderConstruction:(e,t)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t}};function Ot(e,t){throw new Error("SyncManager not initialized. Call getSyncManager with adapters first.")}const Ft=500;let ee=null;function Q(){ee!==null&&clearTimeout(ee),ee=setTimeout(()=>{ee=null,Ot().syncDelta().catch(e=>console.error("[triggerSync] Sync failed:",e))},Ft)}const kt=({track:e,cleanup:t})=>{const[a,n,o,l]=p(),_=e(()=>a.editingFieldId)===l.fieldId;o.value!==null&&(clearTimeout(o.value),o.value=null),_&&(o.value=window.setTimeout(()=>{if(a.editingFieldId===l.fieldId&&n.value){const r=n.value,v=r.value.length;r.focus(),r.setSelectionRange(v,v)}o.value=null},10)),t(()=>{o.value!==null&&(clearTimeout(o.value),o.value=null)})},Bt=e=>{const[t,a,n,o,l,s]=p();if(t.editingFieldId!==o.fieldId)return;const _=l.value,r=e.target;_&&r&&!_.contains(r)&&(s(),n.value=a.value)},Tt=()=>{const[e,t,a,n,o,l]=p();e.editingFieldId!==n.fieldId&&(l(n.fieldId),a.value=t.value,o.value=null)},xt=async()=>{const[e,t,a,n,o]=p();if(e.editingFieldId!==n.fieldId)return;const l=a.value.trim()===""?null:a.value;await K().updateFieldValue(n.fieldId,l),t.value=l??"",o(),Q(),n.onUpdated$&&await n.onUpdated$()},Pt=()=>{const[e,t,a,n,o]=p();e.editingFieldId===n.fieldId&&(o(),a.value=t.value)},Ut=e=>{const[t]=p();t.value=e},Wt=()=>{const[e,t,a,n,o,l]=p();Date.now()<l.value||e.editingFieldId===n.fieldId&&(o(),a.value=t.value)},Mt=e=>{const[t,a]=p();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"&&(e.preventDefault(),t())},qt=async e=>{const[t,a,n,o,l]=p();if(t.editingFieldId!==n.fieldId)return;const s=e.clientX??0,_=e.clientY??0;l.value=Date.now()+220,await a(s,_)&&await o()},Ht=async e=>{const[t,a,n,o]=p();if(t.editingFieldId===o.fieldId)return;const l=e.clientX??0,s=e.clientY??0;await n(l,s)&&await a()},Lt=e=>{const[t,a,n]=p();t.editingFieldId!==n.fieldId&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),a())},Kt=e=>{const[t]=p();t.value=e},Qt=()=>{const[e]=p();e.value=null},Gt=async e=>{const[t,a,n]=p();await K().updateFieldValue(a.fieldId,e),t.value=e??"",n.value=null,Q(),a.onUpdated$&&await a.onUpdated$()};function zt(e){const t=L(),{startFieldEdit$:a,stopFieldEdit$:n}=W(),l=P.getDataFieldState(t,e.fieldId)==="EDITING",s=y(),_=y(),r=y(e.initialValue??""),v=y(""),m=y(null),$=y(0),D=y(null),{checkDoubleTap$:V}=ve();M(E("s_Tjhab5vyHfo",[r,e])),Z(d(kt,"s_RbAuVMmGAmw",[t,_,D,e])),Oe("pointerdown",d(Bt,"s_StU06vsCz00",[t,r,v,e,s,n]));const R=d(Tt,"s_0HO9EPvGwSc",[t,r,v,e,m,a]),h=d(xt,"s_TpCFgZeU6Vk",[t,r,v,e,n]),I=d(Pt,"s_dsRT43um7vE",[t,r,v,e,n]),ne=d(Ut,"s_43FZb0QGfSU",[v]),b=d(Wt,"s_WWaKkyE000c",[t,r,v,e,n,$]),be=d(Mt,"s_8yy0Fab0FzY",[I,h]),Ie=d(qt,"s_dSOqRahu9fY",[t,V,e,h,$]),Ce=d(Ht,"s_DkvtW0NQyBE",[t,R,V,e]),De=d(Lt,"s_cmRnDo37yA8",[t,R,e]),Se=d(Kt,"s_edkN78Zq06w",[m]),Ee=d(Qt,"s_Ax8A0n67Fek",[m]),Ve=d(Gt,"s_85DxwQYAcGo",[r,e,m]),ce=m.value!==null?m.value:r.value,Ae=!!ce,Re=m.value!==null;return{isEditing:l,displayValue:ce,isPreviewActive:Re,hasValue:Ae,editValue:v,editInputRef:_,rootRef:s,beginEdit$:R,save$:h,cancel$:I,valuePointerDown$:Ce,valueKeyDown$:De,inputPointerDown$:Ie,inputBlur$:b,inputKeyDown$:be,inputChange$:ne,setPreview$:Se,revert$:Ve,clearPreview$:Ee}}const Yt="_historyWrapper_163sz_5",Xt="_historyList_163sz_17",jt="_historyRow_163sz_41",Zt="_historyRowSelected_163sz_99",Jt="_historyValue_163sz_117",en="_historyMeta_163sz_131",G={historyWrapper:Yt,historyList:Xt,historyRow:jt,historyRowSelected:Zt,historyValue:Jt,historyMeta:en},tn=e=>{const[t,a]=p();a.value=e.rev,t.onPreviewChange$(e.newValue)},nn=e=>{const t=y(null),a=[...e.history].reverse(),n=d(tn,"s_BJVayUaFz28",[e,t]),o=s=>{const _=new Date(s),r=_.getDate().toString().padStart(2,"0"),v=(_.getMonth()+1).toString().padStart(2,"0"),m=_.getFullYear(),$=_.getHours().toString().padStart(2,"0"),D=_.getMinutes().toString().padStart(2,"0");return`${r}/${v}/${m}, ${$}:${D}`},l=e.history.length>0;return i("div",null,{class:[G.historyWrapper,"no-caret"]},e.isOpen&&l&&i("div",null,{class:[G.historyList,"no-caret"],role:"listbox","aria-label":"Field value history"},a.map(s=>i("button",{class:[G.historyRow,t.value===s.rev&&G.historyRowSelected],"aria-selected":t.value===s.rev,onClick$:E("s_MsJX096CMQc",[s,n])},{type:"button",role:"option"},[i("span",null,{class:G.historyValue},s.newValue||i("em",null,null,"Empty",3,"MV_0"),1,null),i("span",null,{class:G.historyMeta},[o(s.updatedAt),"  by ",Fe(s,"updatedBy")],1,null)],0,s.id)),1,"MV_1"),1,"MV_2")},an=w(d(nn,"s_JOaqQ6mNgM0")),on="_inlineWrapper_g7gtr_7",ln="_spacer_g7gtr_19",dn="_buttonGroup_g7gtr_29",sn="_cancelButton_g7gtr_43",rn="_revertButton_g7gtr_91",cn="_metadata_g7gtr_141",un="_historyChevron_g7gtr_161",pn="_actionsRow_g7gtr_221",fn="_deleteButton_g7gtr_233",_n="_historyRow_g7gtr_279",F={inlineWrapper:on,spacer:ln,buttonGroup:dn,cancelButton:sn,revertButton:rn,metadata:cn,historyChevron:un,actionsRow:pn,deleteButton:fn,historyRow:_n},vn=()=>{const[e]=p();e.onDelete$()},yn=e=>{const[t,a]=p();a.value=e,t.onPreviewChange$(e)},gn=async()=>{const[e,t,a,n]=p();if(n.value!==null){await a.onRevert$(n.value);try{const o=await K().getFieldHistory(a.fieldId);e.value=o}catch(o){console.error("Failed to reload field history:",o)}n.value=null,t.value=!1}},mn=()=>{const[e,t,a]=p();e.value=!e.value,e.value||(a.value=null,t.onPreviewChange$(null))},hn=()=>{const[e,t,a]=p();a.value=null,t.onPreviewChange$(null),e.value=!1},wn=e=>{U();const t=y([]),a=y(!1),n=y(!1),o=y(null);M(E("s_R1kXqMQvJ9E",[t,a,e]));const l=d(vn,"s_0bgQ1zoSedw",[e]),s=d(yn,"s_zD3B0y4fHO0",[e,o]),_=d(gn,"s_3k04NU4DZf8",[t,n,e,o]),r=d(mn,"s_QoNOrZ0E02s",[n,e,o]),v=t.value.length>0?t.value[t.value.length-1]:null,m=v!=null&&v.updatedAt?bt(v.updatedAt):"",$=(v==null?void 0:v.updatedBy)??"",D=a.value&&m?`${m}  ${$}`:"...",V=t.value.length>0,R=o.value!==null,h=d(hn,"s_Mi0Kr02WGGA",[n,e,o]);return i("div",null,{class:[F.inlineWrapper,"no-caret"]},[R?i("span",null,{class:F.buttonGroup},[i("button",null,{type:"button",class:F.cancelButton,"aria-label":"Cancel selection",onClick$:h},"CANCEL",3,null),i("button",null,{type:"button",class:F.revertButton,"aria-label":"Revert to selected value",onClick$:_},"REVERT",3,null)],3,"dk_0"):i("span",null,{class:[F.spacer,"no-caret"]},null,3,null),i("span",null,{class:[F.metadata,"no-caret"]},D,1,null),i("button",{disabled:!V,title:V?"View field history":"No history available"},{type:"button",class:F.historyChevron,"aria-expanded":u(I=>I.value,[n],"p0.value"),"aria-label":u(I=>I.value?"Close field history":"Open field history",[n],'p0.value?"Close field history":"Open field history"'),onClick$:r},u(I=>I.value?"▾":"◂",[n],'p0.value?"▾":"◂"'),3,null),n.value&&V&&i("div",null,{class:[F.historyRow,"no-caret"]},g(an,{get fieldId(){return e.fieldId},get history(){return t.value},get isOpen(){return n.value},onToggle$:r,onPreviewChange$:s,[f]:{fieldId:u(I=>I.fieldId,[e],"p0.fieldId"),history:u(I=>I.value,[t],"p0.value"),isOpen:u(I=>I.value,[n],"p0.value"),onToggle$:f,onPreviewChange$:f}},3,"dk_1"),1,"dk_2"),i("div",null,{class:[F.actionsRow,"no-caret"]},i("button",null,{type:"button",class:F.deleteButton,"aria-label":"Delete this field",onClick$:l},"Delete Field",3,null),3,null)],1,"dk_3")},Nn=w(d(wn,"s_cNXlVpCg5og")),$n="_datafieldWrapper_pusyg_5",bn="_datafieldWrapperExpanded_pusyg_21",In="_datafield_pusyg_5",Cn="_datafieldChevron_pusyg_117",Dn="_datafieldLabel_pusyg_163",Sn="_datafieldValue_pusyg_175",En="_datafieldValueUnderlined_pusyg_183",Vn="_datafieldValueEditable_pusyg_193",An="_datafieldPlaceholder_pusyg_235",Rn="_datafieldValuePreview_pusyg_247",A={datafieldWrapper:$n,datafieldWrapperExpanded:bn,datafield:In,datafieldChevron:Cn,datafieldLabel:Dn,datafieldValue:Sn,datafieldValueUnderlined:En,datafieldValueEditable:Vn,datafieldPlaceholder:An,datafieldValuePreview:Rn},On=()=>{const[e,t,a,n]=p(),o=P.getDataFieldDetailsState(e,n.id)==="EXPANDED";t.toggleFieldDetailsExpanded$(n.id),o&&a.clearPreview$()},Fn=async()=>{const[e]=p();await K().deleteField(e.id),Q(),e.onDeleted$&&e.onDeleted$()},kn=e=>{U();const t=L(),a=W(),o=P.getDataFieldDetailsState(t,e.id)==="EXPANDED",l=zt({fieldId:e.id,initialValue:e.fieldValue,onUpdated$:e.onUpdated$}),s=d(On,"s_wqZYmXF10hc",[t,a,l,e]),_=d(Fn,"s_ldsGGOBThbg",[e]),r=`field-label-${e.id}`;return i("div",{class:[A.datafieldWrapper,o&&A.datafieldWrapperExpanded,"no-caret"],ref:l.rootRef},null,i("div",null,{class:[A.datafield,"no-caret"]},[i("button",{"aria-expanded":o,"aria-label":o?"Collapse field details":"Expand field details"},{type:"button",class:A.datafieldChevron,onClick$:s},o?"▾":"▸",1,null),i("label",{id:r},{class:A.datafieldLabel},[u(v=>v.fieldName,[e],"p0.fieldName"),":"],3,null),l.isEditing?i("input",{ref:l.editInputRef,class:[A.datafieldValue,l.editValue.value&&A.datafieldValueUnderlined],"aria-labelledby":r,onInput$:E("s_vhiFO47zY4A",[l]),onPointerDown$:l.inputPointerDown$,onBlur$:l.inputBlur$,onKeyDown$:l.inputKeyDown$},{value:u(v=>v.editValue.value,[l],"p0.editValue.value"),autoFocus:!0},null,2,"o6_0"):i("div",{class:[A.datafieldValue,l.hasValue&&A.datafieldValueUnderlined,A.datafieldValueEditable,l.isPreviewActive&&A.datafieldValuePreview,"no-caret"],"aria-labelledby":r,onPointerDown$:l.valuePointerDown$,onKeyDown$:l.valueKeyDown$},{tabIndex:0,role:"button","aria-description":"Press Enter to edit"},l.displayValue||i("span",null,{class:A.datafieldPlaceholder},"Empty",3,"o6_1"),0,null),o&&g(Nn,{get fieldId(){return e.id},get fieldName(){return e.fieldName},get currentValue(){return l.displayValue},onDelete$:_,onPreviewChange$:l.setPreview$,onRevert$:l.revert$,[f]:{fieldId:u(v=>v.id,[e],"p0.id"),fieldName:u(v=>v.fieldName,[e],"p0.fieldName"),currentValue:u(v=>v.displayValue,[l],"p0.displayValue"),onDelete$:f}},2,"o6_2")],1,null),1,"o6_3")},Bn=w(d(kn,"s_2gBrAJoSz7w")),Tn="_constructionWrapper_aoisn_51",xn="_construction_aoisn_51",Pn="_chevronButton_aoisn_83",Un="_chevron_aoisn_83",Wn="_chevronOpen_aoisn_141",Mn="_comboBoxWrapper_aoisn_159",qn="_inputName_aoisn_169",Hn="_inputValue_aoisn_207",Ln="_dropdown_aoisn_245",Kn="_dropdownItem_aoisn_269",Qn="_actions_aoisn_315",Gn="_actionButton_aoisn_329",zn="_cancelButton_aoisn_367",S={constructionWrapper:Tn,construction:xn,chevronButton:Pn,chevron:Un,chevronOpen:Wn,comboBoxWrapper:Mn,inputName:qn,inputValue:Hn,dropdown:Ln,dropdownItem:Kn,actions:Qn,actionButton:Gn,cancelButton:zn},Yn=()=>{const[e,t]=p();t.initialName||setTimeout(()=>{var a;(a=e.value)==null||a.focus()},10)},Xn=()=>{const[e,t,a]=p();a.onChange$&&a.onChange$(a.id,e.value,t.value||null)},jn=()=>{const[e,t,a]=p(),n=e.value.trim(),o=t.value.trim()||null;a.onSave$(a.id,n,o)},Zn=()=>{const[e]=p();document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.onCancel$(e.id)},Jn=()=>{const[e,t,a]=p();if(!a.value&&e.value){const n=e.value.getBoundingClientRect();t.value={top:n.bottom+2,left:n.left,width:n.width}}a.value=!a.value},ea=e=>{const[t,a,n,o]=p();t.value=e,a.value=!1,n(),setTimeout(()=>{var l;(l=o.value)==null||l.focus()},10)},ta=e=>{const[t,a]=p();t.value=e.target.value,a()},na=e=>{const[t,a]=p();t.value=e.target.value,a()},aa=e=>{var s;const[t,a,n,o,l]=p();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"?(e.preventDefault(),a.value?a.value=!1:t()):e.key==="ArrowDown"?(e.preventDefault(),o()):e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(s=l.value)==null||s.focus())},oa=e=>{var o;const[t,a,n]=p();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"?(e.preventDefault(),t()):e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=a.value)==null||o.focus())},la=e=>{const[t,a,n]=p();e.key==="Enter"||e.key===" "?(e.preventDefault(),n()):e.key==="Escape"&&(e.preventDefault(),a.value?a.value=!1:t())},da=e=>{const t=y(e.initialName??""),a=y(e.initialValue??""),n=y(!1),o=y(),l=y(),s=y(),_=y({top:0,left:0,width:0});Z(d(Yn,"s_b1r271u70lg",[o,e]));const r=d(Xn,"s_5qS05iQ3kzk",[t,a,e]),v=d(jn,"s_VXoapCcVBGQ",[t,a,e]),m=d(Zn,"s_pO38pDzpTKY",[e]),$=d(Jn,"s_CPeMh0DlK80",[s,_,n]),D=d(ea,"s_JKvEDYW7DNg",[t,n,r,l]),V=d(ta,"s_C64zPMw20r4",[t,r]),R=d(na,"s_1yLyyhcqgGY",[a,r]),h=d(aa,"s_y0PWFrmLvh4",[m,n,v,$,l]),I=d(oa,"s_PaMVmYQPeZ4",[m,o,v]),ne=d(la,"s_AWjg7A8hpOg",[m,n,$]);return i("div",null,{class:S.constructionWrapper},[i("div",null,{class:S.construction},[i("button",null,{type:"button",class:S.chevronButton,"aria-expanded":u(b=>b.value,[n],"p0.value"),"aria-label":u(b=>b.value?"Close field name picker":"Open field name picker",[n],'p0.value?"Close field name picker":"Open field name picker"'),tabIndex:-1,onClick$:$,onKeyDown$:ne},i("span",{class:[S.chevron,n.value&&S.chevronOpen]},null,null,3,null),1,null),i("div",{ref:s},{class:S.comboBoxWrapper},[i("input",{ref:o},{type:"text",class:S.inputName,value:u(b=>b.value,[t],"p0.value"),placeholder:"Field Name","aria-label":"Field name (press Down Arrow for library)",onInput$:V,onKeyDown$:h,onFocus$:E("s_0IWX0Y3zQpc",[n])},null,3,null),n.value&&i("div",null,{class:S.dropdown,role:"listbox","aria-label":"Prefab field names",style:u(b=>({top:`${b.value.top}px`,left:`${b.value.left}px`,width:`${b.value.width}px`}),[_],"{top:`${p0.value.top}px`,left:`${p0.value.left}px`,width:`${p0.value.width}px`}")},Nt.map(b=>i("button",{onClick$:E("s_WB40vqhys98",[b,D])},{type:"button",class:S.dropdownItem,role:"option"},b,0,b)),1,"S1_0")],1,null),i("input",{ref:l},{type:"text",class:S.inputValue,value:u(b=>b.value,[a],"p0.value"),placeholder:"Value (optional)","aria-label":"Field value",onInput$:R,onKeyDown$:I},null,3,null)],1,null),i("div",null,{class:S.actions},[i("button",null,{type:"button",class:[S.actionButton,S.cancelButton],onClick$:m},"Cancel",3,null),i("button",null,{type:"button",class:S.actionButton,onClick$:v},"Save",3,null)],3,null)],1,"S1_1")},ia=w(d(da,"s_rgskcIH6ZDg")),sa=()=>{const[e,t,a,n]=p(),o=n.nodeId,l=n.enabled;(t.value!==o||e.value!==l)&&(t.value=o,e.value=l,a.value++)},ra=async()=>{const[e,t,a,n]=p();e.value&&(n.value=!0,a.value=await K().getFieldsForNode(t.value),n.value=!1)};function ca(e){const t=y(null),a=y(!1),n=y(e.nodeId),o=y(e.enabled),l=y(0);Z(d(sa,"s_4i3R51gQIV8",[o,n,l,e]));const s=d(ra,"s_7gfJWzE1Bug",[o,n,t,a]);return M(E("s_Ch3EXBvP4ag",[o,n,t,a,l,s])),{fields:t,isLoading:a,reload$:s}}const se=e=>`pendingFields:${e}`,ua=e=>{try{const t=localStorage.getItem(se(e));return t?JSON.parse(t):[]}catch{return[]}},pa=(e,t)=>{try{t.length===0?localStorage.removeItem(se(e)):localStorage.setItem(se(e),JSON.stringify(t))}catch{}};function fa(e){return ua(e).filter(a=>a.saved===!0&&a.fieldName.trim())}const _a=({track:e})=>{const[t,a]=p(),n=e(()=>t.value);typeof localStorage<"u"&&pa(a.nodeId,n)},va=async()=>{const[e,t]=p(),a=t.maxPersistedCardOrder$.value,n=e.value.length>0?Math.max(...e.value.map(s=>s.cardOrder)):-1,o=Math.max(a,n)+1,l={id:J(),fieldName:"",fieldValue:null,cardOrder:o};e.value=[...e.value,l]},ya=async(e,t,a)=>{const[n,o]=p(),l=t.trim();if(!l){n.value=n.value.filter(r=>r.id!==e);return}const s=n.value.find(r=>r.id===e),_=s==null?void 0:s.cardOrder;if(o.mode==="construction"){n.value=n.value.map(r=>r.id===e?{...r,fieldName:l,fieldValue:a,saved:!0}:r);return}await K().addField(o.nodeId,l,a,_),n.value=n.value.filter(r=>r.id!==e),Q(),await o.onSaved$()},ga=e=>{const[t]=p();t.value=t.value.filter(a=>a.id!==e)},ma=(e,t,a)=>{const[n]=p();n.value=n.value.map(o=>o.id===e?{...o,fieldName:t,fieldValue:a}:o)},ha=async()=>{const[e,t]=p(),a=e.value.filter(o=>o.fieldName.trim());if(a.length===0)return 0;if(t.mode==="construction")return e.value=e.value.map(o=>o.fieldName.trim()?{...o,fieldName:o.fieldName.trim(),saved:!0}:o),a.length;const n=K();return await Promise.all(a.map(o=>n.addField(t.nodeId,o.fieldName.trim(),o.fieldValue,o.cardOrder))),e.value=[],Q(),await t.onSaved$(),a.length};function wa(e){const t=y([]),a=y(!1);return M(E("s_qU68K91Z7fs",[t,a,e])),Z(d(_a,"s_7EzmTvHmSgg",[t,e])),{forms:t,add$:d(va,"s_Biym0x2w2Hg",[t,e]),save$:d(ya,"s_w000e3KQtXY",[t,e]),cancel$:d(ga,"s_tq0phclloKM",[t]),change$:d(ma,"s_IrI7Myrn2Ko",[t]),saveAllPending$:d(ha,"s_CEglqaDCkrM",[t,e])}}const Na="_fieldList_5uih9_5",$a="_addButton_5uih9_17",_e={fieldList:Na,addButton:$a},he=30,ba=()=>{const[e]=p();return!e.fields.value||e.fields.value.length===0?-1:Math.max(...e.fields.value.map(t=>t.cardOrder))},Ia=()=>{const[e,t]=p(),a=[];if(t.fields.value)for(const n of t.fields.value)a.push({type:"persisted",field:n});for(const n of e.forms.value)a.push({type:"pending",form:n});return a.sort((n,o)=>{const l=n.type==="persisted"?n.field.cardOrder:n.form.cardOrder,s=o.type==="persisted"?o.field.cardOrder:o.form.cardOrder;return l-s}),a},Ca=()=>{const[e]=p();e.reload$()},Da=()=>{const[e]=p();e.forms.value.length<he&&e.add$()},Sa=e=>{const t=ca({nodeId:e.nodeId,enabled:!0}),a=pe(d(ba,"s_09wqlr4vzW0",[t])),n=wa({nodeId:e.nodeId,mode:e.isConstruction?"construction":"display",onSaved$:t.reload$,initialFieldNames:e.initialFieldNames,maxPersistedCardOrder$:a});M(E("s_YFcoGOqtLXk",[n,e]));const o=pe(d(Ia,"s_vrtZqVijSkE",[n,t])),l=d(Ca,"s_XhGlu5hwbws",[t]),s=d(Da,"s_WITd5JAXm44",[n]),_=n.forms.value.length<he;return i("div",null,{class:_e.fieldList},[o.value.map(r=>(U(),r.type==="persisted"?g(Bn,{get id(){return r.field.id},get fieldName(){return r.field.fieldName},get fieldValue(){return r.field.fieldValue},onDeleted$:l,[f]:{id:B(r.field,"id"),fieldName:B(r.field,"fieldName"),fieldValue:B(r.field,"fieldValue"),onDeleted$:f}},3,r.field.id):g(ia,{get id(){return r.form.id},get initialName(){return r.form.fieldName},get initialValue(){return r.form.fieldValue},onSave$:n.save$,onCancel$:n.cancel$,onChange$:n.change$,[f]:{id:B(r.form,"id"),initialName:B(r.form,"fieldName"),initialValue:B(r.form,"fieldValue")}},2,r.form.id))),i("button",{disabled:!_,"aria-label":_?"Add new field":"Maximum fields reached"},{type:"button",class:_e.addButton,onClick$:s},"+ Add Field",3,null)],1,"Bt_0")},we=w(d(Sa,"s_2RnEZFWrgIk")),Ea="_wrapper_69p8f_7",Va="_wrapperOpen_69p8f_31",Aa="_inner_69p8f_39",Ra="_details_69p8f_53",Oa="_detailsOpen_69p8f_81",Fa="_actionsRow_69p8f_93",ka="_deleteButton_69p8f_105",H={wrapper:Ea,wrapperOpen:Va,inner:Aa,details:Ra,detailsOpen:Oa,actionsRow:Fa,deleteButton:ka},Ba=e=>i("div",{class:[H.wrapper,e.isOpen&&H.wrapperOpen]},null,i("div",null,{class:H.inner},i("div",{class:[H.details,e.isOpen&&H.detailsOpen]},null,g(ie,null,3,"U2_0"),1,null),1,null),1,"U2_1"),Ta=w(d(Ba,"s_U7D0xuRjUic"));function xa(e){return ht(e)}const Pa="_breadcrumbs_iuqaw_1",Ua="_segment_iuqaw_19",Wa="_label_iuqaw_31",Ma="_ancestor_iuqaw_41",qa="_current_iuqaw_69",Ha="_separator_iuqaw_79",q={breadcrumbs:Pa,segment:Ua,label:Wa,ancestor:Ma,current:qa,separator:Ha},La=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},Ka=e=>{const t=W(),a=xa(e.nodeId);return a.length?i("nav",null,{class:q.breadcrumbs,"aria-label":"Breadcrumb"},a.map((n,o)=>{const l=o===a.length-1,s=n.name||"Untitled";return i("span",null,{class:q.segment},[l?i("span",null,{class:[q.label,q.current]},s,1,"5z_0"):i("button",{onClick$:d(La,"s_yfB6ONRQ6Zs",[t,n])},{type:"button",class:[q.label,q.ancestor]},s,0,null),!l&&i("span",null,{class:q.separator},"/",3,"5z_1")],1,n.id)}),1,"5z_2"):null},Qa=w(d(Ka,"s_RDpU1pg5dZk")),Ga=e=>{const[t,a]=p();e==null||e.stopPropagation(),t.toggleCardExpanded$(a.id)},za=()=>{const[e,t]=p();e.toggleNodeDetailsExpanded$(t.id)},Ya=async()=>{var a;const[e]=p();console.log("[TreeNodeDisplay] Delete requested for node:",e.id);const t=e.parentId;await te().deleteNode(e.id),console.log("[TreeNodeDisplay] Node deleted, triggering sync"),Q(),(a=e.onNavigateUp$)==null||a.call(e,t??null)},Xa=e=>{const t=L(),a=W(),o=P.getDataCardState(t,e.id)==="EXPANDED",s=P.getNodeDetailsState(t,e.id)==="EXPANDED",_=d(Ga,"s_fJ0tmVx2bMU",[a,e]),r=d(za,"s_lPLXdyN6u08",[a,e]),v=d(Ya,"s_034j2WWPHvA",[e]),m=`node-title-${e.id}`,$=!!e.onNodeClick$,D=e.nodeState==="PARENT",R=e.nodeState==="CHILD"?"18px":"50px";return i("div",{style:{"--datacard-indent":R}},{class:C.nodeWrapper},[g(Ta,{get nodeId(){return e.id},isOpen:s,children:i("div",null,null,[g(Qa,{get nodeId(){return e.id},[f]:{nodeId:u(h=>h.id,[e],"p0.id")}},3,"vG_0"),i("h3",null,{style:"margin: 0 0 var(--space-3) 0; font-size: var(--text-base); font-weight: 600;"},"Node Details",3,null),i("div",null,{style:"color: var(--text-muted); font-size: var(--text-sm);"},null,3,null),i("div",null,{class:H.actionsRow},i("button",null,{type:"button",class:H.deleteButton,"aria-label":"Delete this asset",onClick$:v},"Delete Asset",3,null),3,null)],1,null),[f]:{nodeId:u(h=>h.id,[e],"p0.id")}},1,"vG_1"),g(ye,{get id(){return e.id},titleId:m,isExpanded:o,isDetailsExpanded:s,isParent:D,isClickable:$,get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,onExpand$:_,onDetailsToggle$:r,[f]:{id:u(h=>h.id,[e],"p0.id"),nodeName:u(h=>h.nodeName,[e],"p0.nodeName"),nodeSubtitle:u(h=>h.nodeSubtitle,[e],"p0.nodeSubtitle"),parentId:u(h=>h.parentId,[e],"p0.parentId"),onExpand$:f,onDetailsToggle$:f}},2,"vG_2"),g(ge,{isOpen:o,get nodeId(){return e.id},children:g(we,{get nodeId(){return e.id},isConstruction:!1,[f]:{nodeId:u(h=>h.id,[e],"p0.id"),isConstruction:f}},3,"vG_3"),[f]:{nodeId:u(h=>h.id,[e],"p0.id")}},1,"vG_4")],1,"vG_5")},ja=w(d(Xa,"s_06szQ6qXZeE")),Za=async()=>{var _,r,v,m,$,D;const[e,t,a,n]=p();e.value&&await e.value.saveAllPending$(),console.log("[handleCreate$] nameInputRef.value:",t.value),console.log("[handleCreate$] subtitleInputRef.value:",n.value),console.log("[handleCreate$] nameInputRef placeholder:",(_=t.value)==null?void 0:_.placeholder),console.log("[handleCreate$] subtitleInputRef placeholder:",(r=n.value)==null?void 0:r.placeholder),console.log("[handleCreate$] nameInputRef.value.value:",(v=t.value)==null?void 0:v.value),console.log("[handleCreate$] subtitleInputRef.value.value:",(m=n.value)==null?void 0:m.value);const o=document.querySelectorAll("input");console.log("[handleCreate$] All inputs on page:",o.length),o.forEach((V,R)=>{console.log(`[handleCreate$] Input ${R}: placeholder="${V.placeholder}", value="${V.value}"`)});const l=(($=t.value)==null?void 0:$.value)||"",s=((D=n.value)==null?void 0:D.value)||"";console.log("[handleCreate$] Final values - nodeName:",JSON.stringify(l),"nodeSubtitle:",JSON.stringify(s)),await a.onCreate$({nodeName:l,nodeSubtitle:s,fields:[]})},Ja=e=>{const[t,a]=p();e.key==="Enter"?(e.preventDefault(),t()):e.key==="Escape"&&(e.preventDefault(),a.onCancel$())},eo=e=>{const t=y(),a=y(),n=y(null);M(E("s_82IaKsCDbGY",[t]));const o=d(Za,"s_60fRKu4o7GU",[n,t,e,a]),l=d(Ja,"s_ZHVlk1DFSAo",[o,e]),s=`node-title-${e.id}`,_=e.isChildConstruction?"18px":"50px";return i("div",{style:{"--datacard-indent":_}},{class:C.nodeWrapper},[g(ye,{get id(){return e.id},titleId:s,isExpanded:!0,isParent:!1,isClickable:!1,get nodeName(){return e.initialName||""},get nodeSubtitle(){return e.initialSubtitle||""},isConstruction:!0,nameInputRef:t,subtitleInputRef:a,onKeyDown$:l,chevronDisabled:!0,[f]:{id:u(r=>r.id,[e],"p0.id"),isExpanded:f,isParent:f,isClickable:f,nodeName:u(r=>r.initialName||"",[e],'p0.initialName||""'),nodeSubtitle:u(r=>r.initialSubtitle||"",[e],'p0.initialSubtitle||""'),isConstruction:f,nameInputRef:f,subtitleInputRef:f,onKeyDown$:f,chevronDisabled:f}},3,"qo_0"),g(ge,{get nodeId(){return e.id},isOpen:!0,children:[g(we,{get nodeId(){return e.id},initialFieldNames:$t,handleRef:n,isConstruction:!0,[f]:{nodeId:u(r=>r.id,[e],"p0.id"),initialFieldNames:f,handleRef:f,isConstruction:f}},3,"qo_1"),i("div",{"q:slot":"actions"},{class:C.constructionActions},[i("button",{onClick$:e.onCancel$},{type:"button"},"Cancel",2,null),i("button",null,{type:"button",onClick$:o},"Create",3,null)],1,null)],[f]:{nodeId:u(r=>r.id,[e],"p0.id"),isOpen:f}},1,"qo_2")],1,"qo_3")},to=w(d(eo,"s_0HiZh00BXTo"));function no(e){return e.nodeState==="UNDER_CONSTRUCTION"}const ao=e=>(U(),no(e)?g(to,{get id(){return e.id},get initialName(){return e.nodeName},get initialSubtitle(){return e.nodeSubtitle},get isChildConstruction(){return e.isChildConstruction},onCancel$:e.onCancel$,onCreate$:e.onCreate$,[f]:{id:u(t=>t.id,[e],"p0.id"),initialName:u(t=>t.nodeName,[e],"p0.nodeName"),initialSubtitle:u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),isChildConstruction:u(t=>t.isChildConstruction,[e],"p0.isChildConstruction")}},2,"gq_0"):g(ja,{get id(){return e.id},get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get nodeState(){return e.nodeState},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,[f]:{id:u(t=>t.id,[e],"p0.id"),nodeName:u(t=>t.nodeName,[e],"p0.nodeName"),nodeSubtitle:u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),nodeState:u(t=>t.nodeState,[e],"p0.nodeState"),parentId:u(t=>t.parentId,[e],"p0.parentId")}},2,"gq_1")),j=w(d(ao,"s_gegngB44RHE")),oo="_createNode_194o9_5",lo="_createNodeChild_194o9_49",de={createNode:oo,createNodeChild:lo},io=async()=>{const[e]=p();e.onClick$&&await e.onClick$()},so=e=>{const t=d(io,"s_m1x9adscB00",[e]);return e.variant==="root"?i("button",null,{type:"button",class:[de.createNode,"no-caret"],"aria-label":"Create New Asset",onClick$:t},"Create New Asset",3,"ad_0"):e.variant==="child"?i("button",null,{type:"button",class:[de.createNode,de.createNodeChild,"no-caret"],"aria-label":"Add Sub-Asset",onClick$:t},"+ Add Sub-Asset",3,"ad_1"):null},Ne=w(d(so,"s_0wYRrfEmCIE")),ro=async()=>{const[e,t]=p(),a=J();await t({id:a,parentId:e.parentId,nodeName:"",nodeSubtitle:"",defaultFields:[]})},co=async()=>{const[e,t]=p(),a=e.underConstruction;a&&localStorage.removeItem(`pendingFields:${a.id}`),await t()},uo=async e=>{const[t,a,n]=p();console.log("[complete$] Received payload:",JSON.stringify(e));const o=t.underConstruction;if(console.log("[complete$] ucData:",o),!o){console.log("[complete$] No ucData, returning early!");return}const l=fa(o.id);console.log("[complete$] Saved fields from localStorage:",l.length),await te().createWithFields({id:o.id,parentId:o.parentId,nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||"",defaults:l.map(s=>({fieldName:s.fieldName,fieldValue:s.fieldValue}))}),console.log("[complete$] Node and fields created atomically"),localStorage.removeItem(`pendingFields:${o.id}`),Q(),await a(),console.log("[complete$] completeConstruction$ done, calling onCreated$"),await n.onCreated$(),console.log("[complete$] onCreated$ done, complete$ finished")};function $e(e){const t=L(),{startConstruction$:a,cancelConstruction$:n,completeConstruction$:o}=W(),l=d(ro,"s_n6hsWUuIj1Y",[e,a]),s=d(co,"s_cbiq6e5O6us",[t,n]),_=d(uo,"s_v6yCRyJjgcY",[t,o,e]);return{ucNode:t.underConstruction,start$:l,cancel$:s,complete$:_}}const po=async()=>{const[e,t]=p();console.log("[useRootViewData] load$ called"),e.value=!0;try{const a=await te().getRootNodes();console.log("[useRootViewData] Fetched",a.length,"root nodes"),t.value=a,console.log("[useRootViewData] nodes.value set to",t.value.length,"nodes")}finally{e.value=!1}};function fo(){const e=y([]),t=y(!1),a=d(po,"s_UIfphfAKvzM",[t,e]);return M(E("s_j2W4Hu2S1VQ",[a])),{nodes:e,isLoading:t,reload$:a}}const _o=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},vo=()=>{U();const e=L(),t=W(),a=fo(),n=$e({parentId:null,onCreated$:a.reload$}),o=n.ucNode?a.nodes.value.filter(l=>l.id!==n.ucNode.id):a.nodes.value;return i("main",null,{class:"view-root"},[o.map(l=>g(j,{get id(){return l.id},get nodeName(){return l.nodeName},nodeSubtitle:l.nodeSubtitle??"",nodeState:P.getDisplayNodeState(e,l.id),onNodeClick$:d(_o,"s_FBTGThmmG98",[t,l]),[f]:{id:B(l,"id"),nodeName:B(l,"nodeName")}},3,l.id)),n.ucNode?g(j,{get id(){return n.ucNode.id},get nodeName(){return n.ucNode.nodeName},get nodeSubtitle(){return n.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",onCancel$:n.cancel$,onCreate$:n.complete$,[f]:{id:u(l=>l.ucNode.id,[n],"p0.ucNode.id"),nodeName:u(l=>l.ucNode.nodeName,[n],"p0.ucNode.nodeName"),nodeSubtitle:u(l=>l.ucNode.nodeSubtitle,[n],"p0.ucNode.nodeSubtitle"),nodeState:f}},2,n.ucNode.id):null,g(Ne,{variant:"root",onClick$:n.start$,[f]:{variant:f}},2,"7G_0")],1,"7G_1")},yo=w(d(vo,"s_hNvYX6tEL2I")),go=async e=>{const[t,a,n,o,l]=p();if(e){t.underConstruction&&a(),o.value=!0;try{const s=await te().getNodeWithChildren(e);l.value=s.node,n.value=s.children}finally{o.value=!1}}};function mo(){const e=y(null),t=y([]),a=y(!1),n=L(),{cancelConstruction$:o}=W(),l=d(go,"s_cbTnqvcou0A",[n,o,t,a,e]);return{parentNode:e,children:t,isLoading:a,load$:l,reload$:l}}const ho=async({track:e})=>{const[t,a]=p(),n=e(()=>a.parentId);n&&await t.load$(n)},wo=async()=>{const[e,t]=p();await e.reload$(t.parentId)},No=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},$o=e=>{U();const t=W(),a=mo();Z(d(ho,"s_yRk2iqAjgFI",[a,e])),M(E("s_YSvpaIwIZ9w",[a,e]));const n=$e({parentId:e.parentId,onCreated$:d(wo,"s_02bEtWr042Y",[a,e])});return a.isLoading.value||!a.parentNode.value?i("main",null,{class:"view-branch"},"Loading...",3,"RT_0"):i("main",null,{class:"view-branch"},[i("div",null,{class:"branch-parent-row"},i("div",null,{class:"branch-parent-node"},g(j,{get id(){return a.parentNode.value.id},get nodeName(){return a.parentNode.value.nodeName},get nodeSubtitle(){return a.parentNode.value.nodeSubtitle??""},nodeState:"PARENT",get parentId(){return a.parentNode.value.parentId},onNavigateUp$:t.navigateUp$,[f]:{id:u(o=>o.parentNode.value.id,[a],"p0.parentNode.value.id"),nodeName:u(o=>o.parentNode.value.nodeName,[a],"p0.parentNode.value.nodeName"),nodeSubtitle:u(o=>o.parentNode.value.nodeSubtitle??"",[a],'p0.parentNode.value.nodeSubtitle??""'),nodeState:f,parentId:u(o=>o.parentNode.value.parentId,[a],"p0.parentNode.value.parentId")}},2,a.parentNode.value.id),1,null),1,null),i("div",null,{class:"branch-children"},[a.children.value.filter(o=>!n.ucNode||o.id!==n.ucNode.id).map(o=>g(j,{get id(){return o.id},get nodeName(){return o.nodeName},nodeSubtitle:o.nodeSubtitle??"",nodeState:"CHILD",onNodeClick$:d(No,"s_ubVdAKhHRM8",[t,o]),[f]:{id:B(o,"id"),nodeName:B(o,"nodeName"),nodeState:f}},3,o.id)),n.ucNode?i("div",null,{class:"branch-child-row"},g(j,{get id(){return n.ucNode.id},get nodeName(){return n.ucNode.nodeName},get nodeSubtitle(){return n.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",isChildConstruction:!0,onCancel$:n.cancel$,onCreate$:n.complete$,[f]:{id:u(o=>o.ucNode.id,[n],"p0.ucNode.id"),nodeName:u(o=>o.ucNode.nodeName,[n],"p0.ucNode.nodeName"),nodeSubtitle:u(o=>o.ucNode.nodeSubtitle,[n],"p0.ucNode.nodeSubtitle"),nodeState:f,isChildConstruction:f}},2,n.ucNode.id),1,"RT_1"):null,g(Ne,{variant:"child",onClick$:n.start$,[f]:{variant:f}},2,"RT_2")],1,null)],1,"RT_3")},bo=w(d($o,"s_gIJMeo2tapw")),Io=()=>{U();const e=L(),t=P.isRootView(e),a=P.getCurrentNodeId(e);return t?g(yo,null,3,"sJ_0"):g(bo,{parentId:a},3,"sJ_1")},Co=w(d(Io,"s_yh0RYmyrFWk")),Do=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),So=[],Eo=[["/",[()=>Do],"/",[]]],Vo=[],Ao=!0,Ro="/",Oo=!0,Bo={routes:Eo,serverPlugins:So,menus:Vo,trailingSlash:Ao,basePathname:Ro,cacheModules:Oo};export{Ro as basePathname,Oo as cacheModules,Bo as default,Vo as menus,Eo as routes,So as serverPlugins,Ao as trailingSlash};
