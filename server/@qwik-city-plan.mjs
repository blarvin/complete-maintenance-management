import{c as w,i as s,_ as i,a as u,b as V,u as y,d as p,e as P,f as g,g as _,F as se,S as oe,h as c,j as X,k as H,l as W,m as U,n as Se,o as Ee,p as ie,q as B}from"./q-CDhVs3qt.js";import"firebase/firestore";const Ve="_nodeWrapper_1jgt8_4",Re="_nodeHeader_1jgt8_8",Ae="_nodeHeaderExpanded_1jgt8_18",Fe="_nodeHeaderContent_1jgt8_20",Te="_nodeHeaderParent_1jgt8_29",Be="_upButtonWrapper_1jgt8_35",Oe="_nodeHeaderContentClickable_1jgt8_44",ke="_nodeTitle_1jgt8_48",xe="_nodeSubtitle_1jgt8_63",Pe="_nodeButtons_1jgt8_84",We="_nodeChevron_1jgt8_95",Ue="_constructionActions_1jgt8_132",C={nodeWrapper:Ve,nodeHeader:Re,nodeHeaderExpanded:Ae,nodeHeaderContent:Fe,nodeHeaderParent:Te,upButtonWrapper:Be,nodeHeaderContentClickable:Oe,nodeTitle:ke,nodeSubtitle:xe,nodeButtons:Pe,nodeChevron:We,constructionActions:Ue},Me=e=>i("h2",null,{class:C.nodeTitle,id:u(t=>t.id,[e],"p0.id")},u(t=>t.nodeName,[e],"p0.nodeName"),3,"Th_0"),qe=w(s(Me,"s_DVVkpy7hRQQ")),He=e=>i("div",null,{class:C.nodeSubtitle},u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),3,"ld_0"),Le=w(s(He,"s_BPVk0Y80MRc")),Qe="_upButton_1crd4_5",Ke={upButton:Qe},Ge=e=>i("button",null,{class:Ke.upButton,title:u(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),"aria-label":u(t=>t.parentId?"Go to parent":"Go to root",[e],'p0.parentId?"Go to parent":"Go to root"'),onClick$:V("s_zrBmdNlvcAw",[e])},"↑",3,"BX_0"),ze=w(s(Ge,"s_zKD01KoPOyE")),Ye=280,Xe=6,je=(e,t)=>{const[n,a,o,l,d]=p(),f=Date.now(),r=f-n.value<=d,v=Math.abs(e-a.value),h=Math.abs(t-o.value),$=v<=l&&h<=l,D=r&&$;return n.value=f,a.value=e,o.value=t,D};function ue(e={}){const t=e.thresholdMs??Ye,n=e.slopPx??Xe,a=y(0),o=y(0),l=y(0);return{checkDoubleTap$:s(je,"s_Ex0CzuR1b0c",[a,o,l,n,t])}}const Ze="_ellipsisButton_wduwl_5",Je={ellipsisButton:Ze},et=async e=>{const[t,n]=p();if(e.stopPropagation(),!n.onDoubleTap$)return;await t.checkDoubleTap$(e.clientX,e.clientY)&&n.onDoubleTap$()},tt=e=>{e.stopPropagation()},nt=e=>{const[t]=p();t.onDoubleTap$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onDoubleTap$())},at=e=>{const t=ue(),n=s(et,"s_ATxTfk20r0g",[t,e]),a=s(tt,"s_tJe2uV5Pw0E"),o=s(nt,"s_6MiwcH1V1j4",[e]);return i("button",null,{type:"button",class:Je.ellipsisButton,"aria-expanded":u(l=>l.isExpanded,[e],"p0.isExpanded"),"aria-label":u(l=>l.isExpanded?"Collapse node details":"Expand node details",[e],'p0.isExpanded?"Collapse node details":"Expand node details"'),onPointerDown$:n,onClick$:a,onKeyDown$:o},"⋮",3,"9s_0")},ot=w(s(at,"s_1dOBjfw6Fqo")),lt=e=>{const[t]=p();t.onNodeClick$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.onNodeClick$())},dt=e=>{const[t]=p();t.onExpand$&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),t.onExpand$())},st=e=>{P();const t=s(lt,"s_Eo0egbDYOnc",[e]),n=s(dt,"s_9BqTWe0Vch0",[e]);return i("article",{class:[C.nodeHeader,e.isExpanded&&C.nodeHeaderExpanded,e.isParent&&C.nodeHeaderParent]},{"aria-labelledby":u(a=>a.titleId,[e],"p0.titleId"),"data-node-id":u(a=>a.id,[e],"p0.id")},i("div",{class:[C.nodeHeaderContent,e.isClickable&&C.nodeHeaderContentClickable,e.isClickable&&"no-caret"],onClick$:e.onNodeClick$,onKeyDown$:t},{role:u(a=>a.isClickable?"button":void 0,[e],'p0.isClickable?"button":undefined'),tabIndex:u(a=>a.isClickable?0:void 0,[e],"p0.isClickable?0:undefined"),"aria-label":u(a=>a.isClickable?`Open ${a.nodeName||"node"}`:void 0,[e],'p0.isClickable?`Open ${p0.nodeName||"node"}`:undefined')},[e.isParent&&e.onNavigateUp$&&i("div",null,{class:C.upButtonWrapper},g(ze,{get parentId(){return e.parentId??null},onNavigate$:e.onNavigateUp$,[_]:{parentId:u(a=>a.parentId??null,[e],"p0.parentId??null")}},2,"pa_0"),1,"pa_1"),i("div",null,null,e.isConstruction?g(se,{children:[i("input",{ref:e.nameInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeTitle,placeholder:"Name","aria-label":"Node name",id:u(a=>a.titleId,[e],"p0.titleId")},null,2,null),i("input",{ref:e.subtitleInputRef,onKeyDown$:e.onKeyDown$},{class:C.nodeSubtitle,placeholder:"Subtitle / Location / Short description","aria-label":"Node subtitle"},null,2,null)]},1,"pa_2"):g(se,{children:[g(qe,{get nodeName(){return e.nodeName},get id(){return e.titleId},[_]:{nodeName:u(a=>a.nodeName,[e],"p0.nodeName"),id:u(a=>a.titleId,[e],"p0.titleId")}},3,"pa_3"),g(Le,{get nodeSubtitle(){return e.nodeSubtitle},[_]:{nodeSubtitle:u(a=>a.nodeSubtitle,[e],"p0.nodeSubtitle")}},3,"pa_4")]},1,"pa_5"),1,null),i("div",null,{class:C.nodeButtons},[g(ot,{onDoubleTap$:e.onDetailsToggle$,get isExpanded(){return e.isDetailsExpanded},[_]:{isExpanded:u(a=>a.isDetailsExpanded,[e],"p0.isDetailsExpanded")}},2,"pa_6"),i("button",{onClick$:e.onExpand$,onKeyDown$:n},{type:"button",class:C.nodeChevron,"aria-expanded":u(a=>a.isExpanded,[e],"p0.isExpanded"),"aria-label":u(a=>a.isExpanded?"Collapse details":"Expand details",[e],'p0.isExpanded?"Collapse details":"Expand details"'),disabled:u(a=>a.chevronDisabled,[e],"p0.chevronDisabled")},u(a=>a.isExpanded?"▾":"◂",[e],'p0.isExpanded?"▾":"◂"'),2,null)],1,null)],0,null),1,"pa_7")},pe=w(s(st,"s_xWTLD5hOIvU")),it="_wrapper_10kg1_7",rt="_wrapperOpen_10kg1_47",ct="_inner_10kg1_57",ut="_datacard_10kg1_71",pt="_datacardOpen_10kg1_103",z={wrapper:it,wrapperOpen:rt,inner:ct,datacard:ut,datacardOpen:pt},ft=e=>i("div",{class:[z.wrapper,e.isOpen&&z.wrapperOpen]},null,i("div",null,{class:z.inner},i("div",{class:[z.datacard,e.isOpen&&z.datacardOpen,"no-caret"]},{role:"region","aria-label":"Node details"},[g(oe,null,3,"9y_0"),g(oe,{name:"actions",[_]:{name:_}},3,"9y_1")],1,null),1,null),1,"9y_2"),fe=w(s(ft,"s_L7oO92ZEh6A"));function j(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`id_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`}function re(e){return e.filter(t=>t.deletedAt===null)}function te(e){return e.filter(t=>t.deletedAt!==null)}const _t="localUser",vt=["Description","Type Of","Tags","Location","Serial Number","Part Number","Manufacturer","Model","Status","Installed Date","Weight","Dimensions","Power Rating","Current Reading","Note"],yt=["Type Of","Description","Tags"];function k(){return _t}const T=()=>Date.now(),gt=e=>new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"});function ne(e){const{dataFieldId:t,parentNodeId:n,action:a,prevValue:o,newValue:l,rev:d}=e;return{id:`${t}:${d}`,dataFieldId:t,parentNodeId:n,action:a,property:"fieldValue",prevValue:o,newValue:l,updatedBy:k(),updatedAt:T(),rev:d}}function ht(e,t,n){const a=new Error(t);return a.code=e,a.retryable=n==null?void 0:n.retryable,a.details=n==null?void 0:n.details,a.cause=n==null?void 0:n.cause,a}class mt{constructor(){this.subscribers=[]}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter(n=>n!==t)}}emit(t){for(const n of this.subscribers)n(t)}clear(){this.subscribers=[]}}const K=new mt;class wt{async getSyncQueue(){const t=await c.syncQueue.where("status").equals("pending").toArray();return t.sort((n,a)=>n.timestamp-a.timestamp),t}async enqueue(t){const n={id:j(),operation:t.operation,entityType:t.entityType,entityId:t.entityId,payload:t.payload,timestamp:T(),status:"pending",retryCount:0};await c.syncQueue.put(n)}async markSynced(t){await c.syncQueue.delete(t)}async markFailed(t,n){const a=await c.syncQueue.get(t);if(!a)return;const o=n instanceof Error?n.message:String(n);await c.syncQueue.update(t,{status:"failed",retryCount:a.retryCount+1,lastError:o})}}function N(e,t=!0){return{data:e,meta:{adapter:"idb",fromCache:t}}}class Nt{constructor(t){this.syncQueue=t??new wt}async listRootNodes(){const n=(await c.nodes.toArray()).filter(a=>a.parentId===null&&a.deletedAt===null);return n.sort((a,o)=>a.updatedAt-o.updatedAt),N(n)}async getNode(t){const n=await c.nodes.get(t);return N(n??null)}async listChildren(t){const n=await c.nodes.where("parentId").equals(t).toArray(),a=re(n);return a.sort((o,l)=>o.updatedAt-l.updatedAt),N(a)}async createNode(t){const n=T(),a=k(),o={id:t.id,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle,parentId:t.parentId,updatedBy:a,updatedAt:n,deletedAt:null};return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.put(o),await this.syncQueue.enqueue({operation:"create-node",entityType:"node",entityId:o.id,payload:o})}),console.log("[IDBAdapter] Node created in IDB:",o.id,o.nodeName),K.emit({type:"NODE_WRITTEN",node:o}),N(o)}async updateNode(t,n){const a=T(),o=k();let l;return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{...n,updatedBy:o,updatedAt:a});const d=await c.nodes.get(t);d&&(await this.syncQueue.enqueue({operation:"update-node",entityType:"node",entityId:t,payload:d}),l=d)}),console.log("[IDBAdapter] Node updated in IDB:",t),l&&K.emit({type:"NODE_WRITTEN",node:l}),N(void 0)}async deleteNode(t,n){const a=T(),o=k();let l;return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{deletedAt:a,updatedAt:a,updatedBy:o});const d=await c.nodes.get(t);d&&(await this.syncQueue.enqueue({operation:"update-node",entityType:"node",entityId:t,payload:d}),l=d)}),console.log("[IDBAdapter] Node soft-deleted in IDB:",t),l&&K.emit({type:"NODE_WRITTEN",node:l}),N(void 0)}async listFields(t){const n=await c.fields.where("parentNodeId").equals(t).toArray(),a=re(n);return a.sort((o,l)=>o.cardOrder-l.cardOrder),N(a)}async nextCardOrder(t){const n=await c.fields.where("parentNodeId").equals(t).toArray();if(n.length===0)return N(0);const a=Math.max(...n.map(o=>o.cardOrder));return N(a+1)}async createField(t){const n=T(),a=k(),o=t.cardOrder??(await this.nextCardOrder(t.parentNodeId)).data,l={id:t.id,fieldName:t.fieldName,fieldValue:t.fieldValue,parentNodeId:t.parentNodeId,cardOrder:o,updatedBy:a,updatedAt:n,deletedAt:null};return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.put(l);const d=await this.nextRev(l.id),f=ne({dataFieldId:l.id,parentNodeId:l.parentNodeId,action:"create",prevValue:null,newValue:l.fieldValue,rev:d});await c.history.put(f),await this.syncQueue.enqueue({operation:"create-field",entityType:"field",entityId:l.id,payload:l}),await this.syncQueue.enqueue({operation:"create-history",entityType:"field-history",entityId:f.id,payload:f})}),console.log("[IDBAdapter] Field created in IDB:",l.id,l.fieldName),N(l)}async updateFieldValue(t,n){const a=await c.fields.get(t);if(!a)throw ht("not-found","Field not found",{retryable:!1});const o=T(),l=k();return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.update(t,{fieldValue:n.fieldValue,updatedAt:o,updatedBy:l});const d=await this.nextRev(t),f=ne({dataFieldId:t,parentNodeId:a.parentNodeId,action:"update",prevValue:a.fieldValue,newValue:n.fieldValue,rev:d});await c.history.put(f);const r=await c.fields.get(t);r&&await this.syncQueue.enqueue({operation:"update-field",entityType:"field",entityId:t,payload:r}),await this.syncQueue.enqueue({operation:"create-history",entityType:"field-history",entityId:f.id,payload:f})}),console.log("[IDBAdapter] Field updated in IDB:",t,n.fieldValue),N(void 0)}async deleteField(t){const n=await c.fields.get(t);if(!n)return N(void 0);const a=T(),o=k();return await c.transaction("rw",c.fields,c.history,c.syncQueue,async()=>{await c.fields.update(t,{deletedAt:a,updatedAt:a,updatedBy:o});const l=await this.nextRev(t),d=ne({dataFieldId:t,parentNodeId:n.parentNodeId,action:"delete",prevValue:n.fieldValue,newValue:null,rev:l});await c.history.put(d);const f=await c.fields.get(t);f&&await this.syncQueue.enqueue({operation:"update-field",entityType:"field",entityId:t,payload:f}),await this.syncQueue.enqueue({operation:"create-history",entityType:"field-history",entityId:d.id,payload:d})}),console.log("[IDBAdapter] Field soft-deleted in IDB:",t),N(void 0)}async getFieldHistory(t){const n=await c.history.where("dataFieldId").equals(t).toArray();return n.sort((a,o)=>a.rev-o.rev),N(n)}async listDeletedNodes(){const t=await c.nodes.toArray(),n=te(t);return n.sort((a,o)=>(o.deletedAt??0)-(a.deletedAt??0)),N(n)}async listDeletedChildren(t){const n=await c.nodes.where("parentId").equals(t).toArray(),a=te(n);return a.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),N(a)}async restoreNode(t){const n=T(),a=k();let o;return await c.transaction("rw",c.nodes,c.syncQueue,async()=>{await c.nodes.update(t,{deletedAt:null,updatedAt:n,updatedBy:a});const l=await c.nodes.get(t);l&&(await this.syncQueue.enqueue({operation:"update-node",entityType:"node",entityId:t,payload:l}),o=l)}),console.log("[IDBAdapter] Node restored in IDB:",t),o&&K.emit({type:"NODE_WRITTEN",node:o}),N(void 0)}async listDeletedFields(t){const n=await c.fields.where("parentNodeId").equals(t).toArray(),a=te(n);return a.sort((o,l)=>(l.deletedAt??0)-(o.deletedAt??0)),N(a)}async restoreField(t){const n=T(),a=k();return await c.transaction("rw",c.fields,c.syncQueue,async()=>{await c.fields.update(t,{deletedAt:null,updatedAt:n,updatedBy:a});const o=await c.fields.get(t);o&&await this.syncQueue.enqueue({operation:"update-field",entityType:"field",entityId:t,payload:o})}),console.log("[IDBAdapter] Field restored in IDB:",t),N(void 0)}async getLastSyncTimestamp(){const t=await c.syncMetadata.get("lastSyncTimestamp");return(t==null?void 0:t.value)??0}async setLastSyncTimestamp(t){await c.syncMetadata.put({key:"lastSyncTimestamp",value:t})}async applyRemoteUpdate(t,n){if(t==="node"){const a=n;await c.nodes.put(a),K.emit({type:"NODE_WRITTEN",node:a})}else await c.fields.put(n)}async getAllNodes(){return await c.nodes.toArray()}async getAllFields(){return await c.fields.toArray()}async getAllHistory(){return await c.history.toArray()}async applyRemoteHistory(t){await c.history.put(t)}async deleteNodeLocal(t){await c.nodes.delete(t),K.emit({type:"NODE_HARD_DELETED",nodeId:t})}async deleteFieldLocal(t){await c.fields.delete(t)}async nextRev(t){const n=await c.history.where("dataFieldId").equals(t).toArray();return n.length===0?0:Math.max(...n.map(o=>o.rev))+1}}const _e=new Nt,$t=Dt(_e),bt=It(_e);function O(e){return e.data}function Dt(e){return{getRootNodes:async()=>O(await e.listRootNodes()),getNodeById:async t=>O(await e.getNode(t)),getNodeWithChildren:async t=>{const[n,a]=await Promise.all([e.getNode(t),e.listChildren(t)]);return{node:O(n),children:O(a)}},getChildren:async t=>O(await e.listChildren(t)),createWithFields:async t=>{await e.createNode({id:t.id,parentId:t.parentId,nodeName:t.nodeName,nodeSubtitle:t.nodeSubtitle}),await Promise.all(t.defaults.map(n=>e.createField({id:j(),parentNodeId:t.id,fieldName:n.fieldName,fieldValue:n.fieldValue})))},createEmptyNode:async(t,n)=>O(await e.createNode({id:t,parentId:n,nodeName:"",nodeSubtitle:""})),updateNode:async(t,n)=>{await e.updateNode(t,n)},deleteNode:async t=>{console.log("[NodeService] Deleting node:",t),await e.deleteNode(t)}}}function It(e){return{getFieldsForNode:async t=>O(await e.listFields(t)),nextCardOrder:async t=>O(await e.nextCardOrder(t)),addField:async(t,n,a,o)=>O(await e.createField({id:j(),parentNodeId:t,fieldName:n,fieldValue:a,cardOrder:o})),updateFieldValue:async(t,n)=>{await e.updateFieldValue(t,{fieldValue:n})},deleteField:async t=>{await e.deleteField(t)},getFieldHistory:async t=>O(await e.getFieldHistory(t))}}let Ct=$t,St=bt;function J(){return Ct}function L(){return St}const Et=10,Vt=220,Rt=({track:e,cleanup:t})=>{const[n,a,o]=p(),l=e(o);n.value!==null&&(clearTimeout(n.value),n.value=null),l&&(n.value=window.setTimeout(()=>{if(o()&&a.value){const d=a.value,f=d.value.length;d.focus(),d.setSelectionRange(f,f)}n.value=null},Et)),t(()=>{n.value!==null&&(clearTimeout(n.value),n.value=null)})};function At(e,t){const n=y(null),a=y(0);return X(s(Rt,"s_pml0F3aFPC0",[n,e,t])),{suppressBlurUntil:a}}const x={getTreeNodeState:(e,t,n)=>{var a;return((a=e.underConstruction)==null?void 0:a.id)===t?"UNDER_CONSTRUCTION":e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD"},getDisplayNodeState:(e,t)=>e.view.state==="ROOT"?"ROOT":e.view.nodeId===t?"PARENT":"CHILD",getDataCardState:(e,t)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t?"UNDER_CONSTRUCTION":e.ui.expandedCards.has(t)?"EXPANDED":"COLLAPSED"},getDataFieldState:(e,t)=>e.editingFieldId===t?"EDITING":"DISPLAY",getDataFieldDetailsState:(e,t)=>e.ui.expandedFieldDetails.has(t)?"EXPANDED":"COLLAPSED",getNodeDetailsState:(e,t)=>e.ui.expandedNodeDetails.has(t)?"EXPANDED":"COLLAPSED",isRootView:e=>e.view.state==="ROOT",getCurrentNodeId:e=>e.view.state==="BRANCH"?e.view.nodeId:null,isUnderConstruction:(e,t)=>{var n;return((n=e.underConstruction)==null?void 0:n.id)===t}};function Ft(e,t,n){throw new Error("SyncManager not initialized. Call getSyncManager with adapters first.")}const Tt=500;let Z=null;function Q(){Z!==null&&clearTimeout(Z),Z=setTimeout(()=>{Z=null,Ft().syncDelta().catch(e=>console.error("[triggerSync] Sync failed:",e))},Tt)}const Bt=e=>{const[t,n,a,o,l,d]=p();if(t.editingFieldId!==o.fieldId)return;const f=l.value,r=e.target;f&&r&&!f.contains(r)&&(d(),a.value=n.value)},Ot=()=>{const[e,t,n,a,o,l]=p();e.editingFieldId!==a.fieldId&&(l(a.fieldId),n.value=t.value,o.value=null)},kt=async()=>{const[e,t,n,a,o]=p();if(e.editingFieldId!==a.fieldId)return;const l=n.value.trim()===""?null:n.value;await L().updateFieldValue(a.fieldId,l),t.value=l??"",o(),Q(),a.onUpdated$&&await a.onUpdated$()},xt=()=>{const[e,t,n,a,o]=p();e.editingFieldId===a.fieldId&&(o(),n.value=t.value)},Pt=e=>{const[t]=p();t.value=e},Wt=()=>{const[e,t,n,a,o,l]=p();Date.now()<l.value||e.editingFieldId===a.fieldId&&(o(),n.value=t.value)},Ut=e=>{const[t,n]=p();e.key==="Enter"?(e.preventDefault(),n()):e.key==="Escape"&&(e.preventDefault(),t())},Mt=async e=>{const[t,n,a,o,l]=p();if(t.editingFieldId!==a.fieldId)return;const d=e.clientX??0,f=e.clientY??0;l.value=Date.now()+Vt,await n(d,f)&&await o()},qt=async e=>{const[t,n,a,o]=p();if(t.editingFieldId===o.fieldId)return;const l=e.clientX??0,d=e.clientY??0;await a(l,d)&&await n()},Ht=e=>{const[t,n,a]=p();t.editingFieldId!==a.fieldId&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),n())},Lt=e=>{const[t]=p();t.value=e},Qt=()=>{const[e]=p();e.value=null},Kt=async e=>{const[t,n,a]=p();await L().updateFieldValue(n.fieldId,e),t.value=e??"",a.value=null,Q(),n.onUpdated$&&await n.onUpdated$()};function Gt(e){const t=H(),{startFieldEdit$:n,stopFieldEdit$:a}=W(),l=x.getDataFieldState(t,e.fieldId)==="EDITING",d=y(),f=y(),r=y(e.initialValue??""),v=y(""),h=y(null),{checkDoubleTap$:$}=ue(),{suppressBlurUntil:D}=At(f,()=>t.editingFieldId===e.fieldId);U(V("s_Tjhab5vyHfo",[r,e])),Se("pointerdown",s(Bt,"s_StU06vsCz00",[t,r,v,e,d,a]));const E=s(Ot,"s_0HO9EPvGwSc",[t,r,v,e,h,n]),A=s(kt,"s_TpCFgZeU6Vk",[t,r,v,e,a]),m=s(xt,"s_dsRT43um7vE",[t,r,v,e,a]),I=s(Pt,"s_43FZb0QGfSU",[v]),ee=s(Wt,"s_WWaKkyE000c",[t,r,v,e,a,D]),b=s(Ut,"s_8yy0Fab0FzY",[m,A]),me=s(Mt,"s_dSOqRahu9fY",[t,$,e,A,D]),we=s(qt,"s_DkvtW0NQyBE",[t,E,$,e]),Ne=s(Ht,"s_cmRnDo37yA8",[t,E,e]),$e=s(Lt,"s_edkN78Zq06w",[h]),be=s(Qt,"s_Ax8A0n67Fek",[h]),De=s(Kt,"s_85DxwQYAcGo",[r,e,h]),de=h.value!==null?h.value:r.value,Ie=!!de,Ce=h.value!==null;return{isEditing:l,displayValue:de,isPreviewActive:Ce,hasValue:Ie,editValue:v,editInputRef:f,rootRef:d,beginEdit$:E,save$:A,cancel$:m,valuePointerDown$:we,valueKeyDown$:Ne,inputPointerDown$:me,inputBlur$:ee,inputKeyDown$:b,inputChange$:I,setPreview$:$e,revert$:De,clearPreview$:be}}const zt="_historyWrapper_163sz_5",Yt="_historyList_163sz_17",Xt="_historyRow_163sz_41",jt="_historyRowSelected_163sz_99",Zt="_historyValue_163sz_117",Jt="_historyMeta_163sz_131",G={historyWrapper:zt,historyList:Yt,historyRow:Xt,historyRowSelected:jt,historyValue:Zt,historyMeta:Jt},en=e=>{const[t,n]=p();n.value=e.rev,t.onPreviewChange$(e.newValue)},tn=e=>{const t=y(null),n=[...e.history].reverse(),a=s(en,"s_BJVayUaFz28",[e,t]),o=d=>{const f=new Date(d),r=f.getDate().toString().padStart(2,"0"),v=(f.getMonth()+1).toString().padStart(2,"0"),h=f.getFullYear(),$=f.getHours().toString().padStart(2,"0"),D=f.getMinutes().toString().padStart(2,"0");return`${r}/${v}/${h}, ${$}:${D}`},l=e.history.length>0;return i("div",null,{class:[G.historyWrapper,"no-caret"]},e.isOpen&&l&&i("div",null,{class:[G.historyList,"no-caret"],role:"listbox","aria-label":"Field value history"},n.map(d=>i("button",{class:[G.historyRow,t.value===d.rev&&G.historyRowSelected],"aria-selected":t.value===d.rev,onClick$:V("s_MsJX096CMQc",[d,a])},{type:"button",role:"option"},[i("span",null,{class:G.historyValue},d.newValue||i("em",null,null,"Empty",3,"MV_0"),1,null),i("span",null,{class:G.historyMeta},[o(d.updatedAt),"  by ",Ee(d,"updatedBy")],1,null)],0,d.id)),1,"MV_1"),1,"MV_2")},nn=w(s(tn,"s_JOaqQ6mNgM0")),an="_inlineWrapper_g7gtr_7",on="_spacer_g7gtr_19",ln="_buttonGroup_g7gtr_29",dn="_cancelButton_g7gtr_43",sn="_revertButton_g7gtr_91",rn="_metadata_g7gtr_141",cn="_historyChevron_g7gtr_161",un="_actionsRow_g7gtr_221",pn="_deleteButton_g7gtr_233",fn="_historyRow_g7gtr_279",F={inlineWrapper:an,spacer:on,buttonGroup:ln,cancelButton:dn,revertButton:sn,metadata:rn,historyChevron:cn,actionsRow:un,deleteButton:pn,historyRow:fn},_n=()=>{const[e]=p();e.onDelete$()},vn=e=>{const[t,n]=p();n.value=e,t.onPreviewChange$(e)},yn=async()=>{const[e,t,n,a]=p();if(a.value!==null){await n.onRevert$(a.value);try{const o=await L().getFieldHistory(n.fieldId);e.value=o}catch(o){console.error("Failed to reload field history:",o)}a.value=null,t.value=!1}},gn=()=>{const[e,t,n]=p();e.value=!e.value,e.value||(n.value=null,t.onPreviewChange$(null))},hn=()=>{const[e,t,n]=p();n.value=null,t.onPreviewChange$(null),e.value=!1},mn=e=>{P();const t=y([]),n=y(!1),a=y(!1),o=y(null);U(V("s_R1kXqMQvJ9E",[t,n,e]));const l=s(_n,"s_0bgQ1zoSedw",[e]),d=s(vn,"s_zD3B0y4fHO0",[e,o]),f=s(yn,"s_3k04NU4DZf8",[t,a,e,o]),r=s(gn,"s_QoNOrZ0E02s",[a,e,o]),v=t.value.length>0?t.value[t.value.length-1]:null,h=v!=null&&v.updatedAt?gt(v.updatedAt):"",$=(v==null?void 0:v.updatedBy)??"",D=n.value&&h?`${h}  ${$}`:"...",E=t.value.length>0,A=o.value!==null,m=s(hn,"s_Mi0Kr02WGGA",[a,e,o]);return i("div",null,{class:[F.inlineWrapper,"no-caret"]},[A?i("span",null,{class:F.buttonGroup},[i("button",null,{type:"button",class:F.cancelButton,"aria-label":"Cancel selection",onClick$:m},"CANCEL",3,null),i("button",null,{type:"button",class:F.revertButton,"aria-label":"Revert to selected value",onClick$:f},"REVERT",3,null)],3,"dk_0"):i("span",null,{class:[F.spacer,"no-caret"]},null,3,null),i("span",null,{class:[F.metadata,"no-caret"]},D,1,null),i("button",{disabled:!E,title:E?"View field history":"No history available"},{type:"button",class:F.historyChevron,"aria-expanded":u(I=>I.value,[a],"p0.value"),"aria-label":u(I=>I.value?"Close field history":"Open field history",[a],'p0.value?"Close field history":"Open field history"'),onClick$:r},u(I=>I.value?"▾":"◂",[a],'p0.value?"▾":"◂"'),3,null),a.value&&E&&i("div",null,{class:[F.historyRow,"no-caret"]},g(nn,{get fieldId(){return e.fieldId},get history(){return t.value},get isOpen(){return a.value},onToggle$:r,onPreviewChange$:d,[_]:{fieldId:u(I=>I.fieldId,[e],"p0.fieldId"),history:u(I=>I.value,[t],"p0.value"),isOpen:u(I=>I.value,[a],"p0.value"),onToggle$:_,onPreviewChange$:_}},3,"dk_1"),1,"dk_2"),i("div",null,{class:[F.actionsRow,"no-caret"]},i("button",null,{type:"button",class:F.deleteButton,"aria-label":"Delete this field",onClick$:l},"Delete Field",3,null),3,null)],1,"dk_3")},wn=w(s(mn,"s_cNXlVpCg5og")),Nn="_datafieldWrapper_pusyg_5",$n="_datafieldWrapperExpanded_pusyg_21",bn="_datafield_pusyg_5",Dn="_datafieldChevron_pusyg_117",In="_datafieldLabel_pusyg_163",Cn="_datafieldValue_pusyg_175",Sn="_datafieldValueUnderlined_pusyg_183",En="_datafieldValueEditable_pusyg_193",Vn="_datafieldPlaceholder_pusyg_235",Rn="_datafieldValuePreview_pusyg_247",R={datafieldWrapper:Nn,datafieldWrapperExpanded:$n,datafield:bn,datafieldChevron:Dn,datafieldLabel:In,datafieldValue:Cn,datafieldValueUnderlined:Sn,datafieldValueEditable:En,datafieldPlaceholder:Vn,datafieldValuePreview:Rn},An=()=>{const[e,t,n,a]=p(),o=x.getDataFieldDetailsState(e,a.id)==="EXPANDED";t.toggleFieldDetailsExpanded$(a.id),o&&n.clearPreview$()},Fn=async()=>{const[e]=p();await L().deleteField(e.id),Q(),e.onDeleted$&&e.onDeleted$()},Tn=e=>{P();const t=H(),n=W(),o=x.getDataFieldDetailsState(t,e.id)==="EXPANDED",l=Gt({fieldId:e.id,initialValue:e.fieldValue,onUpdated$:e.onUpdated$}),d=s(An,"s_wqZYmXF10hc",[t,n,l,e]),f=s(Fn,"s_ldsGGOBThbg",[e]),r=`field-label-${e.id}`;return i("div",{class:[R.datafieldWrapper,o&&R.datafieldWrapperExpanded,"no-caret"],ref:l.rootRef},null,i("div",null,{class:[R.datafield,"no-caret"]},[i("button",{"aria-expanded":o,"aria-label":o?"Collapse field details":"Expand field details"},{type:"button",class:R.datafieldChevron,onClick$:d},o?"▾":"▸",1,null),i("label",{id:r},{class:R.datafieldLabel},[u(v=>v.fieldName,[e],"p0.fieldName"),":"],3,null),l.isEditing?i("input",{ref:l.editInputRef,class:[R.datafieldValue,l.editValue.value&&R.datafieldValueUnderlined],"aria-labelledby":r,onInput$:V("s_vhiFO47zY4A",[l]),onPointerDown$:l.inputPointerDown$,onBlur$:l.inputBlur$,onKeyDown$:l.inputKeyDown$},{value:u(v=>v.editValue.value,[l],"p0.editValue.value"),autoFocus:!0},null,2,"o6_0"):i("div",{class:[R.datafieldValue,l.hasValue&&R.datafieldValueUnderlined,R.datafieldValueEditable,l.isPreviewActive&&R.datafieldValuePreview,"no-caret"],"aria-labelledby":r,onPointerDown$:l.valuePointerDown$,onKeyDown$:l.valueKeyDown$},{tabIndex:0,role:"button","aria-description":"Press Enter to edit"},l.displayValue||i("span",null,{class:R.datafieldPlaceholder},"Empty",3,"o6_1"),0,null),o&&g(wn,{get fieldId(){return e.id},get fieldName(){return e.fieldName},get currentValue(){return l.displayValue},onDelete$:f,onPreviewChange$:l.setPreview$,onRevert$:l.revert$,[_]:{fieldId:u(v=>v.id,[e],"p0.id"),fieldName:u(v=>v.fieldName,[e],"p0.fieldName"),currentValue:u(v=>v.displayValue,[l],"p0.displayValue"),onDelete$:_}},2,"o6_2")],1,null),1,"o6_3")},Bn=w(s(Tn,"s_2gBrAJoSz7w")),On="_constructionWrapper_aoisn_51",kn="_construction_aoisn_51",xn="_chevronButton_aoisn_83",Pn="_chevron_aoisn_83",Wn="_chevronOpen_aoisn_141",Un="_comboBoxWrapper_aoisn_159",Mn="_inputName_aoisn_169",qn="_inputValue_aoisn_207",Hn="_dropdown_aoisn_245",Ln="_dropdownItem_aoisn_269",Qn="_actions_aoisn_315",Kn="_actionButton_aoisn_329",Gn="_cancelButton_aoisn_367",S={constructionWrapper:On,construction:kn,chevronButton:xn,chevron:Pn,chevronOpen:Wn,comboBoxWrapper:Un,inputName:Mn,inputValue:qn,dropdown:Hn,dropdownItem:Ln,actions:Qn,actionButton:Kn,cancelButton:Gn},zn=()=>{const[e,t]=p();t.initialName||setTimeout(()=>{var n;(n=e.value)==null||n.focus()},10)},Yn=()=>{const[e,t,n]=p();n.onChange$&&n.onChange$(n.id,e.value,t.value||null)},Xn=()=>{const[e,t,n]=p(),a=e.value.trim(),o=t.value.trim()||null;n.onSave$(n.id,a,o)},jn=()=>{const[e]=p();document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.onCancel$(e.id)},Zn=()=>{const[e,t,n]=p();if(!n.value&&e.value){const a=e.value.getBoundingClientRect();t.value={top:a.bottom+2,left:a.left,width:a.width}}n.value=!n.value},Jn=e=>{const[t,n,a,o]=p();t.value=e,n.value=!1,a(),setTimeout(()=>{var l;(l=o.value)==null||l.focus()},10)},ea=e=>{const[t,n]=p();t.value=e.target.value,n()},ta=e=>{const[t,n]=p();t.value=e.target.value,n()},na=e=>{var d;const[t,n,a,o,l]=p();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"?(e.preventDefault(),n.value?n.value=!1:t()):e.key==="ArrowDown"?(e.preventDefault(),o()):e.key==="Tab"&&!e.shiftKey&&(e.preventDefault(),(d=l.value)==null||d.focus())},aa=e=>{var o;const[t,n,a]=p();e.key==="Enter"?(e.preventDefault(),a()):e.key==="Escape"?(e.preventDefault(),t()):e.key==="Tab"&&e.shiftKey&&(e.preventDefault(),(o=n.value)==null||o.focus())},oa=e=>{const[t,n,a]=p();e.key==="Enter"||e.key===" "?(e.preventDefault(),a()):e.key==="Escape"&&(e.preventDefault(),n.value?n.value=!1:t())},la=e=>{const t=y(e.initialName??""),n=y(e.initialValue??""),a=y(!1),o=y(),l=y(),d=y(),f=y({top:0,left:0,width:0});X(s(zn,"s_b1r271u70lg",[o,e]));const r=s(Yn,"s_5qS05iQ3kzk",[t,n,e]),v=s(Xn,"s_VXoapCcVBGQ",[t,n,e]),h=s(jn,"s_pO38pDzpTKY",[e]),$=s(Zn,"s_CPeMh0DlK80",[d,f,a]),D=s(Jn,"s_JKvEDYW7DNg",[t,a,r,l]),E=s(ea,"s_C64zPMw20r4",[t,r]),A=s(ta,"s_1yLyyhcqgGY",[n,r]),m=s(na,"s_y0PWFrmLvh4",[h,a,v,$,l]),I=s(aa,"s_PaMVmYQPeZ4",[h,o,v]),ee=s(oa,"s_AWjg7A8hpOg",[h,a,$]);return i("div",null,{class:S.constructionWrapper},[i("div",null,{class:S.construction},[i("button",null,{type:"button",class:S.chevronButton,"aria-expanded":u(b=>b.value,[a],"p0.value"),"aria-label":u(b=>b.value?"Close field name picker":"Open field name picker",[a],'p0.value?"Close field name picker":"Open field name picker"'),tabIndex:-1,onClick$:$,onKeyDown$:ee},i("span",{class:[S.chevron,a.value&&S.chevronOpen]},null,null,3,null),1,null),i("div",{ref:d},{class:S.comboBoxWrapper},[i("input",{ref:o},{type:"text",class:S.inputName,value:u(b=>b.value,[t],"p0.value"),placeholder:"Field Name","aria-label":"Field name (press Down Arrow for library)",onInput$:E,onKeyDown$:m,onFocus$:V("s_0IWX0Y3zQpc",[a])},null,3,null),a.value&&i("div",null,{class:S.dropdown,role:"listbox","aria-label":"Prefab field names",style:u(b=>({top:`${b.value.top}px`,left:`${b.value.left}px`,width:`${b.value.width}px`}),[f],"{top:`${p0.value.top}px`,left:`${p0.value.left}px`,width:`${p0.value.width}px`}")},vt.map(b=>i("button",{onClick$:V("s_WB40vqhys98",[b,D])},{type:"button",class:S.dropdownItem,role:"option"},b,0,b)),1,"S1_0")],1,null),i("input",{ref:l},{type:"text",class:S.inputValue,value:u(b=>b.value,[n],"p0.value"),placeholder:"Value (optional)","aria-label":"Field value",onInput$:A,onKeyDown$:I},null,3,null)],1,null),i("div",null,{class:S.actions},[i("button",null,{type:"button",class:[S.actionButton,S.cancelButton],onClick$:h},"Cancel",3,null),i("button",null,{type:"button",class:S.actionButton,onClick$:v},"Save",3,null)],3,null)],1,"S1_1")},da=w(s(la,"s_rgskcIH6ZDg")),sa=()=>{const[e,t,n,a]=p(),o=a.nodeId,l=a.enabled;(t.value!==o||e.value!==l)&&(t.value=o,e.value=l,n.value++)},ia=async()=>{const[e,t,n,a]=p();e.value&&(a.value=!0,n.value=await L().getFieldsForNode(t.value),a.value=!1)};function ra(e){const t=y(null),n=y(!1),a=y(e.nodeId),o=y(e.enabled),l=y(0);X(s(sa,"s_4i3R51gQIV8",[o,a,l,e]));const d=s(ia,"s_7gfJWzE1Bug",[o,a,t,n]);return U(V("s_Ch3EXBvP4ag",[o,a,t,n,l,d])),{fields:t,isLoading:n,reload$:d}}const le=e=>`pendingFields:${e}`,ca=e=>{try{const t=localStorage.getItem(le(e));return t?JSON.parse(t):[]}catch{return[]}},ua=(e,t)=>{try{t.length===0?localStorage.removeItem(le(e)):localStorage.setItem(le(e),JSON.stringify(t))}catch{}};function pa(e){return ca(e).filter(n=>n.saved===!0&&n.fieldName.trim())}const fa=({track:e})=>{const[t,n]=p(),a=e(()=>t.value);typeof localStorage<"u"&&ua(n.nodeId,a)},_a=async()=>{const[e,t]=p(),n=t.maxPersistedCardOrder$.value,a=e.value.length>0?Math.max(...e.value.map(d=>d.cardOrder)):-1,o=Math.max(n,a)+1,l={id:j(),fieldName:"",fieldValue:null,cardOrder:o};e.value=[...e.value,l]},va=async(e,t,n)=>{const[a,o]=p(),l=t.trim();if(!l){a.value=a.value.filter(r=>r.id!==e);return}const d=a.value.find(r=>r.id===e),f=d==null?void 0:d.cardOrder;if(o.mode==="construction"){a.value=a.value.map(r=>r.id===e?{...r,fieldName:l,fieldValue:n,saved:!0}:r);return}await L().addField(o.nodeId,l,n,f),a.value=a.value.filter(r=>r.id!==e),Q(),await o.onSaved$()},ya=e=>{const[t]=p();t.value=t.value.filter(n=>n.id!==e)},ga=(e,t,n)=>{const[a]=p();a.value=a.value.map(o=>o.id===e?{...o,fieldName:t,fieldValue:n}:o)},ha=async()=>{const[e,t]=p(),n=e.value.filter(o=>o.fieldName.trim());if(n.length===0)return 0;if(t.mode==="construction")return e.value=e.value.map(o=>o.fieldName.trim()?{...o,fieldName:o.fieldName.trim(),saved:!0}:o),n.length;const a=L();return await Promise.all(n.map(o=>a.addField(t.nodeId,o.fieldName.trim(),o.fieldValue,o.cardOrder))),e.value=[],Q(),await t.onSaved$(),n.length};function ma(e){const t=y([]),n=y(!1);return U(V("s_qU68K91Z7fs",[t,n,e])),X(s(fa,"s_7EzmTvHmSgg",[t,e])),{forms:t,add$:s(_a,"s_Biym0x2w2Hg",[t,e]),save$:s(va,"s_w000e3KQtXY",[t,e]),cancel$:s(ya,"s_tq0phclloKM",[t]),change$:s(ga,"s_IrI7Myrn2Ko",[t]),saveAllPending$:s(ha,"s_CEglqaDCkrM",[t,e])}}const wa="_fieldList_5uih9_5",Na="_addButton_5uih9_17",ce={fieldList:wa,addButton:Na},ve=30,$a=()=>{const[e]=p();return!e.fields.value||e.fields.value.length===0?-1:Math.max(...e.fields.value.map(t=>t.cardOrder))},ba=()=>{const[e,t]=p(),n=[];if(t.fields.value)for(const a of t.fields.value)n.push({type:"persisted",field:a});for(const a of e.forms.value)n.push({type:"pending",form:a});return n.sort((a,o)=>{const l=a.type==="persisted"?a.field.cardOrder:a.form.cardOrder,d=o.type==="persisted"?o.field.cardOrder:o.form.cardOrder;return l-d}),n},Da=()=>{const[e]=p();e.reload$()},Ia=()=>{const[e]=p();e.forms.value.length<ve&&e.add$()},Ca=e=>{const t=ra({nodeId:e.nodeId,enabled:!0}),n=ie(s($a,"s_09wqlr4vzW0",[t])),a=ma({nodeId:e.nodeId,mode:e.isConstruction?"construction":"display",onSaved$:t.reload$,initialFieldNames:e.initialFieldNames,maxPersistedCardOrder$:n});U(V("s_YFcoGOqtLXk",[a,e]));const o=ie(s(ba,"s_vrtZqVijSkE",[a,t])),l=s(Da,"s_XhGlu5hwbws",[t]),d=s(Ia,"s_WITd5JAXm44",[a]),f=a.forms.value.length<ve;return i("div",null,{class:ce.fieldList},[o.value.map(r=>(P(),r.type==="persisted"?g(Bn,{get id(){return r.field.id},get fieldName(){return r.field.fieldName},get fieldValue(){return r.field.fieldValue},onDeleted$:l,[_]:{id:B(r.field,"id"),fieldName:B(r.field,"fieldName"),fieldValue:B(r.field,"fieldValue"),onDeleted$:_}},3,r.field.id):g(da,{get id(){return r.form.id},get initialName(){return r.form.fieldName},get initialValue(){return r.form.fieldValue},onSave$:a.save$,onCancel$:a.cancel$,onChange$:a.change$,[_]:{id:B(r.form,"id"),initialName:B(r.form,"fieldName"),initialValue:B(r.form,"fieldValue")}},2,r.form.id))),i("button",{disabled:!f,"aria-label":f?"Add new field":"Maximum fields reached"},{type:"button",class:ce.addButton,onClick$:d},"+ Add Field",3,null)],1,"Bt_0")},ye=w(s(Ca,"s_2RnEZFWrgIk")),Sa="_wrapper_69p8f_7",Ea="_wrapperOpen_69p8f_31",Va="_inner_69p8f_39",Ra="_details_69p8f_53",Aa="_detailsOpen_69p8f_81",Fa="_actionsRow_69p8f_93",Ta="_deleteButton_69p8f_105",q={wrapper:Sa,wrapperOpen:Ea,inner:Va,details:Ra,detailsOpen:Aa,actionsRow:Fa,deleteButton:Ta},Ba=e=>i("div",{class:[q.wrapper,e.isOpen&&q.wrapperOpen]},null,i("div",null,{class:q.inner},i("div",{class:[q.details,e.isOpen&&q.detailsOpen]},null,g(oe,null,3,"U2_0"),1,null),1,null),1,"U2_1"),Oa=w(s(Ba,"s_U7D0xuRjUic")),ka=new Map;function xa(e){const t=[],n=new Set;let a=e;for(;a&&!n.has(a);){n.add(a);const o=ka.get(a);if(!o)break;t.unshift({id:o.id,name:o.nodeName}),a=o.parentId}return t}function Pa(e){return xa(e)}const Wa="_breadcrumbs_iuqaw_1",Ua="_segment_iuqaw_19",Ma="_label_iuqaw_31",qa="_ancestor_iuqaw_41",Ha="_current_iuqaw_69",La="_separator_iuqaw_79",M={breadcrumbs:Wa,segment:Ua,label:Ma,ancestor:qa,current:Ha,separator:La},Qa=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},Ka=e=>{const t=W(),n=Pa(e.nodeId);return n.length?i("nav",null,{class:M.breadcrumbs,"aria-label":"Breadcrumb"},n.map((a,o)=>{const l=o===n.length-1,d=a.name||"Untitled";return i("span",null,{class:M.segment},[l?i("span",null,{class:[M.label,M.current]},d,1,"5z_0"):i("button",{onClick$:s(Qa,"s_yfB6ONRQ6Zs",[t,a])},{type:"button",class:[M.label,M.ancestor]},d,0,null),!l&&i("span",null,{class:M.separator},"/",3,"5z_1")],1,a.id)}),1,"5z_2"):null},Ga=w(s(Ka,"s_RDpU1pg5dZk")),za=e=>{const[t,n]=p();e==null||e.stopPropagation(),t.toggleCardExpanded$(n.id)},Ya=()=>{const[e,t]=p();e.toggleNodeDetailsExpanded$(t.id)},Xa=async()=>{var n;const[e]=p();console.log("[TreeNodeDisplay] Delete requested for node:",e.id);const t=e.parentId;await J().deleteNode(e.id),console.log("[TreeNodeDisplay] Node deleted, triggering sync"),Q(),(n=e.onNavigateUp$)==null||n.call(e,t??null)},ja=e=>{const t=H(),n=W(),o=x.getDataCardState(t,e.id)==="EXPANDED",d=x.getNodeDetailsState(t,e.id)==="EXPANDED",f=s(za,"s_fJ0tmVx2bMU",[n,e]),r=s(Ya,"s_lPLXdyN6u08",[n,e]),v=s(Xa,"s_034j2WWPHvA",[e]),h=`node-title-${e.id}`,$=!!e.onNodeClick$,D=e.nodeState==="PARENT",A=e.nodeState==="CHILD"?"18px":"50px";return i("div",{style:{"--datacard-indent":A}},{class:C.nodeWrapper},[g(Oa,{get nodeId(){return e.id},isOpen:d,children:i("div",null,null,[g(Ga,{get nodeId(){return e.id},[_]:{nodeId:u(m=>m.id,[e],"p0.id")}},3,"vG_0"),i("h3",null,{style:"margin: 0 0 var(--space-3) 0; font-size: var(--text-base); font-weight: 600;"},"Node Details",3,null),i("div",null,{style:"color: var(--text-muted); font-size: var(--text-sm);"},null,3,null),i("div",null,{class:q.actionsRow},i("button",null,{type:"button",class:q.deleteButton,"aria-label":"Delete this asset",onClick$:v},"Delete Asset",3,null),3,null)],1,null),[_]:{nodeId:u(m=>m.id,[e],"p0.id")}},1,"vG_1"),g(pe,{get id(){return e.id},titleId:h,isExpanded:o,isDetailsExpanded:d,isParent:D,isClickable:$,get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,onExpand$:f,onDetailsToggle$:r,[_]:{id:u(m=>m.id,[e],"p0.id"),nodeName:u(m=>m.nodeName,[e],"p0.nodeName"),nodeSubtitle:u(m=>m.nodeSubtitle,[e],"p0.nodeSubtitle"),parentId:u(m=>m.parentId,[e],"p0.parentId"),onExpand$:_,onDetailsToggle$:_}},2,"vG_2"),g(fe,{isOpen:o,get nodeId(){return e.id},children:g(ye,{get nodeId(){return e.id},isConstruction:!1,[_]:{nodeId:u(m=>m.id,[e],"p0.id"),isConstruction:_}},3,"vG_3"),[_]:{nodeId:u(m=>m.id,[e],"p0.id")}},1,"vG_4")],1,"vG_5")},Za=w(s(ja,"s_06szQ6qXZeE")),Ja=async()=>{var f,r,v,h,$,D;const[e,t,n,a]=p();e.value&&await e.value.saveAllPending$(),console.log("[handleCreate$] nameInputRef.value:",t.value),console.log("[handleCreate$] subtitleInputRef.value:",a.value),console.log("[handleCreate$] nameInputRef placeholder:",(f=t.value)==null?void 0:f.placeholder),console.log("[handleCreate$] subtitleInputRef placeholder:",(r=a.value)==null?void 0:r.placeholder),console.log("[handleCreate$] nameInputRef.value.value:",(v=t.value)==null?void 0:v.value),console.log("[handleCreate$] subtitleInputRef.value.value:",(h=a.value)==null?void 0:h.value);const o=document.querySelectorAll("input");console.log("[handleCreate$] All inputs on page:",o.length),o.forEach((E,A)=>{console.log(`[handleCreate$] Input ${A}: placeholder="${E.placeholder}", value="${E.value}"`)});const l=(($=t.value)==null?void 0:$.value)||"",d=((D=a.value)==null?void 0:D.value)||"";console.log("[handleCreate$] Final values - nodeName:",JSON.stringify(l),"nodeSubtitle:",JSON.stringify(d)),await n.onCreate$({nodeName:l,nodeSubtitle:d,fields:[]})},eo=e=>{const[t,n]=p();e.key==="Enter"?(e.preventDefault(),t()):e.key==="Escape"&&(e.preventDefault(),n.onCancel$())},to=e=>{const t=y(),n=y(),a=y(null);U(V("s_82IaKsCDbGY",[t]));const o=s(Ja,"s_60fRKu4o7GU",[a,t,e,n]),l=s(eo,"s_ZHVlk1DFSAo",[o,e]),d=`node-title-${e.id}`,f=e.isChildConstruction?"18px":"50px";return i("div",{style:{"--datacard-indent":f}},{class:C.nodeWrapper},[g(pe,{get id(){return e.id},titleId:d,isExpanded:!0,isParent:!1,isClickable:!1,get nodeName(){return e.initialName||""},get nodeSubtitle(){return e.initialSubtitle||""},isConstruction:!0,nameInputRef:t,subtitleInputRef:n,onKeyDown$:l,chevronDisabled:!0,[_]:{id:u(r=>r.id,[e],"p0.id"),isExpanded:_,isParent:_,isClickable:_,nodeName:u(r=>r.initialName||"",[e],'p0.initialName||""'),nodeSubtitle:u(r=>r.initialSubtitle||"",[e],'p0.initialSubtitle||""'),isConstruction:_,nameInputRef:_,subtitleInputRef:_,onKeyDown$:_,chevronDisabled:_}},3,"qo_0"),g(fe,{get nodeId(){return e.id},isOpen:!0,children:[g(ye,{get nodeId(){return e.id},initialFieldNames:yt,handleRef:a,isConstruction:!0,[_]:{nodeId:u(r=>r.id,[e],"p0.id"),initialFieldNames:_,handleRef:_,isConstruction:_}},3,"qo_1"),i("div",{"q:slot":"actions"},{class:C.constructionActions},[i("button",{onClick$:e.onCancel$},{type:"button"},"Cancel",2,null),i("button",null,{type:"button",onClick$:o},"Create",3,null)],1,null)],[_]:{nodeId:u(r=>r.id,[e],"p0.id"),isOpen:_}},1,"qo_2")],1,"qo_3")},no=w(s(to,"s_0HiZh00BXTo"));function ao(e){return e.nodeState==="UNDER_CONSTRUCTION"}const oo=e=>(P(),ao(e)?g(no,{get id(){return e.id},get initialName(){return e.nodeName},get initialSubtitle(){return e.nodeSubtitle},get isChildConstruction(){return e.isChildConstruction},onCancel$:e.onCancel$,onCreate$:e.onCreate$,[_]:{id:u(t=>t.id,[e],"p0.id"),initialName:u(t=>t.nodeName,[e],"p0.nodeName"),initialSubtitle:u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),isChildConstruction:u(t=>t.isChildConstruction,[e],"p0.isChildConstruction")}},2,"gq_0"):g(Za,{get id(){return e.id},get nodeName(){return e.nodeName},get nodeSubtitle(){return e.nodeSubtitle},get nodeState(){return e.nodeState},get parentId(){return e.parentId},onNodeClick$:e.onNodeClick$,onNavigateUp$:e.onNavigateUp$,[_]:{id:u(t=>t.id,[e],"p0.id"),nodeName:u(t=>t.nodeName,[e],"p0.nodeName"),nodeSubtitle:u(t=>t.nodeSubtitle,[e],"p0.nodeSubtitle"),nodeState:u(t=>t.nodeState,[e],"p0.nodeState"),parentId:u(t=>t.parentId,[e],"p0.parentId")}},2,"gq_1")),Y=w(s(oo,"s_gegngB44RHE")),lo="_createNode_194o9_5",so="_createNodeChild_194o9_49",ae={createNode:lo,createNodeChild:so},io=async()=>{const[e]=p();e.onClick$&&await e.onClick$()},ro=e=>{const t=s(io,"s_m1x9adscB00",[e]);return e.variant==="root"?i("button",null,{type:"button",class:[ae.createNode,"no-caret"],"aria-label":"Create New Asset",onClick$:t},"Create New Asset",3,"ad_0"):e.variant==="child"?i("button",null,{type:"button",class:[ae.createNode,ae.createNodeChild,"no-caret"],"aria-label":"Add Sub-Asset",onClick$:t},"+ Add Sub-Asset",3,"ad_1"):null},ge=w(s(ro,"s_0wYRrfEmCIE")),co=async()=>{const[e,t]=p(),n=j();await t({id:n,parentId:e.parentId,nodeName:"",nodeSubtitle:"",defaultFields:[]})},uo=async()=>{const[e,t]=p(),n=e.underConstruction;n&&localStorage.removeItem(`pendingFields:${n.id}`),await t()},po=async e=>{const[t,n,a]=p();console.log("[complete$] Received payload:",JSON.stringify(e));const o=t.underConstruction;if(console.log("[complete$] ucData:",o),!o){console.log("[complete$] No ucData, returning early!");return}const l=pa(o.id);console.log("[complete$] Saved fields from localStorage:",l.length),await J().createWithFields({id:o.id,parentId:o.parentId,nodeName:e.nodeName||"Untitled",nodeSubtitle:e.nodeSubtitle||"",defaults:l.map(d=>({fieldName:d.fieldName,fieldValue:d.fieldValue}))}),console.log("[complete$] Node and fields created atomically"),localStorage.removeItem(`pendingFields:${o.id}`),Q(),await n(),console.log("[complete$] completeConstruction$ done, calling onCreated$"),await a.onCreated$(),console.log("[complete$] onCreated$ done, complete$ finished")};function he(e){const t=H(),{startConstruction$:n,cancelConstruction$:a,completeConstruction$:o}=W(),l=s(co,"s_n6hsWUuIj1Y",[e,n]),d=s(uo,"s_cbiq6e5O6us",[t,a]),f=s(po,"s_v6yCRyJjgcY",[t,o,e]);return{ucNode:t.underConstruction,start$:l,cancel$:d,complete$:f}}const fo=async()=>{const[e,t]=p();console.log("[useRootViewData] load$ called"),e.value=!0;try{const n=await J().getRootNodes();console.log("[useRootViewData] Fetched",n.length,"root nodes"),t.value=n,console.log("[useRootViewData] nodes.value set to",t.value.length,"nodes")}finally{e.value=!1}};function _o(){const e=y([]),t=y(!1),n=s(fo,"s_UIfphfAKvzM",[t,e]);return U(V("s_j2W4Hu2S1VQ",[n])),{nodes:e,isLoading:t,reload$:n}}const vo=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},yo=()=>{P();const e=H(),t=W(),n=_o(),a=he({parentId:null,onCreated$:n.reload$}),o=a.ucNode?n.nodes.value.filter(l=>l.id!==a.ucNode.id):n.nodes.value;return i("main",null,{class:"view-root"},[o.map(l=>g(Y,{get id(){return l.id},get nodeName(){return l.nodeName},nodeSubtitle:l.nodeSubtitle??"",nodeState:x.getDisplayNodeState(e,l.id),onNodeClick$:s(vo,"s_FBTGThmmG98",[t,l]),[_]:{id:B(l,"id"),nodeName:B(l,"nodeName")}},3,l.id)),a.ucNode?g(Y,{get id(){return a.ucNode.id},get nodeName(){return a.ucNode.nodeName},get nodeSubtitle(){return a.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",onCancel$:a.cancel$,onCreate$:a.complete$,[_]:{id:u(l=>l.ucNode.id,[a],"p0.ucNode.id"),nodeName:u(l=>l.ucNode.nodeName,[a],"p0.ucNode.nodeName"),nodeSubtitle:u(l=>l.ucNode.nodeSubtitle,[a],"p0.ucNode.nodeSubtitle"),nodeState:_}},2,a.ucNode.id):null,g(ge,{variant:"root",onClick$:a.start$,[_]:{variant:_}},2,"7G_0")],1,"7G_1")},go=w(s(yo,"s_hNvYX6tEL2I")),ho=async e=>{const[t,n,a,o,l]=p();if(e){t.underConstruction&&n(),o.value=!0;try{const d=await J().getNodeWithChildren(e);l.value=d.node,a.value=d.children}finally{o.value=!1}}};function mo(){const e=y(null),t=y([]),n=y(!1),a=H(),{cancelConstruction$:o}=W(),l=s(ho,"s_cbTnqvcou0A",[a,o,t,n,e]);return{parentNode:e,children:t,isLoading:n,load$:l,reload$:l}}const wo=async({track:e})=>{const[t,n]=p(),a=e(()=>n.parentId);a&&await t.load$(a)},No=async()=>{const[e,t]=p();await e.reload$(t.parentId)},$o=()=>{const[e,t]=p();return e.navigateToNode$(t.id)},bo=e=>{P();const t=W(),n=mo();X(s(wo,"s_yRk2iqAjgFI",[n,e])),U(V("s_YSvpaIwIZ9w",[n,e]));const a=he({parentId:e.parentId,onCreated$:s(No,"s_02bEtWr042Y",[n,e])});return n.isLoading.value||!n.parentNode.value?i("main",null,{class:"view-branch"},"Loading...",3,"RT_0"):i("main",null,{class:"view-branch"},[i("div",null,{class:"branch-parent-row"},i("div",null,{class:"branch-parent-node"},g(Y,{get id(){return n.parentNode.value.id},get nodeName(){return n.parentNode.value.nodeName},get nodeSubtitle(){return n.parentNode.value.nodeSubtitle??""},nodeState:"PARENT",get parentId(){return n.parentNode.value.parentId},onNavigateUp$:t.navigateUp$,[_]:{id:u(o=>o.parentNode.value.id,[n],"p0.parentNode.value.id"),nodeName:u(o=>o.parentNode.value.nodeName,[n],"p0.parentNode.value.nodeName"),nodeSubtitle:u(o=>o.parentNode.value.nodeSubtitle??"",[n],'p0.parentNode.value.nodeSubtitle??""'),nodeState:_,parentId:u(o=>o.parentNode.value.parentId,[n],"p0.parentNode.value.parentId")}},2,n.parentNode.value.id),1,null),1,null),i("div",null,{class:"branch-children"},[n.children.value.filter(o=>!a.ucNode||o.id!==a.ucNode.id).map(o=>g(Y,{get id(){return o.id},get nodeName(){return o.nodeName},nodeSubtitle:o.nodeSubtitle??"",nodeState:"CHILD",onNodeClick$:s($o,"s_ubVdAKhHRM8",[t,o]),[_]:{id:B(o,"id"),nodeName:B(o,"nodeName"),nodeState:_}},3,o.id)),a.ucNode?i("div",null,{class:"branch-child-row"},g(Y,{get id(){return a.ucNode.id},get nodeName(){return a.ucNode.nodeName},get nodeSubtitle(){return a.ucNode.nodeSubtitle},nodeState:"UNDER_CONSTRUCTION",isChildConstruction:!0,onCancel$:a.cancel$,onCreate$:a.complete$,[_]:{id:u(o=>o.ucNode.id,[a],"p0.ucNode.id"),nodeName:u(o=>o.ucNode.nodeName,[a],"p0.ucNode.nodeName"),nodeSubtitle:u(o=>o.ucNode.nodeSubtitle,[a],"p0.ucNode.nodeSubtitle"),nodeState:_,isChildConstruction:_}},2,a.ucNode.id),1,"RT_1"):null,g(ge,{variant:"child",onClick$:a.start$,[_]:{variant:_}},2,"RT_2")],1,null)],1,"RT_3")},Do=w(s(bo,"s_gIJMeo2tapw")),Io=()=>{P();const e=H(),t=x.isRootView(e),n=x.getCurrentNodeId(e);return t?g(go,null,3,"sJ_0"):g(Do,{parentId:n},3,"sJ_1")},Co=w(s(Io,"s_yh0RYmyrFWk")),So=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),Eo=[],Vo=[["/",[()=>So],"/",[]]],Ro=[],Ao=!0,Fo="/",To=!0,ko={routes:Vo,serverPlugins:Eo,menus:Ro,trailingSlash:Ao,basePathname:Fo,cacheModules:To};export{Fo as basePathname,To as cacheModules,ko as default,Ro as menus,Vo as routes,Eo as serverPlugins,Ao as trailingSlash};
